<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Downloading the Dataset and the weights of the pre trained model – nbdev_testing_simon2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-4369b3b467e4dfc43c03312748781de1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Downloading the Dataset and the weights of the pre trained model – nbdev_testing_simon2">
<meta property="og:description" content="AI Board Scanner project—the FastAPI server for your AI scanner.">
<meta property="og:image" content="https://muhammad-asif78.github.io/nbdev_testing_simon2/index_files/figure-html/cell-13-output-1.png">
<meta property="og:site_name" content="nbdev_testing_simon2">
<meta property="og:image:height" content="1200">
<meta property="og:image:width" content="1800">
<meta name="twitter:title" content="Downloading the Dataset and the weights of the pre trained model – nbdev_testing_simon2">
<meta name="twitter:description" content="AI Board Scanner project—the FastAPI server for your AI scanner.">
<meta name="twitter:image" content="https://muhammad-asif78.github.io/nbdev_testing_simon2/index_files/figure-html/cell-13-output-1.png">
<meta name="twitter:image-height" content="1200">
<meta name="twitter:image-width" content="1800">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">nbdev_testing_simon2</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html"><strong>Downloading the Dataset and the weights of the pre trained model</strong></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><strong>Downloading the Dataset and the weights of the pre trained model</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./geometry_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geometry Utils</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./color_extractor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Color Extractor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./angle_predictor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Angle Predictor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sam2_processor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAM2 Processor</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./skeleton_analyzer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Skeleton Analyzer</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diamond_handler.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diamond Handler</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arrow_detector.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Arrow Detector</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text_mapper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Text Mapper</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./node_builder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Node Builder</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./edge_builder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Edge Builder</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_paddle_ocr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11_paddle_ocr.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rf_detr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Type for detection: (label, top_left, bottom_right, confidence)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./routers_spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Router</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial_pipeline.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Pipeline</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./main.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI Board Scanner – End‑to‑End Demo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#packages-installation" id="toc-packages-installation" class="nav-link active" data-scroll-target="#packages-installation"><strong>Packages Installation</strong></a></li>
  <li><a href="#rf-detr-model-for-shape-and-arrow-detection" id="toc-rf-detr-model-for-shape-and-arrow-detection" class="nav-link" data-scroll-target="#rf-detr-model-for-shape-and-arrow-detection"><strong>RF-DETR Model for shape and arrow detection</strong></a></li>
  <li><a href="#paddle-ocr" id="toc-paddle-ocr" class="nav-link" data-scroll-target="#paddle-ocr"><strong>Paddle OCR</strong></a></li>
  <li><a href="#spatial-relationship" id="toc-spatial-relationship" class="nav-link" data-scroll-target="#spatial-relationship"><strong>Spatial Relationship</strong></a></li>
  <li><a href="#angle-prediction-of-shapes" id="toc-angle-prediction-of-shapes" class="nav-link" data-scroll-target="#angle-prediction-of-shapes"><strong>Angle Prediction of shapes</strong></a></li>
  <li><a href="#dominant-color-prediction" id="toc-dominant-color-prediction" class="nav-link" data-scroll-target="#dominant-color-prediction"><strong>Dominant Color Prediction</strong></a></li>
  <li><a href="#final-json-output" id="toc-final-json-output" class="nav-link" data-scroll-target="#final-json-output"><strong>Final JSON Output</strong></a></li>
  <li><a href="#map" id="toc-map" class="nav-link" data-scroll-target="#map"><strong>MAP</strong></a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/muhammad-asif78/nbdev_testing_simon2/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>Downloading the Dataset and the weights of the pre trained model</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="packages-installation" class="level3">
<h3 class="anchored" data-anchor-id="packages-installation"><strong>Packages Installation</strong></h3>
<div id="cell-3" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="19e439a1-b560-420a-e7a9-c7fe66a71c99">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>q rfdetr<span class="op">==</span><span class="fl">1.2.1</span> supervision<span class="op">==</span><span class="fl">0.26.1</span> roboflow</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install paddleocr</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install pymupdf pillow</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install paddlepaddle</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 0.0/266.3 kB ? eta -:--:--     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 266.3/266.3 kB 16.2 MB/s eta 0:00:00
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
  Installing backend dependencies ... done
  Preparing metadata (pyproject.toml) ... done
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 131.3/131.3 kB 11.6 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 207.2/207.2 kB 21.4 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 89.9/89.9 kB 8.8 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 66.8/66.8 kB 4.1 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 49.9/49.9 MB 21.0 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.4/1.4 MB 64.5 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 4.2/4.2 MB 90.2 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.5/1.5 MB 63.0 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 372.8/372.8 kB 21.1 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 44.8/44.8 kB 3.9 MB/s eta 0:00:00
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.6/1.6 MB 70.3 MB/s eta 0:00:00
  Building wheel for fairscale (pyproject.toml) ... done
Collecting paddleocr
  Downloading paddleocr-3.3.2-py3-none-any.whl.metadata (55 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 55.2/55.2 kB 6.2 MB/s eta 0:00:00
Collecting paddlex&lt;3.4.0,&gt;=3.3.0 (from paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading paddlex-3.3.11-py3-none-any.whl.metadata (79 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 79.9/79.9 kB 9.7 MB/s eta 0:00:00
Requirement already satisfied: PyYAML&gt;=6 in /usr/local/lib/python3.12/dist-packages (from paddleocr) (6.0.3)
Requirement already satisfied: requests in /usr/local/lib/python3.12/dist-packages (from paddleocr) (2.32.4)
Requirement already satisfied: typing-extensions&gt;=4.12 in /usr/local/lib/python3.12/dist-packages (from paddleocr) (4.15.0)
Collecting aistudio-sdk&gt;=0.3.5 (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading aistudio_sdk-0.3.8-py3-none-any.whl.metadata (1.1 kB)
Requirement already satisfied: chardet in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (5.2.0)
Collecting colorlog (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading colorlog-6.10.1-py3-none-any.whl.metadata (11 kB)
Requirement already satisfied: filelock in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (3.20.0)
Requirement already satisfied: huggingface-hub in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (0.36.0)
Collecting modelscope&gt;=1.28.0 (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading modelscope-1.33.0-py3-none-any.whl.metadata (43 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 43.3/43.3 kB 4.9 MB/s eta 0:00:00
Requirement already satisfied: numpy&gt;=1.24 in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2.0.2)
Requirement already satisfied: packaging in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (25.0)
Requirement already satisfied: pandas&gt;=1.3 in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2.2.2)
Requirement already satisfied: pillow in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (11.3.0)
Requirement already satisfied: prettytable in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (3.17.0)
Requirement already satisfied: py-cpuinfo in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (9.0.0)
Requirement already satisfied: pydantic&gt;=2 in /usr/local/lib/python3.12/dist-packages (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2.12.3)
Collecting PyYAML&gt;=6 (from paddleocr)
  Downloading PyYAML-6.0.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (2.1 kB)
Collecting ruamel.yaml (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading ruamel.yaml-0.18.16-py3-none-any.whl.metadata (25 kB)
Collecting ujson (from paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading ujson-5.11.0-cp312-cp312-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl.metadata (9.4 kB)
Requirement already satisfied: imagesize in /usr/local/lib/python3.12/dist-packages (from paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (1.4.1)
Collecting opencv-contrib-python==4.10.0.84 (from paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading opencv_contrib_python-4.10.0.84-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (20 kB)
Collecting pyclipper (from paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading pyclipper-1.4.0-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (8.6 kB)
Collecting pypdfium2&gt;=4 (from paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading pypdfium2-5.1.0-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (67 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 67.7/67.7 kB 6.6 MB/s eta 0:00:00
Collecting python-bidi (from paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading python_bidi-0.6.7-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.9 kB)
Requirement already satisfied: shapely in /usr/local/lib/python3.12/dist-packages (from paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2.1.2)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;paddleocr) (3.4.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;paddleocr) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;paddleocr) (2.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests-&gt;paddleocr) (2025.11.12)
Requirement already satisfied: psutil in /usr/local/lib/python3.12/dist-packages (from aistudio-sdk&gt;=0.3.5-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (5.9.5)
Requirement already satisfied: tqdm in /usr/local/lib/python3.12/dist-packages (from aistudio-sdk&gt;=0.3.5-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (4.67.1)
Collecting bce-python-sdk (from aistudio-sdk&gt;=0.3.5-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading bce_python_sdk-0.9.55-py3-none-any.whl.metadata (416 bytes)
Requirement already satisfied: click in /usr/local/lib/python3.12/dist-packages (from aistudio-sdk&gt;=0.3.5-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (8.3.1)
Requirement already satisfied: setuptools in /usr/local/lib/python3.12/dist-packages (from modelscope&gt;=1.28.0-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (75.2.0)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.12/dist-packages (from pandas&gt;=1.3-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.12/dist-packages (from pandas&gt;=1.3-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2025.2)
Requirement already satisfied: tzdata&gt;=2022.7 in /usr/local/lib/python3.12/dist-packages (from pandas&gt;=1.3-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2025.2)
Requirement already satisfied: annotated-types&gt;=0.6.0 in /usr/local/lib/python3.12/dist-packages (from pydantic&gt;=2-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (0.7.0)
Requirement already satisfied: pydantic-core==2.41.4 in /usr/local/lib/python3.12/dist-packages (from pydantic&gt;=2-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2.41.4)
Requirement already satisfied: typing-inspection&gt;=0.4.2 in /usr/local/lib/python3.12/dist-packages (from pydantic&gt;=2-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (0.4.2)
Requirement already satisfied: fsspec&gt;=2023.5.0 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (2025.3.0)
Requirement already satisfied: hf-xet&lt;2.0.0,&gt;=1.1.3 in /usr/local/lib/python3.12/dist-packages (from huggingface-hub-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (1.2.0)
Requirement already satisfied: wcwidth in /usr/local/lib/python3.12/dist-packages (from prettytable-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (0.2.14)
Collecting ruamel.yaml.clib&gt;=0.2.7 (from ruamel.yaml-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading ruamel_yaml_clib-0.2.15-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (3.5 kB)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.12/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=1.3-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (1.17.0)
Collecting pycryptodome&gt;=3.8.0 (from bce-python-sdk-&gt;aistudio-sdk&gt;=0.3.5-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr)
  Downloading pycryptodome-3.23.0-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.4 kB)
Requirement already satisfied: future&gt;=0.6.0 in /usr/local/lib/python3.12/dist-packages (from bce-python-sdk-&gt;aistudio-sdk&gt;=0.3.5-&gt;paddlex&lt;3.4.0,&gt;=3.3.0-&gt;paddlex[ocr-core]&lt;3.4.0,&gt;=3.3.0-&gt;paddleocr) (1.0.0)
Downloading paddleocr-3.3.2-py3-none-any.whl (86 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 87.0/87.0 kB 10.0 MB/s eta 0:00:00
Downloading paddlex-3.3.11-py3-none-any.whl (1.9 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.9/1.9 MB 86.1 MB/s eta 0:00:00
Downloading PyYAML-6.0.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (767 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 767.5/767.5 kB 46.3 MB/s eta 0:00:00
Downloading opencv_contrib_python-4.10.0.84-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (68.7 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 68.7/68.7 MB 10.9 MB/s eta 0:00:00
Downloading aistudio_sdk-0.3.8-py3-none-any.whl (62 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 63.0/63.0 kB 6.8 MB/s eta 0:00:00
Downloading modelscope-1.33.0-py3-none-any.whl (6.1 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.1/6.1 MB 101.5 MB/s eta 0:00:00
Downloading pypdfium2-5.1.0-py3-none-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.0 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3.0/3.0 MB 75.3 MB/s eta 0:00:00
Downloading colorlog-6.10.1-py3-none-any.whl (11 kB)
Downloading pyclipper-1.4.0-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (978 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 978.2/978.2 kB 75.8 MB/s eta 0:00:00
Downloading python_bidi-0.6.7-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (300 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 300.6/300.6 kB 33.9 MB/s eta 0:00:00
Downloading ruamel.yaml-0.18.16-py3-none-any.whl (119 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 119.9/119.9 kB 14.0 MB/s eta 0:00:00
Downloading ujson-5.11.0-cp312-cp312-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl (57 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 57.4/57.4 kB 6.7 MB/s eta 0:00:00
Downloading ruamel_yaml_clib-0.2.15-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (788 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 788.2/788.2 kB 57.6 MB/s eta 0:00:00
Downloading bce_python_sdk-0.9.55-py3-none-any.whl (390 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 390.5/390.5 kB 38.2 MB/s eta 0:00:00
Downloading pycryptodome-3.23.0-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.3 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2.3/2.3 MB 110.7 MB/s eta 0:00:00
Installing collected packages: python-bidi, ujson, ruamel.yaml.clib, PyYAML, pypdfium2, pycryptodome, pyclipper, opencv-contrib-python, colorlog, ruamel.yaml, modelscope, bce-python-sdk, aistudio-sdk, paddlex, paddleocr
  Attempting uninstall: PyYAML
    Found existing installation: PyYAML 6.0.3
    Uninstalling PyYAML-6.0.3:
      Successfully uninstalled PyYAML-6.0.3
  Attempting uninstall: opencv-contrib-python
    Found existing installation: opencv-contrib-python 4.12.0.88
    Uninstalling opencv-contrib-python-4.12.0.88:
      Successfully uninstalled opencv-contrib-python-4.12.0.88
Successfully installed PyYAML-6.0.2 aistudio-sdk-0.3.8 bce-python-sdk-0.9.55 colorlog-6.10.1 modelscope-1.33.0 opencv-contrib-python-4.10.0.84 paddleocr-3.3.2 paddlex-3.3.11 pyclipper-1.4.0 pycryptodome-3.23.0 pypdfium2-5.1.0 python-bidi-0.6.7 ruamel.yaml-0.18.16 ruamel.yaml.clib-0.2.15 ujson-5.11.0
Collecting pymupdf
  Downloading pymupdf-1.26.6-cp310-abi3-manylinux_2_28_x86_64.whl.metadata (3.4 kB)
Requirement already satisfied: pillow in /usr/local/lib/python3.12/dist-packages (11.3.0)
Downloading pymupdf-1.26.6-cp310-abi3-manylinux_2_28_x86_64.whl (24.1 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 24.1/24.1 MB 29.2 MB/s eta 0:00:00
Installing collected packages: pymupdf
Successfully installed pymupdf-1.26.6
Collecting paddlepaddle
  Downloading paddlepaddle-3.2.2-cp312-cp312-manylinux1_x86_64.whl.metadata (8.8 kB)
Requirement already satisfied: httpx in /usr/local/lib/python3.12/dist-packages (from paddlepaddle) (0.28.1)
Requirement already satisfied: numpy&gt;=1.21 in /usr/local/lib/python3.12/dist-packages (from paddlepaddle) (2.0.2)
Requirement already satisfied: protobuf&gt;=3.20.2 in /usr/local/lib/python3.12/dist-packages (from paddlepaddle) (5.29.5)
Requirement already satisfied: Pillow in /usr/local/lib/python3.12/dist-packages (from paddlepaddle) (11.3.0)
Collecting opt_einsum==3.3.0 (from paddlepaddle)
  Downloading opt_einsum-3.3.0-py3-none-any.whl.metadata (6.5 kB)
Requirement already satisfied: networkx in /usr/local/lib/python3.12/dist-packages (from paddlepaddle) (3.6)
Requirement already satisfied: typing_extensions in /usr/local/lib/python3.12/dist-packages (from paddlepaddle) (4.15.0)
Requirement already satisfied: safetensors&gt;=0.6.0 in /usr/local/lib/python3.12/dist-packages (from paddlepaddle) (0.7.0)
Requirement already satisfied: anyio in /usr/local/lib/python3.12/dist-packages (from httpx-&gt;paddlepaddle) (4.12.0)
Requirement already satisfied: certifi in /usr/local/lib/python3.12/dist-packages (from httpx-&gt;paddlepaddle) (2025.11.12)
Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.12/dist-packages (from httpx-&gt;paddlepaddle) (1.0.9)
Requirement already satisfied: idna in /usr/local/lib/python3.12/dist-packages (from httpx-&gt;paddlepaddle) (3.7)
Requirement already satisfied: h11&gt;=0.16 in /usr/local/lib/python3.12/dist-packages (from httpcore==1.*-&gt;httpx-&gt;paddlepaddle) (0.16.0)
Downloading paddlepaddle-3.2.2-cp312-cp312-manylinux1_x86_64.whl (189.3 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 189.3/189.3 MB 6.5 MB/s eta 0:00:00
Downloading opt_einsum-3.3.0-py3-none-any.whl (65 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 65.5/65.5 kB 6.9 MB/s eta 0:00:00
Installing collected packages: opt_einsum, paddlepaddle
  Attempting uninstall: opt_einsum
    Found existing installation: opt_einsum 3.4.0
    Uninstalling opt_einsum-3.4.0:
      Successfully uninstalled opt_einsum-3.4.0
Successfully installed opt_einsum-3.3.0 paddlepaddle-3.2.2</code></pre>
</div>
</div>
<div id="cell-4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="577784db-873c-4d6e-81d4-70a5d893b754">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install gdown</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: gdown in /usr/local/lib/python3.12/dist-packages (5.2.0)
Requirement already satisfied: beautifulsoup4 in /usr/local/lib/python3.12/dist-packages (from gdown) (4.13.5)
Requirement already satisfied: filelock in /usr/local/lib/python3.12/dist-packages (from gdown) (3.20.0)
Requirement already satisfied: requests[socks] in /usr/local/lib/python3.12/dist-packages (from gdown) (2.32.4)
Requirement already satisfied: tqdm in /usr/local/lib/python3.12/dist-packages (from gdown) (4.67.1)
Requirement already satisfied: soupsieve&gt;1.2 in /usr/local/lib/python3.12/dist-packages (from beautifulsoup4-&gt;gdown) (2.8)
Requirement already satisfied: typing-extensions&gt;=4.0.0 in /usr/local/lib/python3.12/dist-packages (from beautifulsoup4-&gt;gdown) (4.15.0)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from requests[socks]-&gt;gdown) (3.4.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from requests[socks]-&gt;gdown) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests[socks]-&gt;gdown) (2.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests[socks]-&gt;gdown) (2025.11.12)
Requirement already satisfied: PySocks!=1.5.7,&gt;=1.5.6 in /usr/local/lib/python3.12/dist-packages (from requests[socks]-&gt;gdown) (1.7.1)</code></pre>
</div>
</div>
<p><strong>Download the Dataset</strong></p>
<div id="cell-6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet gdown</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-7" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="4c953d84-45d1-44df-a78f-33e8e06138eb">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re, subprocess, shutil, os</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download_and_extract(link_or_id, dest<span class="op">=</span><span class="st">"Dataset"</span>):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.search(<span class="vs">r'id=</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, link_or_id) <span class="kw">or</span> re.search(<span class="vs">r'/d/</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, link_or_id)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> m:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Paste a valid Google Drive file link"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    fid <span class="op">=</span> m.group(<span class="dv">1</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Downloading zip..."</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f"https://drive.google.com/uc?id=</span><span class="sc">{</span>fid<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    subprocess.run([<span class="st">"gdown"</span>, url, <span class="st">"-O"</span>, <span class="st">"dataset.zip"</span>], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(dest):</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        shutil.rmtree(dest)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    os.makedirs(dest, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Extracting zip to folder..."</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    subprocess.run([<span class="st">"unzip"</span>, <span class="st">"-q"</span>, <span class="st">"dataset.zip"</span>, <span class="st">"-d"</span>, dest], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Done — check the local '</span><span class="sc">{</span>dest<span class="sc">}</span><span class="ss">' folder."</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> <span class="st">"https://drive.google.com/file/d/147pOV428WE6wdpvcL8uyNKm96LgBj3VF/view?usp=sharing"</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>download_and_extract(link, dest<span class="op">=</span><span class="st">"Dataset"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading zip...
Extracting zip to folder...
Done — check the local 'Dataset' folder.</code></pre>
</div>
</div>
<p><strong>Download the Weights of the RF-DETR</strong></p>
<div id="cell-9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet gdown</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-10" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="5ef1f722-f958-4202-e0d4-61e244a9c5f5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download_drive_to_weights(link_or_id):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    dest <span class="op">=</span> <span class="st">"weights"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    Path(dest).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Using '</span><span class="sc">{</span>dest<span class="sc">}</span><span class="ss">' folder for downloads..."</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">str</span>(link_or_id).strip()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.search(<span class="vs">r'folders/</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, s) <span class="kw">or</span> re.search(<span class="vs">r'id=</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, s)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> m:</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> re.search(<span class="vs">r'/d/</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, s) <span class="kw">or</span> re.search(<span class="vs">r'</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">{10,}</span><span class="kw">)</span><span class="dv">$</span><span class="vs">'</span>, s)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> m:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Couldn't parse an ID from the input. Please paste the folder link or the long '1...' id."</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    fid <span class="op">=</span> m.group(<span class="dv">1</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    use_folder <span class="op">=</span> (<span class="st">'folders'</span> <span class="kw">in</span> s) <span class="kw">or</span> (<span class="bu">len</span>(fid) <span class="op">&gt;</span> <span class="dv">20</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> use_folder:</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Downloading Drive folder to ./weights ..."</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            subprocess.run(</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                [<span class="st">"gdown"</span>, <span class="st">"--folder"</span>, <span class="ss">f"https://drive.google.com/drive/folders/</span><span class="sc">{</span>fid<span class="sc">}</span><span class="ss">"</span>, <span class="st">"-O"</span>, dest],</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                check<span class="op">=</span><span class="va">True</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Downloading file to ./weights ..."</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>            url <span class="op">=</span> <span class="ss">f"https://drive.google.com/uc?id=</span><span class="sc">{</span>fid<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            subprocess.run(</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                [<span class="st">"gdown"</span>, url, <span class="st">"-O"</span>, dest],</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                check<span class="op">=</span><span class="va">True</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Done — check the local 'weights' folder."</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> subprocess.CalledProcessError <span class="im">as</span> e:</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"gdown failed:"</span>, e)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    link_or_id <span class="op">=</span> <span class="st">"https://drive.google.com/drive/folders/17CXXFCGw5npR1cyrg082yq1IdcnH6-ms?usp=sharing"</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>download_drive_to_weights(link_or_id)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using 'weights' folder for downloads...
Downloading Drive folder to ./weights ...
Done — check the local 'weights' folder.</code></pre>
</div>
</div>
<p><strong>Clone the Sam2 Model</strong></p>
<div id="cell-12" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="5996e779-d121-40d5-a707-536326f9c9bb" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>git clone https:<span class="op">//</span>github.com<span class="op">/</span>facebookresearch<span class="op">/</span>sam2.git</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>e .</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cloning into 'sam2'...
remote: Enumerating objects: 1070, done.
remote: Total 1070 (delta 0), reused 0 (delta 0), pack-reused 1070 (from 1)
Receiving objects: 100% (1070/1070), 128.11 MiB | 11.61 MiB/s, done.
Resolving deltas: 100% (380/380), done.
Updating files: 100% (569/569), done.
/content/sam2
Obtaining file:///content/sam2
  Installing build dependencies ... done
  Checking if build backend supports build_editable ... done
  Getting requirements to build editable ... done
  Preparing editable metadata (pyproject.toml) ... done
Requirement already satisfied: torch&gt;=2.5.1 in /usr/local/lib/python3.12/dist-packages (from SAM-2==1.0) (2.9.0+cu126)
Requirement already satisfied: torchvision&gt;=0.20.1 in /usr/local/lib/python3.12/dist-packages (from SAM-2==1.0) (0.24.0+cu126)
Requirement already satisfied: numpy&gt;=1.24.4 in /usr/local/lib/python3.12/dist-packages (from SAM-2==1.0) (2.0.2)
Requirement already satisfied: tqdm&gt;=4.66.1 in /usr/local/lib/python3.12/dist-packages (from SAM-2==1.0) (4.67.1)
Collecting hydra-core&gt;=1.3.2 (from SAM-2==1.0)
  Downloading hydra_core-1.3.2-py3-none-any.whl.metadata (5.5 kB)
Collecting iopath&gt;=0.1.10 (from SAM-2==1.0)
  Downloading iopath-0.1.10.tar.gz (42 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 42.2/42.2 kB 4.6 MB/s eta 0:00:00
  Preparing metadata (setup.py) ... done
Requirement already satisfied: pillow&gt;=9.4.0 in /usr/local/lib/python3.12/dist-packages (from SAM-2==1.0) (11.3.0)
Requirement already satisfied: omegaconf&lt;2.4,&gt;=2.2 in /usr/local/lib/python3.12/dist-packages (from hydra-core&gt;=1.3.2-&gt;SAM-2==1.0) (2.3.0)
Requirement already satisfied: antlr4-python3-runtime==4.9.* in /usr/local/lib/python3.12/dist-packages (from hydra-core&gt;=1.3.2-&gt;SAM-2==1.0) (4.9.3)
Requirement already satisfied: packaging in /usr/local/lib/python3.12/dist-packages (from hydra-core&gt;=1.3.2-&gt;SAM-2==1.0) (25.0)
Requirement already satisfied: typing_extensions in /usr/local/lib/python3.12/dist-packages (from iopath&gt;=0.1.10-&gt;SAM-2==1.0) (4.15.0)
Collecting portalocker (from iopath&gt;=0.1.10-&gt;SAM-2==1.0)
  Downloading portalocker-3.2.0-py3-none-any.whl.metadata (8.7 kB)
Requirement already satisfied: filelock in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (3.20.0)
Requirement already satisfied: setuptools in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (75.2.0)
Requirement already satisfied: sympy&gt;=1.13.3 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (1.14.0)
Requirement already satisfied: networkx&gt;=2.5.1 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (3.6)
Requirement already satisfied: jinja2 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (3.1.6)
Requirement already satisfied: fsspec&gt;=0.8.5 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (2025.3.0)
Requirement already satisfied: nvidia-cuda-nvrtc-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (12.6.77)
Requirement already satisfied: nvidia-cuda-runtime-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (12.6.77)
Requirement already satisfied: nvidia-cuda-cupti-cu12==12.6.80 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (12.6.80)
Requirement already satisfied: nvidia-cudnn-cu12==9.10.2.21 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (9.10.2.21)
Requirement already satisfied: nvidia-cublas-cu12==12.6.4.1 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (12.6.4.1)
Requirement already satisfied: nvidia-cufft-cu12==11.3.0.4 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (11.3.0.4)
Requirement already satisfied: nvidia-curand-cu12==10.3.7.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (10.3.7.77)
Requirement already satisfied: nvidia-cusolver-cu12==11.7.1.2 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (11.7.1.2)
Requirement already satisfied: nvidia-cusparse-cu12==12.5.4.2 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (12.5.4.2)
Requirement already satisfied: nvidia-cusparselt-cu12==0.7.1 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (0.7.1)
Requirement already satisfied: nvidia-nccl-cu12==2.27.5 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (2.27.5)
Requirement already satisfied: nvidia-nvshmem-cu12==3.3.20 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (3.3.20)
Requirement already satisfied: nvidia-nvtx-cu12==12.6.77 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (12.6.77)
Requirement already satisfied: nvidia-nvjitlink-cu12==12.6.85 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (12.6.85)
Requirement already satisfied: nvidia-cufile-cu12==1.11.1.6 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (1.11.1.6)
Requirement already satisfied: triton==3.5.0 in /usr/local/lib/python3.12/dist-packages (from torch&gt;=2.5.1-&gt;SAM-2==1.0) (3.5.0)
Requirement already satisfied: PyYAML&gt;=5.1.0 in /usr/local/lib/python3.12/dist-packages (from omegaconf&lt;2.4,&gt;=2.2-&gt;hydra-core&gt;=1.3.2-&gt;SAM-2==1.0) (6.0.2)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /usr/local/lib/python3.12/dist-packages (from sympy&gt;=1.13.3-&gt;torch&gt;=2.5.1-&gt;SAM-2==1.0) (1.3.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /usr/local/lib/python3.12/dist-packages (from jinja2-&gt;torch&gt;=2.5.1-&gt;SAM-2==1.0) (3.0.3)
Downloading hydra_core-1.3.2-py3-none-any.whl (154 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 154.5/154.5 kB 15.6 MB/s eta 0:00:00
Downloading portalocker-3.2.0-py3-none-any.whl (22 kB)
Building wheels for collected packages: SAM-2, iopath
  Building editable for SAM-2 (pyproject.toml) ... done
  Created wheel for SAM-2: filename=sam_2-1.0-0.editable-cp312-cp312-linux_x86_64.whl size=13852 sha256=f87822b85d374b5db5dd1b43bd7b95cd61395b461bf2e45266cae9a65f542ff4
  Stored in directory: /tmp/pip-ephem-wheel-cache-hd59s1yu/wheels/9e/fa/17/14aaeb20d3ca07c58ee93742054d4479f89c243063ce0b61b9
  Building wheel for iopath (setup.py) ... done
  Created wheel for iopath: filename=iopath-0.1.10-py3-none-any.whl size=31527 sha256=650d2af9f6e79b48459227f4fe01035aac6dcc406f998403e66fe84cc26aabee
  Stored in directory: /root/.cache/pip/wheels/7c/96/04/4f5f31ff812f684f69f40cb1634357812220aac58d4698048c
Successfully built SAM-2 iopath
Installing collected packages: portalocker, iopath, hydra-core, SAM-2
Successfully installed SAM-2-1.0 hydra-core-1.3.2 iopath-0.1.10 portalocker-3.2.0</code></pre>
</div>
</div>
<div id="cell-13" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="2e67b9ef-2a1e-4ded-e4c6-4c0c867c2a12" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>/content</code></pre>
</div>
</div>
<p><strong>Downlaod the weights of angle models</strong></p>
<div id="cell-15" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="8a88f8e0-6a58-4ed9-a99b-9e67d18692a9" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet gdown</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download_and_extract_strip_top_folder(link_or_id, dest<span class="op">=</span><span class="st">"/content/angle-models-weights"</span>):</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.search(<span class="vs">r'id=</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, link_or_id) <span class="kw">or</span> re.search(<span class="vs">r'/d/</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, link_or_id)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> m:</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Paste a valid Google Drive file link"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    fid <span class="op">=</span> m.group(<span class="dv">1</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Downloading zip..."</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f"https://drive.google.com/uc?id=</span><span class="sc">{</span>fid<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(dest):</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        shutil.rmtree(dest)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    os.makedirs(dest)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    subprocess.run([<span class="st">"gdown"</span>, url, <span class="st">"-O"</span>, <span class="st">"weights.zip"</span>], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Extracting zip file and stripping top-level folder..."</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> zipfile.ZipFile(<span class="st">"weights.zip"</span>, <span class="st">'r'</span>) <span class="im">as</span> zip_ref:</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        all_paths <span class="op">=</span> zip_ref.namelist()</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        top_level_dirs <span class="op">=</span> <span class="bu">set</span>([p.split(<span class="st">'/'</span>)[<span class="dv">0</span>] <span class="cf">for</span> p <span class="kw">in</span> all_paths <span class="cf">if</span> p.strip() <span class="op">!=</span> <span class="st">''</span>])</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(top_level_dirs) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>            top_folder <span class="op">=</span> <span class="bu">list</span>(top_level_dirs)[<span class="dv">0</span>]</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>            top_folder <span class="op">=</span> <span class="va">None</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> member <span class="kw">in</span> all_paths:</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> top_folder:</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                rel_path <span class="op">=</span> member[<span class="bu">len</span>(top_folder)<span class="op">+</span><span class="dv">1</span>:] <span class="cf">if</span> member.startswith(top_folder <span class="op">+</span> <span class="st">'/'</span>) <span class="cf">else</span> member</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>                rel_path <span class="op">=</span> member</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rel_path <span class="op">==</span> <span class="st">''</span>:</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>            dest_path <span class="op">=</span> os.path.join(dest, rel_path)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> member.endswith(<span class="st">'/'</span>):</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>                os.makedirs(dest_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>                os.makedirs(os.path.dirname(dest_path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> zip_ref.<span class="bu">open</span>(member) <span class="im">as</span> source, <span class="bu">open</span>(dest_path, <span class="st">'wb'</span>) <span class="im">as</span> target:</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>                    shutil.copyfileobj(source, target)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Done — check the local '</span><span class="sc">{</span>dest<span class="sc">}</span><span class="ss">' folder."</span>)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> <span class="st">"https://drive.google.com/file/d/1uI2GlE5JviTJccZxzLP5lQ6YiwjYTvVe/view?usp=sharing"</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>download_and_extract_strip_top_folder(link, dest<span class="op">=</span><span class="st">"/content/angle-models-weights"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading zip...
Extracting zip file and stripping top-level folder...
Done — check the local '/content/angle-models-weights' folder.</code></pre>
</div>
</div>
<p><strong>Download the weights of sam2</strong></p>
<div id="cell-17" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="7068c69f-ba01-457b-f345-1f916d0a97ab" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download_file_from_gdrive(link_or_id, dest_folder<span class="op">=</span><span class="st">"/content/sam2/checkpoints"</span>, filename<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> re.search(<span class="vs">r'id=</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, link_or_id) <span class="kw">or</span> re.search(<span class="vs">r'/d/</span><span class="kw">(</span><span class="pp">[A-Za-z0-9_-]</span><span class="op">+</span><span class="kw">)</span><span class="vs">'</span>, link_or_id)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> m:</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Paste a valid Google Drive file link"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    fid <span class="op">=</span> m.group(<span class="dv">1</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(dest_folder):</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        os.makedirs(dest_folder)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> <span class="ss">f"https://drive.google.com/uc?id=</span><span class="sc">{</span>fid<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> filename:</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>fid<span class="sc">}</span><span class="ss">.pt"</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    file_path <span class="op">=</span> os.path.join(dest_folder, filename)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Downloading file to </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss"> ..."</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    subprocess.run([<span class="st">"gdown"</span>, url, <span class="st">"-O"</span>, file_path], check<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Download complete."</span>)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>link <span class="op">=</span> <span class="st">"https://drive.google.com/file/d/11L0iHZ1Ktcjhd0vqKI_3-PJ3DTv2UyOc/view?usp=sharing"</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>download_file_from_gdrive(link, dest_folder<span class="op">=</span><span class="st">"/content/sam2/checkpoints"</span>, filename<span class="op">=</span><span class="st">"sam2_hiera_base_plus.pt"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Downloading file to /content/sam2/checkpoints/sam2_hiera_base_plus.pt ...
Download complete.</code></pre>
</div>
</div>
</section>
<section id="rf-detr-model-for-shape-and-arrow-detection" class="level1">
<h1><strong>RF-DETR Model for shape and arrow detection</strong></h1>
<div id="cell-19" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dataset<span class="op">=</span><span class="st">'/content/Dataset/AiBoardScannerDataSet.coco'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Metric evaluation and ploting</p>
<div id="cell-21" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:648}}" data-outputid="24e00ea2-083e-4711-d572-2d98e6f7bfca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Image.<span class="bu">open</span>(<span class="st">"/content/weights/metrics_plot.png"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>path of the pre-train weights and path of the image to to check the shape detection</p>
<div id="cell-23" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>preTrainedWeights<span class="op">=</span><span class="st">"/content/weights/checkpoint_best_regular.pth"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-24" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="443e10dd-4eb2-4dae-bb75-7f74c3444705" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fitz</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"/content/Ai-diagrams-board-25-_jpg.rf.47ff3ffa292e044b3822c0c83022ee77.jpg"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>output_image_path <span class="op">=</span> <span class="st">"/content/converted_image.png"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>imgPath <span class="op">=</span> <span class="va">None</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(file_path):</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: File not found at </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> file_path.lower().endswith(<span class="st">'.pdf'</span>):</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>            doc <span class="op">=</span> fitz.<span class="bu">open</span>(file_path)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>            page <span class="op">=</span> doc.load_page(<span class="dv">0</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>            pix <span class="op">=</span> page.get_pixmap()</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>            pix.save(output_image_path)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>            imgPath <span class="op">=</span> Image.<span class="bu">open</span>(output_image_path).convert(<span class="st">"RGB"</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"PDF converted to image and saved successfully."</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>            doc.close()</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error converting PDF: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>            imgPath <span class="op">=</span> Image.<span class="bu">open</span>(file_path).convert(<span class="st">"RGB"</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Image loaded successfully."</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error opening image: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Image loaded successfully.</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}}" data-outputid="8cb9d4e6-6863-4598-9042-27b5df6deaa5" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> supervision <span class="im">as</span> sv</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rfdetr <span class="im">import</span> RFDETRMedium</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rfdetr.util.coco_classes <span class="im">import</span> COCO_CLASSES</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RFDETRMedium(pretrain_weights<span class="op">=</span>preTrainedWeights)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>model.optimize_for_inference()</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> imgPath</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>detections <span class="op">=</span> model.predict(image, threshold<span class="op">=</span><span class="fl">0.60</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>text_scale <span class="op">=</span> sv.calculate_optimal_text_scale(image.size)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>thickness <span class="op">=</span> sv.calculate_optimal_line_thickness(image.size)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>color <span class="op">=</span> sv.ColorPalette.from_hex([</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#FFFF00"</span>, <span class="st">"#FF9B00"</span>, <span class="st">"#FF66FF"</span>, <span class="st">"#3399FF"</span>, <span class="st">"#FF66B2"</span>, <span class="st">"#FF8080"</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#B266FF"</span>, <span class="st">"#9999FF"</span>, <span class="st">"#66FFFF"</span>, <span class="st">"#33FF99"</span>, <span class="st">"#66FF66"</span>, <span class="st">"#99FF00"</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>bbox_annotator <span class="op">=</span> sv.BoxAnnotator(color<span class="op">=</span>color, thickness<span class="op">=</span>thickness)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>label_annotator <span class="op">=</span> sv.LabelAnnotator(color<span class="op">=</span>color, text_color<span class="op">=</span>sv.Color.BLACK, text_scale<span class="op">=</span>text_scale)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>my_classes <span class="op">=</span> [</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"objects"</span>,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cloud"</span>,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Diamond"</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Double Arrow"</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pentagon"</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Racetrack"</span>,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Star"</span>,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Sticky Notes"</span>,</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Triangle"</span>,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"arrow"</span>,</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"arrow_head"</span>,</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"circle"</span>,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dashed-arrow"</span>,</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"dotted-arrow"</span>,</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rectangle"</span>,</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rounded rectangle"</span>,</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"solid-arrow"</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>detection_labels <span class="op">=</span> [</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>my_classes[class_id]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>conf<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> class_id, conf <span class="kw">in</span> <span class="bu">zip</span>(detections.class_id, detections.confidence)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>detections_list<span class="op">=</span>[]</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bbox, class_id, conf <span class="kw">in</span> <span class="bu">zip</span>(detections.xyxy, detections.class_id, detections.confidence):</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>    x_min, y_min, x_max, y_max <span class="op">=</span> bbox</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>    class_name <span class="op">=</span> my_classes[class_id]</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>    detection_tuple <span class="op">=</span> (class_name, (<span class="bu">float</span>(x_min), <span class="bu">float</span>(y_min)), (<span class="bu">float</span>(x_max), <span class="bu">float</span>(y_max)))</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>    detections_list.append(detection_tuple)</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"detections = ["</span>)</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> detections_list:</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    </span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">,"</span>)</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"]"</span>)</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>annotated_image <span class="op">=</span> image.copy()</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>annotated_image <span class="op">=</span> bbox_annotator.annotate(annotated_image, detections)</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>annotated_image <span class="op">=</span> label_annotator.annotate(annotated_image, detections, detection_labels)</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>sv.plot_image(annotated_image)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: Please use the new API settings to control TF32 behavior, such as torch.backends.cudnn.conv.fp32_precision = 'tf32' or torch.backends.cuda.matmul.fp32_precision = 'ieee'. Old settings, e.g, torch.backends.cuda.matmul.allow_tf32 = True, torch.backends.cudnn.allow_tf32 = True, allowTF32CuDNN() and allowTF32CuBLAS() will be deprecated after Pytorch 2.9. Please see https://pytorch.org/docs/main/notes/cuda.html#tensorfloat-32-tf32-on-ampere-and-later-devices (Triggered internally at /pytorch/aten/src/ATen/Context.cpp:80.)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Using a different number of positional encodings than DINOv2, which means we're not loading DINOv2 backbone weights. This is not a problem if finetuning a pretrained RF-DETR model.
Using patch size 16 instead of 14, which means we're not loading DINOv2 backbone weights. This is not a problem if finetuning a pretrained RF-DETR model.
Loading pretrain weights</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING:rfdetr.main:num_classes mismatch: pretrain weights has 16 classes, but your model has 90 classes
reinitializing detection head with 16 classes
`loss_type=None` was set in the config but it is unrecognized. Using the default loss: `ForCausalLMLoss`.
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: torch.as_tensor results are registered as constants in the trace. You can safely ignore this warning if you use this function to create tensors out of constant variables that would be the same every time you call this function. In any other case, this might cause the trace to be incorrect.
TracerWarning: Iterating over a tensor might cause the trace to be incorrect. Passing a tensor of different shape won't change the number of iterations executed (and might lead to errors or silently give incorrect results).
TracerWarning: torch.tensor results are registered as constants in the trace. You can safely ignore this warning if you use this function to create tensors out of constant variables that would be the same every time you call this function. In any other case, this might cause the trace to be incorrect.
TracerWarning: torch.tensor results are registered as constants in the trace. You can safely ignore this warning if you use this function to create tensors out of constant variables that would be the same every time you call this function. In any other case, this might cause the trace to be incorrect.
UserWarning: torch.meshgrid: in an upcoming release, it will be required to pass the indexing argument. (Triggered internally at /pytorch/aten/src/ATen/native/TensorShape.cpp:4317.)
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Iterating over a tensor might cause the trace to be incorrect. Passing a tensor of different shape won't change the number of iterations executed (and might lead to errors or silently give incorrect results).
TracerWarning: Iterating over a tensor might cause the trace to be incorrect. Passing a tensor of different shape won't change the number of iterations executed (and might lead to errors or silently give incorrect results).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>detections = [
    ('Racetrack', (525.43798828125, 337.20953369140625), (772.7925415039062, 731.5386962890625)),
    ('circle', (75.26021575927734, 353.7659912109375), (211.26466369628906, 485.6578369140625)),
    ('Pentagon', (197.82093811035156, 192.63380432128906), (629.0830688476562, 607.8374633789062)),
    ('Racetrack', (399.3763732910156, 37.14316940307617), (734.2215576171875, 357.04290771484375)),
    ('circle', (191.36500549316406, 624.5045776367188), (327.5169677734375, 757.7999877929688)),
    ('circle', (540.4708862304688, 566.7578735351562), (676.06787109375, 699.739501953125)),
    ('Racetrack', (91.32276916503906, 34.96403884887695), (442.41143798828125, 351.8035888671875)),
    ('circle', (579.9710083007812, 197.84326171875), (715.2356567382812, 331.45751953125)),
    ('circle', (289.7023010253906, 63.5079460144043), (423.3017883300781, 196.29493713378906)),
    ('Racetrack', (181.86737060546875, 609.5239868164062), (572.858642578125, 773.0011596679688)),
    ('Racetrack', (57.61482620239258, 337.6130676269531), (306.7226257324219, 737.0006103515625)),
]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Convert Co-ordinates of detected objects into JSON</strong></p>
<div id="cell-27" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="7a90a4d2-49b4-4331-d6f3-116d50e4e3a1" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>detected_objects <span class="op">=</span> []</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> class_id, conf, bbox <span class="kw">in</span> <span class="bu">zip</span>(detections.class_id, detections.confidence, detections.xyxy):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    x1, y1, x2, y2 <span class="op">=</span> bbox.tolist()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    detected_objects.append({</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"class"</span>: my_classes[class_id],</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"confidence"</span>: <span class="bu">float</span>(conf),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bbox"</span>: {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x1"</span>: <span class="bu">float</span>(x1),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y1"</span>: <span class="bu">float</span>(y1),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x2"</span>: <span class="bu">float</span>(x2),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y2"</span>: <span class="bu">float</span>(y2)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(detected_objects, indent<span class="op">=</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[
  {
    "class": "Diamond",
    "confidence": 0.9714662432670593,
    "bbox": {
      "x1": 29.127370834350586,
      "y1": 407.62640380859375,
      "x2": 239.15098571777344,
      "y2": 544.3034057617188
    }
  },
  {
    "class": "Diamond",
    "confidence": 0.9698772430419922,
    "bbox": {
      "x1": 28.874351501464844,
      "y1": 227.95535278320312,
      "x2": 238.50436401367188,
      "y2": 363.88623046875
    }
  },
  {
    "class": "Racetrack",
    "confidence": 0.9692795872688293,
    "bbox": {
      "x1": 384.4695739746094,
      "y1": 255.876953125,
      "x2": 697.0001220703125,
      "y2": 361.5684509277344
    }
  },
  {
    "class": "Diamond",
    "confidence": 0.9654581546783447,
    "bbox": {
      "x1": 29.296884536743164,
      "y1": 47.461517333984375,
      "x2": 238.36622619628906,
      "y2": 183.186767578125
    }
  },
  {
    "class": "Triangle",
    "confidence": 0.9631335139274597,
    "bbox": {
      "x1": 844.4630737304688,
      "y1": 72.72488403320312,
      "x2": 1027.826416015625,
      "y2": 192.2169952392578
    }
  },
  {
    "class": "Triangle",
    "confidence": 0.96173495054245,
    "bbox": {
      "x1": 844.9676513671875,
      "y1": 233.00119018554688,
      "x2": 1028.5804443359375,
      "y2": 353.65087890625
    }
  },
  {
    "class": "solid-arrow",
    "confidence": 0.9547531008720398,
    "bbox": {
      "x1": 694.0907592773438,
      "y1": 131.23728942871094,
      "x2": 886.1165771484375,
      "y2": 313.0189208984375
    }
  },
  {
    "class": "solid-arrow",
    "confidence": 0.9540013074874878,
    "bbox": {
      "x1": 698.8170166015625,
      "y1": 304.6488037109375,
      "x2": 886.5786743164062,
      "y2": 482.6002197265625
    }
  },
  {
    "class": "Triangle",
    "confidence": 0.9502191543579102,
    "bbox": {
      "x1": 843.9762573242188,
      "y1": 394.875732421875,
      "x2": 1028.1793212890625,
      "y2": 514.8218383789062
    }
  },
  {
    "class": "solid-arrow",
    "confidence": 0.9406890869140625,
    "bbox": {
      "x1": 242.09933471679688,
      "y1": 303.71929931640625,
      "x2": 382.69677734375,
      "y2": 490.77899169921875
    }
  },
  {
    "class": "solid-arrow",
    "confidence": 0.9405144453048706,
    "bbox": {
      "x1": 242.72161865234375,
      "y1": 101.90926361083984,
      "x2": 385.8294372558594,
      "y2": 311.9975280761719
    }
  },
  {
    "class": "solid-arrow",
    "confidence": 0.8978973627090454,
    "bbox": {
      "x1": 697.5059814453125,
      "y1": 293.218994140625,
      "x2": 883.3981323242188,
      "y2": 330.16082763671875
    }
  },
  {
    "class": "solid-arrow",
    "confidence": 0.8837128281593323,
    "bbox": {
      "x1": 243.73397827148438,
      "y1": 281.9586181640625,
      "x2": 383.1846618652344,
      "y2": 313.9234619140625
    }
  },
  {
    "class": "arrow_head",
    "confidence": 0.8148650527000427,
    "bbox": {
      "x1": 243.56497192382812,
      "y1": 281.25982666015625,
      "x2": 270.8069152832031,
      "y2": 311.5813293457031
    }
  },
  {
    "class": "arrow_head",
    "confidence": 0.8067644238471985,
    "bbox": {
      "x1": 243.93441772460938,
      "y1": 462.5649719238281,
      "x2": 272.4416809082031,
      "y2": 490.833251953125
    }
  },
  {
    "class": "arrow_head",
    "confidence": 0.795447051525116,
    "bbox": {
      "x1": 862.6205444335938,
      "y1": 292.51361083984375,
      "x2": 885.913818359375,
      "y2": 316.01947021484375
    }
  },
  {
    "class": "arrow_head",
    "confidence": 0.7893730401992798,
    "bbox": {
      "x1": 243.89553833007812,
      "y1": 101.54055786132812,
      "x2": 271.93878173828125,
      "y2": 131.6016845703125
    }
  },
  {
    "class": "arrow_head",
    "confidence": 0.782149612903595,
    "bbox": {
      "x1": 866.0701293945312,
      "y1": 454.7251281738281,
      "x2": 886.1697387695312,
      "y2": 480.5311584472656
    }
  },
  {
    "class": "arrow_head",
    "confidence": 0.7689226865768433,
    "bbox": {
      "x1": 863.8754272460938,
      "y1": 130.90518188476562,
      "x2": 886.8487548828125,
      "y2": 155.73548889160156
    }
  }
]</code></pre>
</div>
</div>
</section>
<section id="paddle-ocr" class="level1">
<h1><strong>Paddle OCR</strong></h1>
<p><strong>saved the output in the OCRoutput folder after applying the OCR:</strong> 1. first image saved by after applying the ocr 2. second saved the response in the JSON format of the OCR applied image.</p>
<div id="cell-30" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}}" data-outputid="f63e599f-16b4-40c9-8008-1f57b405fa05" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pip install langchain<span class="op">==</span><span class="fl">0.0.350</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collecting langchain==0.0.350
  Downloading langchain-0.0.350-py3-none-any.whl.metadata (13 kB)
Requirement already satisfied: PyYAML&gt;=5.3 in /usr/local/lib/python3.12/dist-packages (from langchain==0.0.350) (6.0.2)
Requirement already satisfied: SQLAlchemy&lt;3,&gt;=1.4 in /usr/local/lib/python3.12/dist-packages (from langchain==0.0.350) (2.0.44)
Requirement already satisfied: aiohttp&lt;4.0.0,&gt;=3.8.3 in /usr/local/lib/python3.12/dist-packages (from langchain==0.0.350) (3.13.2)
Collecting dataclasses-json&lt;0.7,&gt;=0.5.7 (from langchain==0.0.350)
  Downloading dataclasses_json-0.6.7-py3-none-any.whl.metadata (25 kB)
Requirement already satisfied: jsonpatch&lt;2.0,&gt;=1.33 in /usr/local/lib/python3.12/dist-packages (from langchain==0.0.350) (1.33)
Collecting langchain-community&lt;0.1,&gt;=0.0.2 (from langchain==0.0.350)
  Downloading langchain_community-0.0.38-py3-none-any.whl.metadata (8.7 kB)
Collecting langchain-core&lt;0.2,&gt;=0.1 (from langchain==0.0.350)
  Downloading langchain_core-0.1.53-py3-none-any.whl.metadata (5.9 kB)
Collecting langsmith&lt;0.1.0,&gt;=0.0.63 (from langchain==0.0.350)
  Downloading langsmith-0.0.92-py3-none-any.whl.metadata (9.9 kB)
Collecting numpy&lt;2,&gt;=1 (from langchain==0.0.350)
  Downloading numpy-1.26.4-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (61 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 61.0/61.0 kB 6.9 MB/s eta 0:00:00
Requirement already satisfied: pydantic&lt;3,&gt;=1 in /usr/local/lib/python3.12/dist-packages (from langchain==0.0.350) (2.12.3)
Requirement already satisfied: requests&lt;3,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from langchain==0.0.350) (2.32.4)
Collecting tenacity&lt;9.0.0,&gt;=8.1.0 (from langchain==0.0.350)
  Downloading tenacity-8.5.0-py3-none-any.whl.metadata (1.2 kB)
Requirement already satisfied: aiohappyeyeballs&gt;=2.5.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain==0.0.350) (2.6.1)
Requirement already satisfied: aiosignal&gt;=1.4.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain==0.0.350) (1.4.0)
Requirement already satisfied: attrs&gt;=17.3.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain==0.0.350) (25.4.0)
Requirement already satisfied: frozenlist&gt;=1.1.1 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain==0.0.350) (1.8.0)
Requirement already satisfied: multidict&lt;7.0,&gt;=4.5 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain==0.0.350) (6.7.0)
Requirement already satisfied: propcache&gt;=0.2.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain==0.0.350) (0.4.1)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.17.0 in /usr/local/lib/python3.12/dist-packages (from aiohttp&lt;4.0.0,&gt;=3.8.3-&gt;langchain==0.0.350) (1.22.0)
Collecting marshmallow&lt;4.0.0,&gt;=3.18.0 (from dataclasses-json&lt;0.7,&gt;=0.5.7-&gt;langchain==0.0.350)
  Downloading marshmallow-3.26.1-py3-none-any.whl.metadata (7.3 kB)
Collecting typing-inspect&lt;1,&gt;=0.4.0 (from dataclasses-json&lt;0.7,&gt;=0.5.7-&gt;langchain==0.0.350)
  Downloading typing_inspect-0.9.0-py3-none-any.whl.metadata (1.5 kB)
Requirement already satisfied: jsonpointer&gt;=1.9 in /usr/local/lib/python3.12/dist-packages (from jsonpatch&lt;2.0,&gt;=1.33-&gt;langchain==0.0.350) (3.0.0)
INFO: pip is looking at multiple versions of langchain-community to determine which version is compatible with other requirements. This could take a while.
Collecting langchain-community&lt;0.1,&gt;=0.0.2 (from langchain==0.0.350)
  Downloading langchain_community-0.0.37-py3-none-any.whl.metadata (8.7 kB)
  Downloading langchain_community-0.0.36-py3-none-any.whl.metadata (8.7 kB)
  Downloading langchain_community-0.0.35-py3-none-any.whl.metadata (8.7 kB)
  Downloading langchain_community-0.0.34-py3-none-any.whl.metadata (8.5 kB)
  Downloading langchain_community-0.0.33-py3-none-any.whl.metadata (8.5 kB)
  Downloading langchain_community-0.0.32-py3-none-any.whl.metadata (8.5 kB)
  Downloading langchain_community-0.0.31-py3-none-any.whl.metadata (8.4 kB)
INFO: pip is still looking at multiple versions of langchain-community to determine which version is compatible with other requirements. This could take a while.
  Downloading langchain_community-0.0.30-py3-none-any.whl.metadata (8.4 kB)
  Downloading langchain_community-0.0.29-py3-none-any.whl.metadata (8.3 kB)
  Downloading langchain_community-0.0.28-py3-none-any.whl.metadata (8.3 kB)
  Downloading langchain_community-0.0.27-py3-none-any.whl.metadata (8.2 kB)
  Downloading langchain_community-0.0.26-py3-none-any.whl.metadata (8.2 kB)
INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. See https://pip.pypa.io/warnings/backtracking for guidance. If you want to abort this run, press Ctrl + C.
  Downloading langchain_community-0.0.25-py3-none-any.whl.metadata (8.1 kB)
  Downloading langchain_community-0.0.24-py3-none-any.whl.metadata (8.1 kB)
  Downloading langchain_community-0.0.23-py3-none-any.whl.metadata (8.1 kB)
  Downloading langchain_community-0.0.22-py3-none-any.whl.metadata (8.1 kB)
  Downloading langchain_community-0.0.21-py3-none-any.whl.metadata (8.1 kB)
  Downloading langchain_community-0.0.20-py3-none-any.whl.metadata (8.1 kB)
INFO: pip is looking at multiple versions of langchain-core to determine which version is compatible with other requirements. This could take a while.
Collecting langchain-core&lt;0.2,&gt;=0.1 (from langchain==0.0.350)
  Downloading langchain_core-0.1.52-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.51-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.50-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.49-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.48-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.47-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.46-py3-none-any.whl.metadata (5.9 kB)
INFO: pip is still looking at multiple versions of langchain-core to determine which version is compatible with other requirements. This could take a while.
  Downloading langchain_core-0.1.45-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.44-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.43-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.42-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.41-py3-none-any.whl.metadata (5.9 kB)
INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. See https://pip.pypa.io/warnings/backtracking for guidance. If you want to abort this run, press Ctrl + C.
  Downloading langchain_core-0.1.40-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.39-py3-none-any.whl.metadata (5.9 kB)
  Downloading langchain_core-0.1.38-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.37-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.36-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.35-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.34-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.33-py3-none-any.whl.metadata (6.0 kB)
Requirement already satisfied: anyio&lt;5,&gt;=3 in /usr/local/lib/python3.12/dist-packages (from langchain-core&lt;0.2,&gt;=0.1-&gt;langchain==0.0.350) (4.12.0)
  Downloading langchain_core-0.1.32-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.31-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.30-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.29-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.28-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.27-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.26-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.25-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.24-py3-none-any.whl.metadata (6.0 kB)
  Downloading langchain_core-0.1.23-py3-none-any.whl.metadata (6.0 kB)
Collecting langsmith&lt;0.1.0,&gt;=0.0.63 (from langchain==0.0.350)
  Downloading langsmith-0.0.87-py3-none-any.whl.metadata (10 kB)
Collecting packaging&lt;24.0,&gt;=23.2 (from langchain-core&lt;0.2,&gt;=0.1-&gt;langchain==0.0.350)
  Downloading packaging-23.2-py3-none-any.whl.metadata (3.2 kB)
Requirement already satisfied: annotated-types&gt;=0.6.0 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=1-&gt;langchain==0.0.350) (0.7.0)
Requirement already satisfied: pydantic-core==2.41.4 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=1-&gt;langchain==0.0.350) (2.41.4)
Requirement already satisfied: typing-extensions&gt;=4.14.1 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=1-&gt;langchain==0.0.350) (4.15.0)
Requirement already satisfied: typing-inspection&gt;=0.4.2 in /usr/local/lib/python3.12/dist-packages (from pydantic&lt;3,&gt;=1-&gt;langchain==0.0.350) (0.4.2)
Requirement already satisfied: charset_normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain==0.0.350) (3.4.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain==0.0.350) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain==0.0.350) (2.5.0)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.12/dist-packages (from requests&lt;3,&gt;=2-&gt;langchain==0.0.350) (2025.11.12)
Requirement already satisfied: greenlet&gt;=1 in /usr/local/lib/python3.12/dist-packages (from SQLAlchemy&lt;3,&gt;=1.4-&gt;langchain==0.0.350) (3.3.0)
Collecting mypy-extensions&gt;=0.3.0 (from typing-inspect&lt;1,&gt;=0.4.0-&gt;dataclasses-json&lt;0.7,&gt;=0.5.7-&gt;langchain==0.0.350)
  Downloading mypy_extensions-1.1.0-py3-none-any.whl.metadata (1.1 kB)
Downloading langchain-0.0.350-py3-none-any.whl (809 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 809.1/809.1 kB 48.7 MB/s eta 0:00:00
Downloading dataclasses_json-0.6.7-py3-none-any.whl (28 kB)
Downloading langchain_community-0.0.20-py3-none-any.whl (1.7 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.7/1.7 MB 89.1 MB/s eta 0:00:00
Downloading langchain_core-0.1.23-py3-none-any.whl (241 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 241.2/241.2 kB 30.2 MB/s eta 0:00:00
Downloading langsmith-0.0.87-py3-none-any.whl (55 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 55.4/55.4 kB 7.0 MB/s eta 0:00:00
Downloading numpy-1.26.4-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (18.0 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 18.0/18.0 MB 100.2 MB/s eta 0:00:00
Downloading tenacity-8.5.0-py3-none-any.whl (28 kB)
Downloading marshmallow-3.26.1-py3-none-any.whl (50 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 50.9/50.9 kB 6.1 MB/s eta 0:00:00
Downloading packaging-23.2-py3-none-any.whl (53 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 53.0/53.0 kB 5.7 MB/s eta 0:00:00
Downloading typing_inspect-0.9.0-py3-none-any.whl (8.8 kB)
Downloading mypy_extensions-1.1.0-py3-none-any.whl (5.0 kB)
Installing collected packages: tenacity, packaging, numpy, mypy-extensions, typing-inspect, marshmallow, langsmith, dataclasses-json, langchain-core, langchain-community, langchain
  Attempting uninstall: tenacity
    Found existing installation: tenacity 9.1.2
    Uninstalling tenacity-9.1.2:
      Successfully uninstalled tenacity-9.1.2
  Attempting uninstall: packaging
    Found existing installation: packaging 25.0
    Uninstalling packaging-25.0:
      Successfully uninstalled packaging-25.0
  Attempting uninstall: numpy
    Found existing installation: numpy 2.0.2
    Uninstalling numpy-2.0.2:
      Successfully uninstalled numpy-2.0.2
  Attempting uninstall: langsmith
    Found existing installation: langsmith 0.4.55
    Uninstalling langsmith-0.4.55:
      Successfully uninstalled langsmith-0.4.55
  Attempting uninstall: langchain-core
    Found existing installation: langchain-core 1.1.1
    Uninstalling langchain-core-1.1.1:
      Successfully uninstalled langchain-core-1.1.1
  Attempting uninstall: langchain
    Found existing installation: langchain 1.1.2
    Uninstalling langchain-1.1.2:
      Successfully uninstalled langchain-1.1.2
ERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
shap 0.50.0 requires numpy&gt;=2, but you have numpy 1.26.4 which is incompatible.
jaxlib 0.7.2 requires numpy&gt;=2.0, but you have numpy 1.26.4 which is incompatible.
opencv-python 4.12.0.88 requires numpy&lt;2.3.0,&gt;=2; python_version &gt;= "3.9", but you have numpy 1.26.4 which is incompatible.
langgraph-checkpoint 3.0.1 requires langchain-core&gt;=0.2.38, but you have langchain-core 0.1.23 which is incompatible.
google-cloud-bigquery 3.38.0 requires packaging&gt;=24.2.0, but you have packaging 23.2 which is incompatible.
pytensor 2.35.1 requires numpy&gt;=2.0, but you have numpy 1.26.4 which is incompatible.
jax 0.7.2 requires numpy&gt;=2.0, but you have numpy 1.26.4 which is incompatible.
xarray 2025.11.0 requires packaging&gt;=24.1, but you have packaging 23.2 which is incompatible.
google-adk 1.20.0 requires tenacity&lt;10.0.0,&gt;=9.0.0, but you have tenacity 8.5.0 which is incompatible.
langgraph-prebuilt 1.0.5 requires langchain-core&gt;=1.0.0, but you have langchain-core 0.1.23 which is incompatible.
db-dtypes 1.4.4 requires packaging&gt;=24.2.0, but you have packaging 23.2 which is incompatible.
Successfully installed dataclasses-json-0.6.7 langchain-0.0.350 langchain-community-0.0.20 langchain-core-0.1.23 langsmith-0.0.87 marshmallow-3.26.1 mypy-extensions-1.1.0 numpy-1.26.4 packaging-23.2 tenacity-8.5.0 typing-inspect-0.9.0</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.colab-display-data+json</code></pre>
</div>
</div>
<div id="cell-31" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000,&quot;referenced_widgets&quot;:[&quot;79c3ca75da8d49f2b4f3d5302f36c149&quot;,&quot;5639865690854308b54749d32f3c2b47&quot;,&quot;5a61b2a3c2ac406a9e0d8fc6ad1eb59c&quot;,&quot;c09ed3c50fc44b64865a77b3c40b8470&quot;,&quot;3a1e729c40ca44e8b75ea6132ea8528d&quot;,&quot;8ece56f7e0e94a95ac3f704a4f76ecf0&quot;,&quot;998203b341dc436fa3f659809eba0278&quot;,&quot;10e072baa06749a4b8db8f670378e0cc&quot;,&quot;f934a7b4e49445fbb16e111fb80eaaf1&quot;,&quot;73a7c503c5f744ada8ffe95ed44359b5&quot;,&quot;1117185b10f246faac1db84d45886e16&quot;,&quot;cb3ff3ebe1304e4a8e7b0c38ddaa6683&quot;,&quot;6421e869cbd441f88b5f2cc85ed33215&quot;,&quot;cdf5891ce978439bb687e968107b3573&quot;,&quot;50afe8fac96b428e9e936808148bb578&quot;,&quot;98a998958dd3418bbd38592e513f8129&quot;,&quot;8c95799a9c8242a5bd0be509983dcd49&quot;,&quot;0aeb8a7e38fe4be4981c3e5fa6a52f69&quot;,&quot;61ac88de585e4970a100d741a1eeaafa&quot;,&quot;4ec7dab16c19425b99d0b84760bf8a67&quot;,&quot;614d054a84a54168938b67b8eac713f7&quot;,&quot;09fc5caf1d034507a93d5601c2212b55&quot;,&quot;2c5d9baa090a491fa2bff1ae27e709ac&quot;,&quot;aa84b3e1f83f4a9297fd7fcd380e0496&quot;,&quot;456d170224824c738857c4f476646ba8&quot;,&quot;a7bc76bcdde347d4bf1cd3e4c18e54ff&quot;,&quot;097b03966f014abc9b79a6ca720ea77e&quot;,&quot;a8b240a2ae964f04a6ff5ecfc88cba15&quot;,&quot;c7a36c03a0f94d0cb9faeada14902c9b&quot;,&quot;3f1f8297279041fe8d2b286172b96604&quot;,&quot;e040ab8599274e7aa1d176720d723def&quot;,&quot;e4cff2c412ec492682522e23da8f43d5&quot;,&quot;5509af07920e4e1b9023f1e6ce4130a1&quot;,&quot;cc3ac06b54ac46ddb6859c9f9d09e03c&quot;,&quot;2c303baea1b54965ba9f3411a1e535ba&quot;,&quot;e83b4ca5664f4c379a325311d6f8c11e&quot;,&quot;2c5259b4f30d4f0688acb6de3dd98699&quot;,&quot;834e9f41f95f48d892ef8e59c03ee459&quot;,&quot;25f736bb4fb64974af024c1e72c310f3&quot;,&quot;e2133f8dad514169b14ec8c1121a47d6&quot;,&quot;9d56c6165be94ff9b68c4db5052d7f23&quot;,&quot;56d2b8f79a48427f9ff09320d7351f80&quot;,&quot;5ef171d5545b46f18d678c22dcb662d7&quot;,&quot;e14a5126553d402fa6d7b8f53b403372&quot;,&quot;3c740f098f424d59b1c09db62cba92a9&quot;,&quot;16f13af8abc243f684446c88f30fa486&quot;,&quot;0d659a8c080e413a9cbebfb203b1c7d6&quot;,&quot;ad89773ab6384279b39714c39ad492af&quot;,&quot;76a217b001f24a91b91585933e4a59ea&quot;,&quot;804d093be895418e971ade79192b4de7&quot;,&quot;4890f6083c77451aa5bbe964f057fe7e&quot;,&quot;e3288590341c4f92a39c88803d6df5ce&quot;,&quot;124c8f730877463d9a677a90a11b3b92&quot;,&quot;772fe20c73764f5795545685b6122533&quot;,&quot;1fc9bc5b6f934113b19e23270cfcde9d&quot;,&quot;e2f427b08bad4c6a84326715ffc2e852&quot;,&quot;7af5bf3348914a97b75304aeaf47cca9&quot;,&quot;ab023fb9eb4248388367f40085175000&quot;,&quot;a8bfddf5aa254214ac9ea6779c4fe481&quot;,&quot;f6f80133ca0a4b43b1d1043b250eb7b8&quot;,&quot;46fa7e47dde6481d91bcfb1322e731f1&quot;,&quot;5768bcf3685b4d10a30386ef7cdccf7c&quot;,&quot;5b209758a73049f1b88ca5b4b90ebbab&quot;,&quot;c84cd6f88d0748f3ad07082e2a840296&quot;,&quot;8586a5761f154bd486cb13c5d6019fe4&quot;,&quot;adcc0d8880444c42a8f4776e4cc9b52e&quot;,&quot;241a8edd15ce4c84bed2c3bf5f9946ed&quot;,&quot;bcc4a1b6f92641809536cf66ab1db46c&quot;,&quot;52c4b3ce30c64b6595375d9b29720648&quot;,&quot;70a4d167b3d1469e814bce41d7543ef7&quot;,&quot;4d5969d8bd46415bbd06ff01f8c4dfee&quot;,&quot;37c1155a03d04cb0a12686ec5182ca4b&quot;,&quot;4beb7e042cc3422da0ec66852db9e72f&quot;,&quot;a34d40a985c646c1a4452a3020bb9dd4&quot;,&quot;88f29070973744759dc4b8506a0b2c47&quot;,&quot;21c847635d9f48369ba3a6b0c8681966&quot;,&quot;ac82514c28b54fa4ad15140ce9941012&quot;,&quot;2f316d61a0a342b8b175d79bbf84d09d&quot;,&quot;0aa471a391ef4b57ab1f276d79c0b0f6&quot;,&quot;f19abbed4fad4650b852ec92e7a31240&quot;,&quot;ee2ab28372074c96ac9bf18656f6db81&quot;,&quot;0cc326e95e79452185f65ee207d4fb75&quot;,&quot;6ffbb0e5731d42babad913e256bc5ff4&quot;,&quot;a7ddd47b133f4a68b345b98049249b19&quot;,&quot;0a9785fda6564ee98b84e15e042b1bc1&quot;,&quot;0364ae9c5d254e5bb4f7226b4dfa7fa0&quot;,&quot;0e52e7b5691d40169beafd63127bd51d&quot;,&quot;dd36edbde0e84773916f0e3b2b2418ee&quot;,&quot;cc553674c23f46dbaad49ba3292ea0e6&quot;,&quot;55e9f2465f754486b3e3f49b7f952508&quot;,&quot;1b6da8fc01a541428c10029f2b2da400&quot;,&quot;9f855befda2a407f83f0e4f2ef1f4f58&quot;,&quot;d5ba3c097c144df5a11d1e4e1fae37a9&quot;,&quot;e9f955c0d2a04e03a1122a8c43fd984f&quot;,&quot;8b3928711818409bab7e06498d51960a&quot;,&quot;7e34a13fd219404382940913bf8de123&quot;,&quot;fb820f73008b4fb29a5ef284b32e6cec&quot;,&quot;494019af2a8f41dfa69ed0b0cb148e02&quot;,&quot;3885fb459cf54028879c94875b5f7ff6&quot;,&quot;69bf9dfed4334b0a96e571d35aca3304&quot;,&quot;4d5a4e387ca245f387c284143e078767&quot;,&quot;91377af4c2b44152916b308f17bb0217&quot;,&quot;23d4f1d466974a41add1d176a6a1f3ad&quot;,&quot;103890aebb644cebb23748f5c068dacb&quot;,&quot;dbafe2f4657541868f76202207f746cf&quot;,&quot;348e2a8954134c3a977c0b7b7fc0be21&quot;,&quot;9005c0a51cf44812899dd6e704612dbe&quot;,&quot;86001e302b7d4d2ab38c50dc19079100&quot;,&quot;e6c565595285414988a46db640fe03f0&quot;,&quot;7175c2dfb0b04f70941d133406b15b81&quot;,&quot;66bd5cd42c834836becda6d52c02a9de&quot;,&quot;a08d222a51a94017b091e8983a9c3a5e&quot;,&quot;e602cc24b07d4f838bc11eae543af139&quot;,&quot;bd956736c0bd45a3a3d98d6b134b252e&quot;,&quot;f680fa51226b4b5986f916a256012aa1&quot;,&quot;1fcc09e0f91f4af7ac36bc1202e97ee7&quot;,&quot;48ec207503c04d32a385e67af0e0841c&quot;,&quot;0be25366891f4adeb91c45ba1d813665&quot;,&quot;7819cb9a78104fb6940bed9271c6b4ad&quot;,&quot;d4541bdfc63b40b1b19462b16c6d508e&quot;,&quot;392ccf855f2e40c0a23ad4220e66b271&quot;,&quot;b9cb52fd50d34394b89ca330cef06830&quot;,&quot;a1be7f6e85f54460afdecf7af42eec59&quot;,&quot;d3c9733316ba4140a8992291fd42b9b7&quot;,&quot;56a270acad8d48a1a5638158b7919217&quot;,&quot;f389cdd5854d46c7b15e0b2e87856bad&quot;,&quot;12842554eb084bd78e2f9df9eb90ba09&quot;,&quot;a46cfaebcdf84ab1bbea5ed428508f7f&quot;,&quot;d42fcf509b604836ab15f67aed391498&quot;,&quot;38a1e5a861b24e058e780951df046749&quot;,&quot;f51fae570ad54e4ab1c7ee2807d24676&quot;,&quot;bcb83052fec24170b2665c39c59856b7&quot;,&quot;1e0ff1532f214c229a3e016c47d0ad4d&quot;,&quot;d8ef7514c1194dadb7612db24c1d1439&quot;,&quot;62716cdc0b5d4c0e998eb27d2fbab1f8&quot;,&quot;55b95043aa3b46a8a4fb17544d6a9d52&quot;,&quot;a9c1f8ce0900469694990770f15d2891&quot;,&quot;5758e2dc3af14dd5b74e7cbd3433052f&quot;,&quot;a505916dfad44fac9b87636726c15191&quot;,&quot;0d74448ee4154a71a90e358122c741b1&quot;,&quot;e6de32e34068417e83ac63b17dc1164f&quot;,&quot;bb8fafc32e194dd78c923e1da1890ea0&quot;,&quot;273f824e5bd546e5a65606b554a84f7d&quot;,&quot;e0e6b783817c41c1a19430670ce42791&quot;,&quot;3a6b4dc8bb9e4dbe8f388f75ce76acf3&quot;,&quot;94c15a60b717424aa131a67061882476&quot;,&quot;9843715720134b328472b921421cd03a&quot;,&quot;b1d6a47ae71f43c585dbdd30827b6951&quot;,&quot;727e9236ffd84620a060b979fb5284c2&quot;,&quot;d6b4528f93654281a32e94fc4b3a0303&quot;,&quot;d5cee5e6bac840ebb65916de70ab413f&quot;,&quot;bdaaa81d38fa4da2bd1af2f6ee993141&quot;,&quot;73f308defd124b8bbf0a13da5324caea&quot;,&quot;4153961d828e451ab99c4f8cf1619573&quot;,&quot;8afc0932f3614dfea4734d1401f80000&quot;,&quot;994a70464c2943a1a0d4de156e517779&quot;,&quot;850f549684784d0e97f1dc7922af3921&quot;,&quot;0d4a253bf80c484fb09b500decfe9c0b&quot;,&quot;e94e516d530548c0b3abbc4721c3fdbc&quot;,&quot;e48390e55b6c4e38ba38101bdc75adf0&quot;,&quot;9c381c1a62b2416c95818ec371b031db&quot;,&quot;1704994ea205409488b956f9eba650f5&quot;,&quot;6affb693b5b340329e09f6d5c0afa672&quot;,&quot;59d8e3ff714f440dbffe97cafce20116&quot;,&quot;4083624b4af749c9aeccd3031299d4bb&quot;,&quot;8dd0cb2c96114d03ac1bf9b3a58d3697&quot;,&quot;39d9e89a92df46a49821cdd9c9efd4c5&quot;,&quot;fae985341fdb4f2fad50db0ada48eee5&quot;,&quot;de1e0dcd4aa24e2c87782d0b7ca04e9c&quot;,&quot;d9b9086a79e04d57ba5ac5e366a24272&quot;,&quot;b782599a7f0449eb8c3e67b0fb573c24&quot;,&quot;ba4a8bd54c634f95a277ad7d6ecb03bc&quot;,&quot;21cf82ead56d48b2b8cf115d06c32793&quot;,&quot;3e57725d18c4441bbc484b198522304f&quot;,&quot;acc5ef49882c4ea3b7ebe29e80bd0fb9&quot;,&quot;6795e29272344c9daeaf87b79d45e2db&quot;,&quot;8540dd05b8c643708bd63c36306ca09b&quot;,&quot;8eb9f1b5d6c44fe1b26f94d7e5c9b635&quot;,&quot;06c479fad5534467a635018f7d083fa4&quot;,&quot;09fd0324e321466eaa2f2af8c6d29c1b&quot;,&quot;9c01eb5394304e5c927662ca8af5d9b6&quot;,&quot;e6af8ec5f8ea4a27b6b83a707ce31f0f&quot;,&quot;b04d6c0b7a104cb2b5df5310ab435c5a&quot;,&quot;93c773c27f4444c38a222222e3bc4811&quot;,&quot;2b679129101541c1b634a2896bec1bdb&quot;,&quot;4d7bf71467184032911022e8bf8738db&quot;,&quot;4f90d2d0f4ee48a78f6892a8734ce40d&quot;,&quot;5839f6209f774460b2369bd9d79499d3&quot;,&quot;a325b33752934438938f3c69a0686dc6&quot;,&quot;d67c4f82eb434f9499e1f36424929c0c&quot;,&quot;d7b96af22f7b443d994fad301aa1fc04&quot;,&quot;6f62553c26e646a7a30963515554b1cb&quot;,&quot;bc908202eb934ed886e4e2e8f2786805&quot;,&quot;2c38fe85ec6f4ab4904602943f54190d&quot;,&quot;69f746d4fac54f92b9645f01772d4a78&quot;,&quot;c999947ce28e4f2ba42229050b9cdeac&quot;,&quot;f3e1122d4f4b48efb057dc37c6cc9d4f&quot;,&quot;918164875d5c44d887090c4255094710&quot;,&quot;c159267aaba042cc91e96e57c595f4b9&quot;,&quot;a1c170171a1c4d3f98728ffdbe08b23a&quot;,&quot;d3c3481eb63f4f83abc549dffedce30b&quot;,&quot;c138f2b6445244e4bc837037afb7d522&quot;,&quot;ec288b4530d34907ac4e8933bfdd21ad&quot;,&quot;567316c72b084df88852419acfc41349&quot;,&quot;cce5f0133dcb45bb8600f40db1baa846&quot;,&quot;4100fe51dd0c452eac643b896736d20a&quot;,&quot;e09e2cc2709a4fbfa2c76f7ffe70c701&quot;,&quot;8490b020f143451fb112570b2b174ac8&quot;,&quot;cd8b2f31a1794002a61c3991be7179b0&quot;,&quot;3fbec05efa5342928308c0ce7b63626e&quot;,&quot;514f4986349f4d14913e43b6528e91aa&quot;,&quot;0678f1da67704eae93f6efa32f59621c&quot;,&quot;acf55838d12848838d60dcf2f26fa5cb&quot;,&quot;e4ffd9bcf6744ccea83a35fe98898a7e&quot;,&quot;88bbbdec17304d1d9d2ef3f7958cd9ab&quot;,&quot;a5410c6875044416bafb93048a02fbb8&quot;,&quot;021ec06230a24d24983ea408876b8bff&quot;,&quot;9ac8049da6c4460fb2c3819d95c87506&quot;,&quot;b3d37ccc6d9d44b781490c4a432f2577&quot;,&quot;b93c84ce4d7e40718a968ad1bcbff5ae&quot;,&quot;e24124668eba4b92ac4abdf8d3737d59&quot;,&quot;92b939c5a9f14185b7658c12ea529899&quot;,&quot;8be2be22bfa74267aef139b4e2576409&quot;,&quot;3a08b36509f146c49d10fefc911415ac&quot;,&quot;c35b1f6833c441e19bee625e280c64ea&quot;,&quot;b6b776e0e62e4199bb924a406517de17&quot;,&quot;84d2bba438874b629876916a4a6947bb&quot;,&quot;0f2105b943174f97ba2df496aadb9933&quot;,&quot;32bab47134064975bcd8a50bb8ac1d79&quot;,&quot;afd466614b6747c9815cd850906fb90c&quot;,&quot;48d6cef2f8334e71afcf71522093e8d1&quot;]}}" data-outputid="cfcbdb04-588e-44a8-ec17-3df2b2e08f80" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> paddleocr <span class="im">import</span> PaddleOCR</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> file_path.lower().endswith(<span class="st">'.pdf'</span>):</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    image_for_ocr_path <span class="op">=</span> output_image_path</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    image_for_ocr_path <span class="op">=</span> file_path</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> cv2.imread(image_for_ocr_path)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>],</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                   [<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                   [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>]])</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>sharpened <span class="op">=</span> cv2.filter2D(img, <span class="op">-</span><span class="dv">1</span>, kernel)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>sharpened <span class="op">=</span> cv2.addWeighted(img, <span class="dv">1</span> <span class="op">-</span> alpha, sharpened, alpha, <span class="dv">0</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>ocr <span class="op">=</span> PaddleOCR(</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    use_doc_orientation_classify<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    use_doc_unwarping<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    use_textline_orientation<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    lang<span class="op">=</span><span class="st">'en'</span>,</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> ocr.predict(sharpened)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>out_dir <span class="op">=</span> <span class="st">"OCRoutput"</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>os.makedirs(out_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>base_name <span class="op">=</span> os.path.splitext(os.path.basename(file_path))[<span class="dv">0</span>]</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>img_output_path <span class="op">=</span> os.path.join(out_dir, <span class="ss">f"</span><span class="sc">{</span>base_name<span class="sc">}</span><span class="ss">_ocr_res_img.png"</span>)</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>json_output_path <span class="op">=</span> os.path.join(out_dir, <span class="ss">f"</span><span class="sc">{</span>base_name<span class="sc">}</span><span class="ss">_ocr_res.json"</span>)</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, res <span class="kw">in</span> <span class="bu">enumerate</span>(result):</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    res.<span class="bu">print</span>()</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    res.save_to_img(img_output_path)</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    res.save_to_json(json_output_path)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-yellow-fg">Checking connectivity to the model hosters, this may take a while. To bypass this check, set `DISABLE_MODEL_SOURCE_CHECK` to `True`.</span>

UserWarning: No ccache found. Please be aware that recompiling all source files may be required. You can download and install ccache from: https://github.com/ccache/ccache/blob/master/doc/INSTALL.md

<span class="ansi-green-fg">Creating model: ('PP-LCNet_x1_0_textline_ori', None)</span>

<span class="ansi-green-fg">Using official model (PP-LCNet_x1_0_textline_ori), the model files will be automatically downloaded and saved in `/root/.paddlex/official_models/PP-LCNet_x1_0_textline_ori`.</span>

UserWarning: 

The secret `HF_TOKEN` does not exist in your Colab secrets.

To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.

You will be able to reuse this secret in all of your notebooks.

Please note that authentication is recommended but still optional to access public models or datasets.
</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"79c3ca75da8d49f2b4f3d5302f36c149","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cb3ff3ebe1304e4a8e7b0c38ddaa6683","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2c5d9baa090a491fa2bff1ae27e709ac","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cc3ac06b54ac46ddb6859c9f9d09e03c","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3c740f098f424d59b1c09db62cba92a9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e2f427b08bad4c6a84326715ffc2e852","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"241a8edd15ce4c84bed2c3bf5f9946ed","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg">Creating model: ('PP-OCRv5_server_det', None)</span>

<span class="ansi-green-fg">Using official model (PP-OCRv5_server_det), the model files will be automatically downloaded and saved in `/root/.paddlex/official_models/PP-OCRv5_server_det`.</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"2f316d61a0a342b8b175d79bbf84d09d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cc553674c23f46dbaad49ba3292ea0e6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"69bf9dfed4334b0a96e571d35aca3304","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"66bd5cd42c834836becda6d52c02a9de","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b9cb52fd50d34394b89ca330cef06830","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"1e0ff1532f214c229a3e016c47d0ad4d","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e0e6b783817c41c1a19430670ce42791","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg">Creating model: ('en_PP-OCRv5_mobile_rec', None)</span>

<span class="ansi-green-fg">Using official model (en_PP-OCRv5_mobile_rec), the model files will be automatically downloaded and saved in `/root/.paddlex/official_models/en_PP-OCRv5_mobile_rec`.</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8afc0932f3614dfea4734d1401f80000","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8dd0cb2c96114d03ac1bf9b3a58d3697","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8540dd05b8c643708bd63c36306ca09b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5839f6209f774460b2369bd9d79499d3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c159267aaba042cc91e96e57c595f4b9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3fbec05efa5342928308c0ce7b63626e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e24124668eba4b92ac4abdf8d3737d59","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg">{'res': {'input_path': None, 'page_index': None, 'model_settings': {'use_doc_preprocessor': False, 'use_textline_orientation': True}, 'dt_polys': array([[[471,  87],

        ...,

        [453, 108]],



       ...,



       [[365, 713],

        ...,

        [365, 733]]], dtype=int16), 'text_det_params': {'limit_side_len': 64, 'limit_type': 'min', 'thresh': 0.3, 'max_side_limit': 4000, 'box_thresh': 0.6, 'unclip_ratio': 1.5}, 'text_type': 'general', 'textline_orientation_angles': array([0, ..., 0]), 'text_rec_score_thresh': 0.0, 'return_word_box': False, 'rec_texts': ['The void always', '#1', 'stares back.', '#2', 'We rot beautifully.', 'Fragments of', 'Fire: Short', '#5', 'Truths for', 'a', 'Especially you.', 'Heavy Mind', 'Everything', 'Hope is a', 'lends.', 'dangerous', 'illusion', '#3', 'Light', 'lies;', '#4', 'shadows', 'remember.'], 'rec_scores': array([0.99967277, ..., 0.99994493]), 'rec_polys': array([[[471,  87],

        ...,

        [453, 108]],



       ...,



       [[365, 713],

        ...,

        [365, 733]]], dtype=int16), 'rec_boxes': array([[453, ..., 225],

       ...,

       [365, ..., 733]], dtype=int16)}}</span>

Connecting to https://paddle-model-ecology.bj.bcebos.com/paddlex/PaddleX3.0/fonts/simfang.ttf ...

Downloading simfang.ttf ...

[==================================================] 100.00%
</pre>
</div>
</div>
</div>
<p>Get the bbox of the text extracted by the paddleOCR from the json file</p>
<div id="cell-33" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}}" data-outputid="3f5329cb-3f4d-45bb-913d-b5e689ed343a" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> patches</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>STANDARD_ANGLES <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">45.0</span>, <span class="fl">90.0</span>, <span class="fl">135.0</span>, <span class="fl">180.0</span>, <span class="fl">225.0</span>, <span class="fl">270.0</span>, <span class="fl">315.0</span>, <span class="fl">360.0</span>]</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>SNAP_TOLERANCE <span class="op">=</span> <span class="fl">10.0</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _flatten_poly(poly):</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    arr <span class="op">=</span> np.array(poly, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> arr.ndim <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>        arr <span class="op">=</span> arr.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> arr</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _box_area(b):</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">0</span>, b[<span class="dv">2</span>] <span class="op">-</span> b[<span class="dv">0</span>]) <span class="op">*</span> <span class="bu">max</span>(<span class="dv">0</span>, b[<span class="dv">3</span>] <span class="op">-</span> b[<span class="dv">1</span>])</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _intersection_area(a, b):</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    ix1, iy1 <span class="op">=</span> <span class="bu">max</span>(a[<span class="dv">0</span>], b[<span class="dv">0</span>]), <span class="bu">max</span>(a[<span class="dv">1</span>], b[<span class="dv">1</span>])</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    ix2, iy2 <span class="op">=</span> <span class="bu">min</span>(a[<span class="dv">2</span>], b[<span class="dv">2</span>]), <span class="bu">min</span>(a[<span class="dv">3</span>], b[<span class="dv">3</span>])</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">0</span>, ix2 <span class="op">-</span> ix1) <span class="op">*</span> <span class="bu">max</span>(<span class="dv">0</span>, iy2 <span class="op">-</span> iy1)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_rotation_from_polygon(polygon):</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    pts <span class="op">=</span> _flatten_poly(polygon)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> pts.shape[<span class="dv">0</span>]</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>        dx <span class="op">=</span> pts[<span class="dv">1</span>, <span class="dv">0</span>] <span class="op">-</span> pts[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>        dy <span class="op">=</span> pts[<span class="dv">1</span>, <span class="dv">1</span>] <span class="op">-</span> pts[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (math.degrees(math.atan2(<span class="op">-</span>dy, dx)) <span class="op">+</span> <span class="dv">360</span>) <span class="op">%</span> <span class="dv">360</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    centered <span class="op">=</span> pts <span class="op">-</span> pts.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.allclose(centered, <span class="dv">0</span>, atol<span class="op">=</span><span class="fl">1e-6</span>):</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    _, _, Vt <span class="op">=</span> np.linalg.svd(centered, full_matrices<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    vx, vy <span class="op">=</span> Vt[<span class="dv">0</span>]</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>    pca_angle <span class="op">=</span> (math.degrees(math.atan2(<span class="op">-</span>vy, vx)) <span class="op">+</span> <span class="dv">360</span>) <span class="op">%</span> <span class="dv">360</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> pts[:, <span class="dv">0</span>]</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> pts[:, <span class="dv">1</span>]</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(np.unique(x)) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> np.polyfit(x, y, <span class="dv">1</span>)</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>        lf_angle <span class="op">=</span> (math.degrees(math.atan2(<span class="op">-</span>a, <span class="dv">1</span>)) <span class="op">+</span> <span class="dv">360</span>) <span class="op">%</span> <span class="dv">360</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>        lf_angle <span class="op">=</span> pca_angle</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>    pca_var <span class="op">=</span> np.var(centered <span class="op">@</span> np.array([vx, vy]))</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>    lf_dir <span class="op">=</span> np.array([<span class="dv">1</span>, a]) <span class="op">/</span> np.linalg.norm([<span class="dv">1</span>, a]) <span class="cf">if</span> <span class="bu">len</span>(np.unique(x)) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> np.array([<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>    lf_var <span class="op">=</span> np.var(centered <span class="op">@</span> lf_dir)</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>    best <span class="op">=</span> pca_angle <span class="cf">if</span> pca_var <span class="op">&gt;=</span> lf_var <span class="cf">else</span> lf_angle</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">round</span>(best, <span class="dv">2</span>)</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> snap_to_standard_angle(angle, tolerance<span class="op">=</span>SNAP_TOLERANCE):</span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>    angle <span class="op">=</span> angle <span class="op">%</span> <span class="dv">360</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>    best <span class="op">=</span> <span class="bu">min</span>(STANDARD_ANGLES, key<span class="op">=</span><span class="kw">lambda</span> s: <span class="bu">abs</span>(angle <span class="op">-</span> s))</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">int</span>(best) <span class="cf">if</span> <span class="bu">abs</span>(best <span class="op">-</span> angle) <span class="op">&lt;=</span> tolerance <span class="cf">else</span> <span class="bu">round</span>(angle, <span class="dv">1</span>)</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_text_rotation_for_shape(shape_bbox, ocr_data, threshold<span class="op">=</span><span class="fl">0.25</span>):</span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>    sx1, sy1, sx2, sy2 <span class="op">=</span> shape_bbox</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>    weighted_vector <span class="op">=</span> np.array([<span class="fl">0.0</span>, <span class="fl">0.0</span>])</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>    total_weight <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>    matched <span class="op">=</span> <span class="va">False</span></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> ocr_data:</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>        tx1, ty1, tx2, ty2 <span class="op">=</span> item[<span class="st">"bbox"</span>]</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>        text_area <span class="op">=</span> _box_area(item[<span class="st">"bbox"</span>])</span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> text_area <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>        inter <span class="op">=</span> _intersection_area(shape_bbox, item[<span class="st">"bbox"</span>])</span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a>        overlap <span class="op">=</span> inter <span class="op">/</span> text_area</span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> overlap <span class="op">&lt;</span> threshold:</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>        matched <span class="op">=</span> <span class="va">True</span></span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>        conf <span class="op">=</span> <span class="bu">float</span>(item.get(<span class="st">"confidence"</span>, <span class="fl">1.0</span>))</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>        ang <span class="op">=</span> calculate_rotation_from_polygon(item.get(<span class="st">"polygon"</span>, [(tx1, ty1), (tx2, ty2)]))</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>        rad <span class="op">=</span> math.radians(ang)</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a>        ux, uy <span class="op">=</span> math.cos(rad), math.sin(rad)</span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> overlap <span class="op">*</span> conf <span class="op">*</span> <span class="bu">max</span>(<span class="dv">1</span>, text_area)</span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>        weighted_vector <span class="op">+=</span> w <span class="op">*</span> np.array([ux, uy])</span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>        total_weight <span class="op">+=</span> w</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> matched <span class="kw">or</span> total_weight <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>    mean_vec <span class="op">=</span> weighted_vector <span class="op">/</span> total_weight</span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>    mean_angle <span class="op">=</span> (math.degrees(math.atan2(mean_vec[<span class="dv">1</span>], mean_vec[<span class="dv">0</span>])) <span class="op">+</span> <span class="dv">360</span>) <span class="op">%</span> <span class="dv">360</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>    mean_angle <span class="op">=</span> <span class="bu">round</span>(mean_angle, <span class="dv">2</span>)</span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>    snapped <span class="op">=</span> snap_to_standard_angle(mean_angle)</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"raw_rotation"</span>: mean_angle, <span class="st">"shape_rotation"</span>: snapped}</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_paddleocr_json(json_path, min_confidence<span class="op">=</span><span class="fl">0.4</span>):</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>    processed <span class="op">=</span> []</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(json_path, <span class="st">"r"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>            ocr <span class="op">=</span> json.load(f)</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>    texts <span class="op">=</span> ocr.get(<span class="st">"rec_texts"</span>, [])</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> ocr.get(<span class="st">"rec_scores"</span>, [])</span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>    polys <span class="op">=</span> ocr.get(<span class="st">"rec_polys"</span>, [])</span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>    orientation <span class="op">=</span> ocr.get(<span class="st">"textline_orientation_angles"</span>, [])</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(texts), <span class="bu">len</span>(scores), <span class="bu">len</span>(polys))</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> scores[i] <span class="op">&lt;</span> min_confidence:</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>        poly <span class="op">=</span> _flatten_poly(polys[i])</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>        x1, y1 <span class="op">=</span> np.<span class="bu">min</span>(poly, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>        x2, y2 <span class="op">=</span> np.<span class="bu">max</span>(poly, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>        raw_rot <span class="op">=</span> calculate_rotation_from_polygon(poly)</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>        snapped <span class="op">=</span> snap_to_standard_angle(raw_rot)</span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>        processed.append({</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>            <span class="st">"text"</span>: texts[i],</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>            <span class="st">"confidence"</span>: <span class="bu">float</span>(scores[i]),</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bbox"</span>: (<span class="bu">int</span>(x1), <span class="bu">int</span>(y1), <span class="bu">int</span>(x2), <span class="bu">int</span>(y2)),</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a>            <span class="st">"polygon"</span>: polys[i],</span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a>            <span class="st">"paddleocr_orientation"</span>: orientation[i] <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(orientation) <span class="cf">else</span> <span class="va">None</span>,</span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a>            <span class="st">"polygon_rotation"</span>: raw_rot,</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>            <span class="st">"shape_rotation"</span>: snapped</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> processed</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_ocr_detections(data):</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> data:</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No data."</span>)</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">12</span>))</span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>    ax.set_facecolor(<span class="st">"black"</span>)</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> data:</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>        x1, y1, x2, y2 <span class="op">=</span> item[<span class="st">"bbox"</span>]</span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>        raw <span class="op">=</span> item[<span class="st">"polygon_rotation"</span>]</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>        snap <span class="op">=</span> item[<span class="st">"shape_rotation"</span>]</span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>        ax.add_patch(</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>            patches.Rectangle((x1, y1), x2 <span class="op">-</span> x1, y2 <span class="op">-</span> y1, ec<span class="op">=</span><span class="st">"r"</span>, fc<span class="op">=</span><span class="st">"none"</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a>        ax.text(x1, y1 <span class="op">-</span> <span class="dv">5</span>, <span class="ss">f"</span><span class="sc">{</span>item[<span class="st">'text'</span>]<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>raw<span class="sc">}</span><span class="ss">° → </span><span class="sc">{</span>snap<span class="sc">}</span><span class="ss">°)"</span>,</span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">6</span>, color<span class="op">=</span><span class="st">"white"</span>, backgroundcolor<span class="op">=</span><span class="st">"red"</span>)</span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> [d[<span class="st">"bbox"</span>][<span class="dv">0</span>] <span class="cf">for</span> d <span class="kw">in</span> data] <span class="op">+</span> [d[<span class="st">"bbox"</span>][<span class="dv">2</span>] <span class="cf">for</span> d <span class="kw">in</span> data]</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> [d[<span class="st">"bbox"</span>][<span class="dv">1</span>] <span class="cf">for</span> d <span class="kw">in</span> data] <span class="op">+</span> [d[<span class="st">"bbox"</span>][<span class="dv">3</span>] <span class="cf">for</span> d <span class="kw">in</span> data]</span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="bu">min</span>(xs) <span class="op">-</span> <span class="dv">10</span>, <span class="bu">max</span>(xs) <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="bu">max</span>(ys) <span class="op">+</span> <span class="dv">10</span>, <span class="bu">min</span>(ys) <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>    ax.invert_yaxis()</span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>    ax.set_aspect(<span class="st">"equal"</span>)</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">"off"</span>)</span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>base_name <span class="op">=</span> os.path.splitext(os.path.basename(file_path))[<span class="dv">0</span>]</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>json_output_path <span class="op">=</span> <span class="ss">f"OCRoutput/</span><span class="sc">{</span>base_name<span class="sc">}</span><span class="ss">_ocr_res.json"</span></span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(json_output_path):</span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>    final_processed_data <span class="op">=</span> process_paddleocr_json(json_output_path)</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> final_processed_data:</span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Processed OCR data (full 360° rotation):"</span>)</span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> item <span class="kw">in</span> final_processed_data:</span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>item[<span class="st">'text'</span>][:<span class="dv">20</span>]<span class="sc">:&lt;20}</span><span class="ss"> | Raw: </span><span class="sc">{</span>item[<span class="st">'polygon_rotation'</span>]<span class="sc">:6.1f}</span><span class="ss">° → Rounded: </span><span class="sc">{</span>item[<span class="st">'shape_rotation'</span>]<span class="sc">}</span><span class="ss">°"</span>)</span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a>        plot_ocr_detections(final_processed_data)</span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"JSON not found: </span><span class="sc">{</span>json_output_path<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Processed OCR data (full 360° rotation):
----------------------------------------------------------------------
The void always      | Raw:  319.0° → Rounded: 315°
#1                   | Raw:    0.0° → Rounded: 0°
stares back.         | Raw:  321.4° → Rounded: 315°
#2                   | Raw:    0.0° → Rounded: 0°
We rot beautifully.  | Raw:   39.5° → Rounded: 45°
Fragments of         | Raw:    0.0° → Rounded: 0°
Fire: Short          | Raw:  359.4° → Rounded: 360°
#5                   | Raw:    1.9° → Rounded: 0°
Truths for           | Raw:    0.0° → Rounded: 0°
a                    | Raw:    0.0° → Rounded: 0°
Especially you.      | Raw:  285.8° → Rounded: 285.8°
Heavy Mind           | Raw:    0.0° → Rounded: 0°
Everything           | Raw:  284.0° → Rounded: 284.0°
Hope is a            | Raw:  249.2° → Rounded: 249.2°
lends.               | Raw:  285.0° → Rounded: 285.0°
dangerous            | Raw:  250.6° → Rounded: 250.6°
illusion             | Raw:  248.1° → Rounded: 248.1°
#3                   | Raw:    0.0° → Rounded: 0°
Light                | Raw:  357.4° → Rounded: 360°
lies;                | Raw:    0.0° → Rounded: 0°
#4                   | Raw:    0.0° → Rounded: 0°
shadows              | Raw:  358.9° → Rounded: 360°
remember.            | Raw:    0.0° → Rounded: 0°
----------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-relationship" class="level1">
<h1><strong>Spatial Relationship</strong></h1>
<p>Main pipeline where find out the main relationship of the arrows with the shapes and the detections of the arrow’s endpoints</p>
<div id="cell-36" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="4e94c8e9-9a43-4b09-ce5f-c1c2ce32dd56" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skimage.morphology <span class="im">import</span> skeletonize</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- HELPER FUNCTIONS  ----------</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_image(title, img, cmap<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(img.shape) <span class="op">==</span> <span class="dv">2</span>: plt.imshow(img, cmap<span class="op">=</span>cmap <span class="kw">or</span> <span class="st">"gray"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    plt.title(title)<span class="op">;</span> plt.axis(<span class="st">"off"</span>)<span class="op">;</span> plt.show()</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> crop_image_region(image, top_left, bottom_right):</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    x1, y1 <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, <span class="bu">map</span>(<span class="bu">round</span>, top_left))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    x2, y2 <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, <span class="bu">map</span>(<span class="bu">round</span>, bottom_right))</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image[y1:y2, x1:x2]</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_to_binary_mask(cropped_img):</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cropped_img.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.array([], dtype<span class="op">=</span>np.uint8)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    gray <span class="op">=</span> cv2.cvtColor(cropped_img, cv2.COLOR_BGR2GRAY)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    blurred <span class="op">=</span> cv2.GaussianBlur(gray, (<span class="dv">3</span>,<span class="dv">3</span>), <span class="dv">0</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    edges <span class="op">=</span> cv2.Canny(blurred, threshold1<span class="op">=</span><span class="dv">30</span>, threshold2<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>    closed <span class="op">=</span> cv2.morphologyEx(edges, cv2.MORPH_CLOSE, kernel, iterations<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>    _, thresh <span class="op">=</span> cv2.threshold(gray, <span class="dv">0</span>, <span class="dv">255</span>, cv2.THRESH_BINARY <span class="op">+</span> cv2.THRESH_OTSU)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.mean(thresh) <span class="op">&gt;</span> <span class="dv">127</span>:</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>        thresh <span class="op">=</span> cv2.bitwise_not(thresh)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>    combined_mask <span class="op">=</span> cv2.bitwise_or(closed, thresh)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combined_mask</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> connect_dotted_simple_morph(binary_mask, kernel_size<span class="op">=</span><span class="dv">5</span>, iterations<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (kernel_size, kernel_size))</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>    closed_mask <span class="op">=</span> cv2.morphologyEx(binary_mask, cv2.MORPH_CLOSE, kernel, iterations<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>    connected_mask <span class="op">=</span> cv2.dilate(closed_mask, kernel, iterations<span class="op">=</span>iterations)</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> connected_mask</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_farthest_points_in_contour(contour):</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>    max_dist_sq, best_pair <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="va">None</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> contour.squeeze(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(points) <span class="op">&lt;</span> <span class="dv">2</span>: <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p1, p2 <span class="kw">in</span> itertools.combinations(points, <span class="dv">2</span>):</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a>        dist_sq <span class="op">=</span> (p1[<span class="dv">0</span>] <span class="op">-</span> p2[<span class="dv">0</span>])<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (p1[<span class="dv">1</span>] <span class="op">-</span> p2[<span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dist_sq <span class="op">&gt;</span> max_dist_sq: max_dist_sq, best_pair <span class="op">=</span> dist_sq, (<span class="bu">tuple</span>(p1), <span class="bu">tuple</span>(p2))</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_pair</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> interpolate_dashed_arrows(binary_mask, max_gap_ratio<span class="op">=</span><span class="fl">0.5</span>, thickness<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>    contours, _ <span class="op">=</span> cv2.findContours(binary_mask, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>    contours <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> contours <span class="cf">if</span> cv2.contourArea(c) <span class="op">&gt;</span> <span class="dv">3</span>]</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(contours) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> binary_mask</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>    dash_endpoints <span class="op">=</span> []</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cnt <span class="kw">in</span> contours:</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>        end_pts <span class="op">=</span> find_farthest_points_in_contour(cnt)</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> end_pts:</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>            dash_endpoints.append(<span class="bu">list</span>(end_pts))</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>    dash_lengths <span class="op">=</span> [math.dist(ep[<span class="dv">0</span>], ep[<span class="dv">1</span>]) <span class="cf">for</span> ep <span class="kw">in</span> dash_endpoints <span class="cf">if</span> ep]</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> dash_lengths:</span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> binary_mask</span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>    max_connect_dist <span class="op">=</span> np.median(dash_lengths) <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> max_gap_ratio)</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>    output_mask <span class="op">=</span> binary_mask.copy()</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, eps1 <span class="kw">in</span> <span class="bu">enumerate</span>(dash_endpoints):</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ep1 <span class="kw">in</span> eps1:</span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a>            min_dist <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>            best_ep <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j, eps2 <span class="kw">in</span> <span class="bu">enumerate</span>(dash_endpoints):</span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="op">==</span> j:</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> ep2 <span class="kw">in</span> eps2:</span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a>                    dist <span class="op">=</span> math.dist(ep1, ep2)</span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> dist <span class="op">&lt;</span> min_dist:</span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>                        min_dist <span class="op">=</span> dist</span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a>                        best_ep <span class="op">=</span> ep2</span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> best_ep <span class="kw">and</span> min_dist <span class="op">&lt;</span> max_connect_dist:</span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a>                cv2.line(output_mask, ep1, best_ep, <span class="dv">255</span>, thickness<span class="op">=</span>thickness)</span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a>    output_mask <span class="op">=</span> cv2.dilate(output_mask, kernel, iterations<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_mask</span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_skeleton(binary_mask):</span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> skeletonize(binary_mask <span class="op">&gt;</span> <span class="dv">0</span>).astype(np.uint8) <span class="op">*</span> <span class="dv">255</span></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_skeleton_graph_nodes(skeleton):</span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a>    endpoints, junctions <span class="op">=</span> [], []</span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> skeleton.shape</span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a>    padded_skeleton <span class="op">=</span> np.pad(skeleton, <span class="dv">1</span>, <span class="st">'constant'</span>)</span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y_pad <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, h <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x_pad <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, w <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> padded_skeleton[y_pad, x_pad] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a>                num_neighbors <span class="op">=</span> np.<span class="bu">sum</span>(padded_skeleton[y_pad<span class="op">-</span><span class="dv">1</span>:y_pad<span class="op">+</span><span class="dv">2</span>, x_pad<span class="op">-</span><span class="dv">1</span>:x_pad<span class="op">+</span><span class="dv">2</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> num_neighbors <span class="op">==</span> <span class="dv">1</span>: endpoints.append((x_pad <span class="op">-</span> <span class="dv">1</span>, y_pad <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> num_neighbors <span class="op">&gt;</span> <span class="dv">2</span>: junctions.append((x_pad <span class="op">-</span> <span class="dv">1</span>, y_pad <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> endpoints, junctions</span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_farthest_points_euclidean(binary_mask):</span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a>    contours, _ <span class="op">=</span> cv2.findContours(binary_mask, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> contours: <span class="cf">return</span> []</span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a>    all_points <span class="op">=</span> np.vstack([cnt.squeeze(axis<span class="op">=</span><span class="dv">1</span>) <span class="cf">for</span> cnt <span class="kw">in</span> contours <span class="cf">if</span> cnt.ndim <span class="op">&gt;</span> <span class="dv">2</span>])</span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(all_points) <span class="op">&lt;</span> <span class="dv">2</span>: <span class="cf">return</span> []</span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> find_farthest_points_in_contour(np.array(all_points).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_bbox_intersection(box1_tl, box1_br, box2_tl, box2_br):</span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">not</span> (box1_br[<span class="dv">0</span>] <span class="op">&lt;</span> box2_tl[<span class="dv">0</span>] <span class="kw">or</span> box1_tl[<span class="dv">0</span>] <span class="op">&gt;</span> box2_br[<span class="dv">0</span>] <span class="kw">or</span> box1_br[<span class="dv">1</span>] <span class="op">&lt;</span> box2_tl[<span class="dv">1</span>] <span class="kw">or</span> box1_tl[<span class="dv">1</span>] <span class="op">&gt;</span> box2_br[<span class="dv">1</span>])</span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simple_bridge_by_interpolation(binary_mask, ocr_bbox_local, thickness<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> binary_mask.shape[:<span class="dv">2</span>]</span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a>    x1, y1, x2, y2 <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, ocr_bbox_local)</span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a>    x1, y1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, x1), <span class="bu">max</span>(<span class="dv">0</span>, y1)</span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a>    x2, y2 <span class="op">=</span> <span class="bu">min</span>(w, x2), <span class="bu">min</span>(h, y2)</span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x2 <span class="op">&lt;=</span> x1 <span class="kw">or</span> y2 <span class="op">&lt;=</span> y1:</span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> binary_mask.copy()</span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a>    mask_no_text <span class="op">=</span> binary_mask.copy()</span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a>    mask_no_text[y1:y2, x1:x2] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a>    pts <span class="op">=</span> np.column_stack(np.where(mask_no_text <span class="op">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pts.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> binary_mask.copy()</span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a>    left_pts <span class="op">=</span> pts[pts[:, <span class="dv">1</span>] <span class="op">&lt;</span> x1]</span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a>    right_pts <span class="op">=</span> pts[pts[:, <span class="dv">1</span>] <span class="op">&gt;</span> x2]</span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> left_pts.size <span class="kw">and</span> right_pts.size:</span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true" tabindex="-1"></a>        left_idx <span class="op">=</span> np.argmax(left_pts[:, <span class="dv">1</span>])</span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true" tabindex="-1"></a>        right_idx <span class="op">=</span> np.argmin(right_pts[:, <span class="dv">1</span>])</span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true" tabindex="-1"></a>        left_p <span class="op">=</span> (<span class="bu">int</span>(left_pts[left_idx, <span class="dv">1</span>]), <span class="bu">int</span>(left_pts[left_idx, <span class="dv">0</span>]))</span>
<span id="cb37-151"><a href="#cb37-151" aria-hidden="true" tabindex="-1"></a>        right_p <span class="op">=</span> (<span class="bu">int</span>(right_pts[right_idx, <span class="dv">1</span>]), <span class="bu">int</span>(right_pts[right_idx, <span class="dv">0</span>]))</span>
<span id="cb37-152"><a href="#cb37-152" aria-hidden="true" tabindex="-1"></a>        p1, p2 <span class="op">=</span> left_p, right_p</span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true" tabindex="-1"></a>        top_pts <span class="op">=</span> pts[pts[:, <span class="dv">0</span>] <span class="op">&lt;</span> y1]</span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true" tabindex="-1"></a>        bottom_pts <span class="op">=</span> pts[pts[:, <span class="dv">0</span>] <span class="op">&gt;</span> y2]</span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> top_pts.size <span class="kw">and</span> bottom_pts.size:</span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true" tabindex="-1"></a>            top_idx <span class="op">=</span> np.argmax(top_pts[:, <span class="dv">0</span>])</span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true" tabindex="-1"></a>            bot_idx <span class="op">=</span> np.argmin(bottom_pts[:, <span class="dv">0</span>])</span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true" tabindex="-1"></a>            top_p <span class="op">=</span> (<span class="bu">int</span>(top_pts[top_idx, <span class="dv">1</span>]), <span class="bu">int</span>(top_pts[top_idx, <span class="dv">0</span>]))</span>
<span id="cb37-160"><a href="#cb37-160" aria-hidden="true" tabindex="-1"></a>            bot_p <span class="op">=</span> (<span class="bu">int</span>(bottom_pts[bot_idx, <span class="dv">1</span>]), <span class="bu">int</span>(bottom_pts[bot_idx, <span class="dv">0</span>]))</span>
<span id="cb37-161"><a href="#cb37-161" aria-hidden="true" tabindex="-1"></a>            p1, p2 <span class="op">=</span> top_p, bot_p</span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true" tabindex="-1"></a>            coords <span class="op">=</span> np.column_stack((pts[:,<span class="dv">1</span>], pts[:,<span class="dv">0</span>]))</span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true" tabindex="-1"></a>            max_d <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span> best <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(coords)):</span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>, <span class="bu">len</span>(coords)):</span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true" tabindex="-1"></a>                    d <span class="op">=</span> (coords[i,<span class="dv">0</span>]<span class="op">-</span>coords[j,<span class="dv">0</span>])<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (coords[i,<span class="dv">1</span>]<span class="op">-</span>coords[j,<span class="dv">1</span>])<span class="op">**</span><span class="dv">2</span></span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> d <span class="op">&gt;</span> max_d:</span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true" tabindex="-1"></a>                        max_d <span class="op">=</span> d</span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true" tabindex="-1"></a>                        best <span class="op">=</span> (<span class="bu">tuple</span>(coords[i].tolist()), <span class="bu">tuple</span>(coords[j].tolist()))</span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> best:</span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> binary_mask.copy()</span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true" tabindex="-1"></a>            p1, p2 <span class="op">=</span> best</span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> mask_no_text.copy()</span>
<span id="cb37-176"><a href="#cb37-176" aria-hidden="true" tabindex="-1"></a>    dist <span class="op">=</span> <span class="bu">int</span>(math.hypot(p2[<span class="dv">0</span>]<span class="op">-</span>p1[<span class="dv">0</span>], p2[<span class="dv">1</span>]<span class="op">-</span>p1[<span class="dv">1</span>]))</span>
<span id="cb37-177"><a href="#cb37-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dist <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb37-178"><a href="#cb37-178" aria-hidden="true" tabindex="-1"></a>        cv2.line(out, p1, p2, <span class="dv">255</span>, thickness<span class="op">=</span><span class="bu">max</span>(<span class="dv">1</span>, thickness))</span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> out</span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">max</span>(dist, <span class="dv">2</span>)</span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> np.linspace(p1[<span class="dv">0</span>], p2[<span class="dv">0</span>], n)</span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> np.linspace(p1[<span class="dv">1</span>], p2[<span class="dv">1</span>], n)</span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(xs, ys):</span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true" tabindex="-1"></a>        cx, cy <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>(x)), <span class="bu">int</span>(<span class="bu">round</span>(y))</span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true" tabindex="-1"></a>        x0, x1_ <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, cx <span class="op">-</span> thickness), <span class="bu">min</span>(w, cx <span class="op">+</span> thickness <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb37-187"><a href="#cb37-187" aria-hidden="true" tabindex="-1"></a>        y0, y1_ <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, cy <span class="op">-</span> thickness), <span class="bu">min</span>(h, cy <span class="op">+</span> thickness <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb37-188"><a href="#cb37-188" aria-hidden="true" tabindex="-1"></a>        out[y0:y1_, x0:x1_] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true" tabindex="-1"></a>    kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> cv2.dilate(out, kernel, iterations<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bbox_iou(boxA, boxB):</span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true" tabindex="-1"></a>    xA <span class="op">=</span> <span class="bu">max</span>(boxA[<span class="dv">0</span>], boxB[<span class="dv">0</span>])</span>
<span id="cb37-196"><a href="#cb37-196" aria-hidden="true" tabindex="-1"></a>    yA <span class="op">=</span> <span class="bu">max</span>(boxA[<span class="dv">1</span>], boxB[<span class="dv">1</span>])</span>
<span id="cb37-197"><a href="#cb37-197" aria-hidden="true" tabindex="-1"></a>    xB <span class="op">=</span> <span class="bu">min</span>(boxA[<span class="dv">2</span>], boxB[<span class="dv">2</span>])</span>
<span id="cb37-198"><a href="#cb37-198" aria-hidden="true" tabindex="-1"></a>    yB <span class="op">=</span> <span class="bu">min</span>(boxA[<span class="dv">3</span>], boxB[<span class="dv">3</span>])</span>
<span id="cb37-199"><a href="#cb37-199" aria-hidden="true" tabindex="-1"></a>    interArea <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, xB <span class="op">-</span> xA) <span class="op">*</span> <span class="bu">max</span>(<span class="dv">0</span>, yB <span class="op">-</span> yA)</span>
<span id="cb37-200"><a href="#cb37-200" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> interArea <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-201"><a href="#cb37-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb37-202"><a href="#cb37-202" aria-hidden="true" tabindex="-1"></a>    boxAArea <span class="op">=</span> (boxA[<span class="dv">2</span>] <span class="op">-</span> boxA[<span class="dv">0</span>]) <span class="op">*</span> (boxA[<span class="dv">3</span>] <span class="op">-</span> boxA[<span class="dv">1</span>])</span>
<span id="cb37-203"><a href="#cb37-203" aria-hidden="true" tabindex="-1"></a>    boxBArea <span class="op">=</span> (boxB[<span class="dv">2</span>] <span class="op">-</span> boxB[<span class="dv">0</span>]) <span class="op">*</span> (boxB[<span class="dv">3</span>] <span class="op">-</span> boxB[<span class="dv">1</span>])</span>
<span id="cb37-204"><a href="#cb37-204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> interArea <span class="op">/</span> <span class="bu">float</span>(boxAArea <span class="op">+</span> boxBArea <span class="op">-</span> interArea)</span>
<span id="cb37-205"><a href="#cb37-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-206"><a href="#cb37-206" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pixel_level_ocr_interference(binary_arrow_mask, ocr_bbox, crop_origin, coverage_threshold<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb37-207"><a href="#cb37-207" aria-hidden="true" tabindex="-1"></a>    crop_x1, crop_y1 <span class="op">=</span> crop_origin</span>
<span id="cb37-208"><a href="#cb37-208" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> binary_arrow_mask.shape</span>
<span id="cb37-209"><a href="#cb37-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-210"><a href="#cb37-210" aria-hidden="true" tabindex="-1"></a>    ox1, oy1, ox2, oy2 <span class="op">=</span> ocr_bbox</span>
<span id="cb37-211"><a href="#cb37-211" aria-hidden="true" tabindex="-1"></a>    local_x1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(ox1 <span class="op">-</span> crop_x1))</span>
<span id="cb37-212"><a href="#cb37-212" aria-hidden="true" tabindex="-1"></a>    local_y1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(oy1 <span class="op">-</span> crop_y1))</span>
<span id="cb37-213"><a href="#cb37-213" aria-hidden="true" tabindex="-1"></a>    local_x2 <span class="op">=</span> <span class="bu">min</span>(w, <span class="bu">int</span>(ox2 <span class="op">-</span> crop_x1))</span>
<span id="cb37-214"><a href="#cb37-214" aria-hidden="true" tabindex="-1"></a>    local_y2 <span class="op">=</span> <span class="bu">min</span>(h, <span class="bu">int</span>(oy2 <span class="op">-</span> crop_y1))</span>
<span id="cb37-215"><a href="#cb37-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-216"><a href="#cb37-216" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> local_x1 <span class="op">&gt;=</span> local_x2 <span class="kw">or</span> local_y1 <span class="op">&gt;=</span> local_y2:</span>
<span id="cb37-217"><a href="#cb37-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb37-218"><a href="#cb37-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-219"><a href="#cb37-219" aria-hidden="true" tabindex="-1"></a>    arrow_pixels <span class="op">=</span> np.count_nonzero(binary_arrow_mask)</span>
<span id="cb37-220"><a href="#cb37-220" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> arrow_pixels <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-221"><a href="#cb37-221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb37-222"><a href="#cb37-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-223"><a href="#cb37-223" aria-hidden="true" tabindex="-1"></a>    overlap_region <span class="op">=</span> binary_arrow_mask[local_y1:local_y2, local_x1:local_x2]</span>
<span id="cb37-224"><a href="#cb37-224" aria-hidden="true" tabindex="-1"></a>    overlap_count <span class="op">=</span> np.count_nonzero(overlap_region)</span>
<span id="cb37-225"><a href="#cb37-225" aria-hidden="true" tabindex="-1"></a>    coverage_ratio <span class="op">=</span> overlap_count <span class="op">/</span> arrow_pixels</span>
<span id="cb37-226"><a href="#cb37-226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coverage_ratio <span class="op">&gt;</span> coverage_threshold</span>
<span id="cb37-227"><a href="#cb37-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-228"><a href="#cb37-228" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mask_overlapping_ocr_regions(binary_mask, ocr_intrusions, crop_origin):</span>
<span id="cb37-229"><a href="#cb37-229" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> binary_mask.copy()</span>
<span id="cb37-230"><a href="#cb37-230" aria-hidden="true" tabindex="-1"></a>    crop_x1, crop_y1 <span class="op">=</span> crop_origin</span>
<span id="cb37-231"><a href="#cb37-231" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> mask.shape</span>
<span id="cb37-232"><a href="#cb37-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-233"><a href="#cb37-233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ocr <span class="kw">in</span> ocr_intrusions:</span>
<span id="cb37-234"><a href="#cb37-234" aria-hidden="true" tabindex="-1"></a>        ox1, oy1, ox2, oy2 <span class="op">=</span> ocr[<span class="st">'bbox'</span>]</span>
<span id="cb37-235"><a href="#cb37-235" aria-hidden="true" tabindex="-1"></a>        local_x1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(ox1 <span class="op">-</span> crop_x1))</span>
<span id="cb37-236"><a href="#cb37-236" aria-hidden="true" tabindex="-1"></a>        local_y1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(oy1 <span class="op">-</span> crop_y1))</span>
<span id="cb37-237"><a href="#cb37-237" aria-hidden="true" tabindex="-1"></a>        local_x2 <span class="op">=</span> <span class="bu">min</span>(w, <span class="bu">int</span>(ox2 <span class="op">-</span> crop_x1))</span>
<span id="cb37-238"><a href="#cb37-238" aria-hidden="true" tabindex="-1"></a>        local_y2 <span class="op">=</span> <span class="bu">min</span>(h, <span class="bu">int</span>(oy2 <span class="op">-</span> crop_y1))</span>
<span id="cb37-239"><a href="#cb37-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> local_x1 <span class="op">&lt;</span> local_x2 <span class="kw">and</span> local_y1 <span class="op">&lt;</span> local_y2:</span>
<span id="cb37-240"><a href="#cb37-240" aria-hidden="true" tabindex="-1"></a>            mask[local_y1:local_y2, local_x1:local_x2] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-241"><a href="#cb37-241" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mask</span>
<span id="cb37-242"><a href="#cb37-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-243"><a href="#cb37-243" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> match_arrowhead_to_endpoint(arrowhead_bboxes, endpoints, crop_origin):</span>
<span id="cb37-244"><a href="#cb37-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-245"><a href="#cb37-245" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> arrowhead_bboxes:</span>
<span id="cb37-246"><a href="#cb37-246" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-247"><a href="#cb37-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-248"><a href="#cb37-248" aria-hidden="true" tabindex="-1"></a>    crop_x, crop_y <span class="op">=</span> crop_origin</span>
<span id="cb37-249"><a href="#cb37-249" aria-hidden="true" tabindex="-1"></a>    arrowhead_centers <span class="op">=</span> []</span>
<span id="cb37-250"><a href="#cb37-250" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tl, br <span class="kw">in</span> arrowhead_bboxes:</span>
<span id="cb37-251"><a href="#cb37-251" aria-hidden="true" tabindex="-1"></a>        cx <span class="op">=</span> (tl[<span class="dv">0</span>] <span class="op">+</span> br[<span class="dv">0</span>]) <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> crop_x</span>
<span id="cb37-252"><a href="#cb37-252" aria-hidden="true" tabindex="-1"></a>        cy <span class="op">=</span> (tl[<span class="dv">1</span>] <span class="op">+</span> br[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> crop_y</span>
<span id="cb37-253"><a href="#cb37-253" aria-hidden="true" tabindex="-1"></a>        arrowhead_centers.append((cx, cy))</span>
<span id="cb37-254"><a href="#cb37-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-255"><a href="#cb37-255" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> center <span class="kw">in</span> arrowhead_centers:</span>
<span id="cb37-256"><a href="#cb37-256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> ep <span class="kw">in</span> endpoints:</span>
<span id="cb37-257"><a href="#cb37-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-258"><a href="#cb37-258" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">abs</span>(ep[<span class="dv">0</span>] <span class="op">-</span> center[<span class="dv">0</span>]) <span class="op">&lt;</span> <span class="dv">15</span> <span class="kw">and</span> <span class="bu">abs</span>(ep[<span class="dv">1</span>] <span class="op">-</span> center[<span class="dv">1</span>]) <span class="op">&lt;</span> <span class="dv">12</span>:</span>
<span id="cb37-259"><a href="#cb37-259" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> ep</span>
<span id="cb37-260"><a href="#cb37-260" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-261"><a href="#cb37-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-262"><a href="#cb37-262" aria-hidden="true" tabindex="-1"></a><span class="co"># =================================================================================</span></span>
<span id="cb37-263"><a href="#cb37-263" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- FOR INTERSECTING ARROWS ----------</span></span>
<span id="cb37-264"><a href="#cb37-264" aria-hidden="true" tabindex="-1"></a><span class="co"># =================================================================================</span></span>
<span id="cb37-265"><a href="#cb37-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-266"><a href="#cb37-266" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bfs_get_path(skeleton, start_xy, end_xy):</span>
<span id="cb37-267"><a href="#cb37-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-268"><a href="#cb37-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-269"><a href="#cb37-269" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> skeleton.shape</span>
<span id="cb37-270"><a href="#cb37-270" aria-hidden="true" tabindex="-1"></a>    start_rc, end_rc <span class="op">=</span> (start_xy[<span class="dv">1</span>], start_xy[<span class="dv">0</span>]), (end_xy[<span class="dv">1</span>], end_xy[<span class="dv">0</span>])</span>
<span id="cb37-271"><a href="#cb37-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-272"><a href="#cb37-272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> start_rc[<span class="dv">0</span>] <span class="op">&lt;</span> h <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> start_rc[<span class="dv">1</span>] <span class="op">&lt;</span> w <span class="kw">and</span> skeleton[start_rc] <span class="op">&gt;</span> <span class="dv">0</span>): <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-273"><a href="#cb37-273" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;=</span> end_rc[<span class="dv">0</span>] <span class="op">&lt;</span> h <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> end_rc[<span class="dv">1</span>] <span class="op">&lt;</span> w <span class="kw">and</span> skeleton[end_rc] <span class="op">&gt;</span> <span class="dv">0</span>): <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-274"><a href="#cb37-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-275"><a href="#cb37-275" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> deque([(start_rc, [start_xy])])</span>
<span id="cb37-276"><a href="#cb37-276" aria-hidden="true" tabindex="-1"></a>    visited <span class="op">=</span> {start_rc}</span>
<span id="cb37-277"><a href="#cb37-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-278"><a href="#cb37-278" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> q:</span>
<span id="cb37-279"><a href="#cb37-279" aria-hidden="true" tabindex="-1"></a>        (r, c), path <span class="op">=</span> q.popleft()</span>
<span id="cb37-280"><a href="#cb37-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-281"><a href="#cb37-281" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (r, c) <span class="op">==</span> end_rc:</span>
<span id="cb37-282"><a href="#cb37-282" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> path</span>
<span id="cb37-283"><a href="#cb37-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-284"><a href="#cb37-284" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> dr, dc <span class="kw">in</span> itertools.product([<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>], repeat<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb37-285"><a href="#cb37-285" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dr <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> dc <span class="op">==</span> <span class="dv">0</span>: <span class="cf">continue</span></span>
<span id="cb37-286"><a href="#cb37-286" aria-hidden="true" tabindex="-1"></a>            nr, nc <span class="op">=</span> r <span class="op">+</span> dr, c <span class="op">+</span> dc</span>
<span id="cb37-287"><a href="#cb37-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-288"><a href="#cb37-288" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> nr <span class="op">&lt;</span> h <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> nc <span class="op">&lt;</span> w <span class="kw">and</span> skeleton[nr, nc] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> (nr, nc) <span class="kw">not</span> <span class="kw">in</span> visited:</span>
<span id="cb37-289"><a href="#cb37-289" aria-hidden="true" tabindex="-1"></a>                visited.add((nr, nc))</span>
<span id="cb37-290"><a href="#cb37-290" aria-hidden="true" tabindex="-1"></a>                new_path <span class="op">=</span> path <span class="op">+</span> [(nc, nr)]</span>
<span id="cb37-291"><a href="#cb37-291" aria-hidden="true" tabindex="-1"></a>                q.append(((nr, nc), new_path))</span>
<span id="cb37-292"><a href="#cb37-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-293"><a href="#cb37-293" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-294"><a href="#cb37-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-295"><a href="#cb37-295" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_best_arrow_by_straightness(binary_mask, min_path_length<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb37-296"><a href="#cb37-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-297"><a href="#cb37-297" aria-hidden="true" tabindex="-1"></a>    skeleton <span class="op">=</span> extract_skeleton(binary_mask)</span>
<span id="cb37-298"><a href="#cb37-298" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.count_nonzero(skeleton) <span class="op">&lt;</span> min_path_length:</span>
<span id="cb37-299"><a href="#cb37-299" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-300"><a href="#cb37-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-301"><a href="#cb37-301" aria-hidden="true" tabindex="-1"></a>    endpoints, _ <span class="op">=</span> get_skeleton_graph_nodes(skeleton)</span>
<span id="cb37-302"><a href="#cb37-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-303"><a href="#cb37-303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(endpoints) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb37-304"><a href="#cb37-304" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> find_farthest_points_euclidean(binary_mask)</span>
<span id="cb37-305"><a href="#cb37-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-306"><a href="#cb37-306" aria-hidden="true" tabindex="-1"></a>    candidate_paths <span class="op">=</span> []</span>
<span id="cb37-307"><a href="#cb37-307" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p1, p2 <span class="kw">in</span> itertools.combinations(endpoints, <span class="dv">2</span>):</span>
<span id="cb37-308"><a href="#cb37-308" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> bfs_get_path(skeleton, p1, p2)</span>
<span id="cb37-309"><a href="#cb37-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-310"><a href="#cb37-310" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> path <span class="kw">and</span> <span class="bu">len</span>(path) <span class="op">&gt;=</span> min_path_length:</span>
<span id="cb37-311"><a href="#cb37-311" aria-hidden="true" tabindex="-1"></a>            path_length <span class="op">=</span> <span class="bu">len</span>(path)</span>
<span id="cb37-312"><a href="#cb37-312" aria-hidden="true" tabindex="-1"></a>            euclidean_dist <span class="op">=</span> math.dist(p1, p2)</span>
<span id="cb37-313"><a href="#cb37-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-314"><a href="#cb37-314" aria-hidden="true" tabindex="-1"></a>            straightness <span class="op">=</span> euclidean_dist <span class="op">/</span> path_length</span>
<span id="cb37-315"><a href="#cb37-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-316"><a href="#cb37-316" aria-hidden="true" tabindex="-1"></a>            score <span class="op">=</span> path_length <span class="op">*</span> straightness</span>
<span id="cb37-317"><a href="#cb37-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-318"><a href="#cb37-318" aria-hidden="true" tabindex="-1"></a>            candidate_paths.append({</span>
<span id="cb37-319"><a href="#cb37-319" aria-hidden="true" tabindex="-1"></a>                <span class="st">"endpoints"</span>: [p1, p2],</span>
<span id="cb37-320"><a href="#cb37-320" aria-hidden="true" tabindex="-1"></a>                <span class="st">"score"</span>: score,</span>
<span id="cb37-321"><a href="#cb37-321" aria-hidden="true" tabindex="-1"></a>                <span class="st">"length"</span>: path_length</span>
<span id="cb37-322"><a href="#cb37-322" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb37-323"><a href="#cb37-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-324"><a href="#cb37-324" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> candidate_paths:</span>
<span id="cb37-325"><a href="#cb37-325" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-326"><a href="#cb37-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-327"><a href="#cb37-327" aria-hidden="true" tabindex="-1"></a>    best_path <span class="op">=</span> <span class="bu">max</span>(candidate_paths, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'score'</span>])</span>
<span id="cb37-328"><a href="#cb37-328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_path[<span class="st">'endpoints'</span>]</span>
<span id="cb37-329"><a href="#cb37-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-330"><a href="#cb37-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-331"><a href="#cb37-331" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb37-332"><a href="#cb37-332" aria-hidden="true" tabindex="-1"></a><span class="co"># ----------   MAIN PIPELINE FUNCTION  ----------</span></span>
<span id="cb37-333"><a href="#cb37-333" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb37-334"><a href="#cb37-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-335"><a href="#cb37-335" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> skeleton_has_cycle(skeleton):</span>
<span id="cb37-336"><a href="#cb37-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-337"><a href="#cb37-337" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> skeleton.shape</span>
<span id="cb37-338"><a href="#cb37-338" aria-hidden="true" tabindex="-1"></a>    visited <span class="op">=</span> np.zeros((h, w), dtype<span class="op">=</span><span class="bu">bool</span>)</span>
<span id="cb37-339"><a href="#cb37-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-340"><a href="#cb37-340" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> neighbors(r, c):</span>
<span id="cb37-341"><a href="#cb37-341" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> dr <span class="kw">in</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]:</span>
<span id="cb37-342"><a href="#cb37-342" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> dc <span class="kw">in</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]:</span>
<span id="cb37-343"><a href="#cb37-343" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> dr <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> dc <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-344"><a href="#cb37-344" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb37-345"><a href="#cb37-345" aria-hidden="true" tabindex="-1"></a>                nr, nc <span class="op">=</span> r <span class="op">+</span> dr, c <span class="op">+</span> dc</span>
<span id="cb37-346"><a href="#cb37-346" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;=</span> nr <span class="op">&lt;</span> h <span class="kw">and</span> <span class="dv">0</span> <span class="op">&lt;=</span> nc <span class="op">&lt;</span> w <span class="kw">and</span> skeleton[nr, nc] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb37-347"><a href="#cb37-347" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">yield</span> nr, nc</span>
<span id="cb37-348"><a href="#cb37-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-349"><a href="#cb37-349" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dfs(r, c, pr, pc):</span>
<span id="cb37-350"><a href="#cb37-350" aria-hidden="true" tabindex="-1"></a>        visited[r, c] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb37-351"><a href="#cb37-351" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> nr, nc <span class="kw">in</span> neighbors(r, c):</span>
<span id="cb37-352"><a href="#cb37-352" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> visited[nr, nc]:</span>
<span id="cb37-353"><a href="#cb37-353" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> dfs(nr, nc, r, c):</span>
<span id="cb37-354"><a href="#cb37-354" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb37-355"><a href="#cb37-355" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> (nr, nc) <span class="op">!=</span> (pr, pc):</span>
<span id="cb37-356"><a href="#cb37-356" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb37-357"><a href="#cb37-357" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb37-358"><a href="#cb37-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-359"><a href="#cb37-359" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(h):</span>
<span id="cb37-360"><a href="#cb37-360" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(w):</span>
<span id="cb37-361"><a href="#cb37-361" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> skeleton[y, x] <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="kw">not</span> visited[y, x]:</span>
<span id="cb37-362"><a href="#cb37-362" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> dfs(y, x, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb37-363"><a href="#cb37-363" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb37-364"><a href="#cb37-364" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb37-365"><a href="#cb37-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-366"><a href="#cb37-366" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_farthest_geodesic_endpoints(skeleton):</span>
<span id="cb37-367"><a href="#cb37-367" aria-hidden="true" tabindex="-1"></a>    endpoints, _ <span class="op">=</span> get_skeleton_graph_nodes(skeleton)</span>
<span id="cb37-368"><a href="#cb37-368" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(endpoints) <span class="op">&lt;</span> <span class="dv">2</span>: <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb37-369"><a href="#cb37-369" aria-hidden="true" tabindex="-1"></a>    max_length, best_pair <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="va">None</span></span>
<span id="cb37-370"><a href="#cb37-370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p1, p2 <span class="kw">in</span> itertools.combinations(endpoints, <span class="dv">2</span>):</span>
<span id="cb37-371"><a href="#cb37-371" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> bfs_get_path(skeleton, p1, p2)</span>
<span id="cb37-372"><a href="#cb37-372" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> path <span class="kw">and</span> <span class="bu">len</span>(path) <span class="op">&gt;</span> max_length:</span>
<span id="cb37-373"><a href="#cb37-373" aria-hidden="true" tabindex="-1"></a>            max_length, best_pair <span class="op">=</span> <span class="bu">len</span>(path), (p1, p2)</span>
<span id="cb37-374"><a href="#cb37-374" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_pair</span>
<span id="cb37-375"><a href="#cb37-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-376"><a href="#cb37-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-377"><a href="#cb37-377" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dilate_ocr_regions(binary_mask, ocr_intrusions, crop_origin, vert_expand<span class="op">=</span><span class="dv">1</span>, horiz_expand<span class="op">=</span><span class="dv">1</span>, vert_iterations<span class="op">=</span><span class="dv">1</span>, horiz_iterations<span class="op">=</span><span class="dv">1</span>, erosion_kernel_size<span class="op">=</span><span class="dv">3</span>, erosion_iterations<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb37-378"><a href="#cb37-378" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.zeros_like(binary_mask)</span>
<span id="cb37-379"><a href="#cb37-379" aria-hidden="true" tabindex="-1"></a>    crop_x1, crop_y1 <span class="op">=</span> crop_origin</span>
<span id="cb37-380"><a href="#cb37-380" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> mask.shape</span>
<span id="cb37-381"><a href="#cb37-381" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ocr <span class="kw">in</span> ocr_intrusions:</span>
<span id="cb37-382"><a href="#cb37-382" aria-hidden="true" tabindex="-1"></a>        ox1, oy1, ox2, oy2 <span class="op">=</span> ocr[<span class="st">'bbox'</span>]</span>
<span id="cb37-383"><a href="#cb37-383" aria-hidden="true" tabindex="-1"></a>        local_x1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(ox1 <span class="op">-</span> crop_x1))</span>
<span id="cb37-384"><a href="#cb37-384" aria-hidden="true" tabindex="-1"></a>        local_y1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(oy1 <span class="op">-</span> crop_y1))</span>
<span id="cb37-385"><a href="#cb37-385" aria-hidden="true" tabindex="-1"></a>        local_x2 <span class="op">=</span> <span class="bu">min</span>(w, <span class="bu">int</span>(ox2 <span class="op">-</span> crop_x1))</span>
<span id="cb37-386"><a href="#cb37-386" aria-hidden="true" tabindex="-1"></a>        local_y2 <span class="op">=</span> <span class="bu">min</span>(h, <span class="bu">int</span>(oy2 <span class="op">-</span> crop_y1))</span>
<span id="cb37-387"><a href="#cb37-387" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> local_x1 <span class="op">&lt;</span> local_x2 <span class="kw">and</span> local_y1 <span class="op">&lt;</span> local_y2:</span>
<span id="cb37-388"><a href="#cb37-388" aria-hidden="true" tabindex="-1"></a>            mask[local_y1:local_y2, local_x1:local_x2] <span class="op">=</span> <span class="dv">255</span></span>
<span id="cb37-389"><a href="#cb37-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-390"><a href="#cb37-390" aria-hidden="true" tabindex="-1"></a>    vert_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_RECT, (<span class="dv">1</span>, vert_expand))</span>
<span id="cb37-391"><a href="#cb37-391" aria-hidden="true" tabindex="-1"></a>    horiz_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_RECT, (horiz_expand, <span class="dv">1</span>))</span>
<span id="cb37-392"><a href="#cb37-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-393"><a href="#cb37-393" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> cv2.dilate(mask, vert_kernel, iterations<span class="op">=</span>vert_iterations)</span>
<span id="cb37-394"><a href="#cb37-394" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> cv2.dilate(mask, horiz_kernel, iterations<span class="op">=</span>horiz_iterations)</span>
<span id="cb37-395"><a href="#cb37-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-396"><a href="#cb37-396" aria-hidden="true" tabindex="-1"></a>    combined <span class="op">=</span> cv2.bitwise_or(binary_mask, mask)</span>
<span id="cb37-397"><a href="#cb37-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-398"><a href="#cb37-398" aria-hidden="true" tabindex="-1"></a>    erosion_kernel <span class="op">=</span> cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (erosion_kernel_size, erosion_kernel_size))</span>
<span id="cb37-399"><a href="#cb37-399" aria-hidden="true" tabindex="-1"></a>    combined <span class="op">=</span> cv2.erode(combined, erosion_kernel, iterations<span class="op">=</span>erosion_iterations)</span>
<span id="cb37-400"><a href="#cb37-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-401"><a href="#cb37-401" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combined</span>
<span id="cb37-402"><a href="#cb37-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-403"><a href="#cb37-403" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_skeleton_points_on_bbox(skeleton, bbox_tl, bbox_br, margin<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb37-404"><a href="#cb37-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-405"><a href="#cb37-405" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> np.column_stack(np.where(skeleton <span class="op">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb37-406"><a href="#cb37-406" aria-hidden="true" tabindex="-1"></a>    x_min, y_min <span class="op">=</span> bbox_tl</span>
<span id="cb37-407"><a href="#cb37-407" aria-hidden="true" tabindex="-1"></a>    x_max, y_max <span class="op">=</span> bbox_br</span>
<span id="cb37-408"><a href="#cb37-408" aria-hidden="true" tabindex="-1"></a>    candidate_points <span class="op">=</span> []</span>
<span id="cb37-409"><a href="#cb37-409" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y, x <span class="kw">in</span> points:</span>
<span id="cb37-410"><a href="#cb37-410" aria-hidden="true" tabindex="-1"></a>        near_left <span class="op">=</span> <span class="bu">abs</span>(x <span class="op">-</span> x_min) <span class="op">&lt;=</span> margin <span class="kw">and</span> y_min <span class="op">&lt;=</span> y <span class="op">&lt;=</span> y_max</span>
<span id="cb37-411"><a href="#cb37-411" aria-hidden="true" tabindex="-1"></a>        near_right <span class="op">=</span> <span class="bu">abs</span>(x <span class="op">-</span> x_max) <span class="op">&lt;=</span> margin <span class="kw">and</span> y_min <span class="op">&lt;=</span> y <span class="op">&lt;=</span> y_max</span>
<span id="cb37-412"><a href="#cb37-412" aria-hidden="true" tabindex="-1"></a>        near_top <span class="op">=</span> <span class="bu">abs</span>(y <span class="op">-</span> y_min) <span class="op">&lt;=</span> margin <span class="kw">and</span> x_min <span class="op">&lt;=</span> x <span class="op">&lt;=</span> x_max</span>
<span id="cb37-413"><a href="#cb37-413" aria-hidden="true" tabindex="-1"></a>        near_bottom <span class="op">=</span> <span class="bu">abs</span>(y <span class="op">-</span> y_max) <span class="op">&lt;=</span> margin <span class="kw">and</span> x_min <span class="op">&lt;=</span> x <span class="op">&lt;=</span> x_max</span>
<span id="cb37-414"><a href="#cb37-414" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> near_left <span class="kw">or</span> near_right <span class="kw">or</span> near_top <span class="kw">or</span> near_bottom:</span>
<span id="cb37-415"><a href="#cb37-415" aria-hidden="true" tabindex="-1"></a>            candidate_points.append((x, y))</span>
<span id="cb37-416"><a href="#cb37-416" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> candidate_points</span>
<span id="cb37-417"><a href="#cb37-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-418"><a href="#cb37-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-419"><a href="#cb37-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-420"><a href="#cb37-420" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> debug_stage(image, detections, ocr_results):</span>
<span id="cb37-421"><a href="#cb37-421" aria-hidden="true" tabindex="-1"></a>    vectors <span class="op">=</span> []</span>
<span id="cb37-422"><a href="#cb37-422" aria-hidden="true" tabindex="-1"></a>    arrow_labels <span class="op">=</span> [<span class="st">"dashed-arrow"</span>, <span class="st">"dotted-arrow"</span>, <span class="st">"solid-arrow"</span>]</span>
<span id="cb37-423"><a href="#cb37-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-424"><a href="#cb37-424" aria-hidden="true" tabindex="-1"></a>    non_arrow_labels <span class="op">=</span> [<span class="st">"Diamond"</span>]</span>
<span id="cb37-425"><a href="#cb37-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-426"><a href="#cb37-426" aria-hidden="true" tabindex="-1"></a>    arrows <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> detections <span class="cf">if</span> d[<span class="dv">0</span>] <span class="kw">in</span> arrow_labels]</span>
<span id="cb37-427"><a href="#cb37-427" aria-hidden="true" tabindex="-1"></a>    interfering_objects <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> detections <span class="cf">if</span> d[<span class="dv">0</span>] <span class="kw">in</span> non_arrow_labels]</span>
<span id="cb37-428"><a href="#cb37-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-429"><a href="#cb37-429" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, (label, top_left, bottom_right) <span class="kw">in</span> <span class="bu">enumerate</span>(arrows):</span>
<span id="cb37-430"><a href="#cb37-430" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">=== Processing Arrow </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">) ==="</span>)</span>
<span id="cb37-431"><a href="#cb37-431" aria-hidden="true" tabindex="-1"></a>        crop_x1, crop_y1 <span class="op">=</span> <span class="bu">int</span>(top_left[<span class="dv">0</span>]), <span class="bu">int</span>(top_left[<span class="dv">1</span>])</span>
<span id="cb37-432"><a href="#cb37-432" aria-hidden="true" tabindex="-1"></a>        crop <span class="op">=</span> crop_image_region(image, top_left, bottom_right)</span>
<span id="cb37-433"><a href="#cb37-433" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> crop.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-434"><a href="#cb37-434" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb37-435"><a href="#cb37-435" aria-hidden="true" tabindex="-1"></a>        show_image(<span class="ss">f"Crop </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span>, crop)</span>
<span id="cb37-436"><a href="#cb37-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-437"><a href="#cb37-437" aria-hidden="true" tabindex="-1"></a>        binary_mask <span class="op">=</span> convert_to_binary_mask(crop)</span>
<span id="cb37-438"><a href="#cb37-438" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> binary_mask.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb37-439"><a href="#cb37-439" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb37-440"><a href="#cb37-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-441"><a href="#cb37-441" aria-hidden="true" tabindex="-1"></a>        processed_mask <span class="op">=</span> binary_mask.copy()</span>
<span id="cb37-442"><a href="#cb37-442" aria-hidden="true" tabindex="-1"></a>        endpoints <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-443"><a href="#cb37-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-444"><a href="#cb37-444" aria-hidden="true" tabindex="-1"></a>        is_arrow_arrow_overlap <span class="op">=</span> <span class="bu">any</span>(</span>
<span id="cb37-445"><a href="#cb37-445" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">!=</span> other_idx <span class="kw">and</span> check_bbox_intersection(top_left, bottom_right, other_tl, other_br)</span>
<span id="cb37-446"><a href="#cb37-446" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> other_idx, (_, other_tl, other_br) <span class="kw">in</span> <span class="bu">enumerate</span>(arrows)</span>
<span id="cb37-447"><a href="#cb37-447" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb37-448"><a href="#cb37-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-449"><a href="#cb37-449" aria-hidden="true" tabindex="-1"></a>        ocr_intrusions <span class="op">=</span> []</span>
<span id="cb37-450"><a href="#cb37-450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ocr_results:</span>
<span id="cb37-451"><a href="#cb37-451" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ocr <span class="kw">in</span> ocr_results:</span>
<span id="cb37-452"><a href="#cb37-452" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> bbox_iou((top_left[<span class="dv">0</span>], top_left[<span class="dv">1</span>], bottom_right[<span class="dv">0</span>], bottom_right[<span class="dv">1</span>]), ocr[<span class="st">'bbox'</span>]) <span class="op">&gt;</span> <span class="fl">0.02</span>:</span>
<span id="cb37-453"><a href="#cb37-453" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> pixel_level_ocr_interference(processed_mask, ocr[<span class="st">'bbox'</span>], (crop_x1, crop_y1), coverage_threshold<span class="op">=</span><span class="fl">0.02</span>):</span>
<span id="cb37-454"><a href="#cb37-454" aria-hidden="true" tabindex="-1"></a>                        ocr_intrusions.append(ocr)</span>
<span id="cb37-455"><a href="#cb37-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-456"><a href="#cb37-456" aria-hidden="true" tabindex="-1"></a>        ocr_interrupted <span class="op">=</span> <span class="bu">len</span>(ocr_intrusions) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb37-457"><a href="#cb37-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-458"><a href="#cb37-458" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> ocr_interrupted:</span>
<span id="cb37-459"><a href="#cb37-459" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> label <span class="op">==</span> <span class="st">"dashed-arrow"</span>:</span>
<span id="cb37-460"><a href="#cb37-460" aria-hidden="true" tabindex="-1"></a>                processed_mask <span class="op">=</span> interpolate_dashed_arrows(processed_mask)</span>
<span id="cb37-461"><a href="#cb37-461" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> label <span class="op">==</span> <span class="st">"dotted-arrow"</span>:</span>
<span id="cb37-462"><a href="#cb37-462" aria-hidden="true" tabindex="-1"></a>                processed_mask <span class="op">=</span> connect_dotted_simple_morph(processed_mask, kernel_size<span class="op">=</span><span class="dv">5</span>, iterations<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb37-463"><a href="#cb37-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-464"><a href="#cb37-464" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ocr_interrupted:</span>
<span id="cb37-465"><a href="#cb37-465" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"--&gt; Strategy: OCR interruption detected. Masking OCR and applying interpolation on all."</span>)</span>
<span id="cb37-466"><a href="#cb37-466" aria-hidden="true" tabindex="-1"></a>            processed_mask <span class="op">=</span> mask_overlapping_ocr_regions(processed_mask, ocr_intrusions, (crop_x1, crop_y1))</span>
<span id="cb37-467"><a href="#cb37-467" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ocr <span class="kw">in</span> ocr_intrusions:</span>
<span id="cb37-468"><a href="#cb37-468" aria-hidden="true" tabindex="-1"></a>                ox1, oy1, ox2, oy2 <span class="op">=</span> ocr[<span class="st">'bbox'</span>]</span>
<span id="cb37-469"><a href="#cb37-469" aria-hidden="true" tabindex="-1"></a>                o_local <span class="op">=</span> (ox1 <span class="op">-</span> crop_x1, oy1 <span class="op">-</span> crop_y1, ox2 <span class="op">-</span> crop_x1, oy2 <span class="op">-</span> crop_y1)</span>
<span id="cb37-470"><a href="#cb37-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-471"><a href="#cb37-471" aria-hidden="true" tabindex="-1"></a>            processed_mask <span class="op">=</span> dilate_ocr_regions(</span>
<span id="cb37-472"><a href="#cb37-472" aria-hidden="true" tabindex="-1"></a>                processed_mask, ocr_intrusions, (crop_x1, crop_y1),</span>
<span id="cb37-473"><a href="#cb37-473" aria-hidden="true" tabindex="-1"></a>                vert_expand<span class="op">=</span><span class="dv">5</span>, horiz_expand<span class="op">=</span><span class="dv">10</span>, vert_iterations<span class="op">=</span><span class="dv">3</span>, horiz_iterations<span class="op">=</span><span class="dv">1</span></span>
<span id="cb37-474"><a href="#cb37-474" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb37-475"><a href="#cb37-475" aria-hidden="true" tabindex="-1"></a>            processed_mask <span class="op">=</span> connect_dotted_simple_morph(processed_mask, kernel_size<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb37-476"><a href="#cb37-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-477"><a href="#cb37-477" aria-hidden="true" tabindex="-1"></a>            skeleton <span class="op">=</span> extract_skeleton(processed_mask)</span>
<span id="cb37-478"><a href="#cb37-478" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> skeleton_has_cycle(skeleton):</span>
<span id="cb37-479"><a href="#cb37-479" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"Cycle detected in skeleton within OCR interrupted region"</span>)</span>
<span id="cb37-480"><a href="#cb37-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-481"><a href="#cb37-481" aria-hidden="true" tabindex="-1"></a>                intersecting_shapes <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> interfering_objects <span class="cf">if</span> check_bbox_intersection(top_left, bottom_right, d[<span class="dv">1</span>], d[<span class="dv">2</span>])]</span>
<span id="cb37-482"><a href="#cb37-482" aria-hidden="true" tabindex="-1"></a>                all_intersection_points <span class="op">=</span> []</span>
<span id="cb37-483"><a href="#cb37-483" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> shape_tl, shape_br <span class="kw">in</span> [d[<span class="dv">1</span>:<span class="dv">3</span>] <span class="cf">for</span> d <span class="kw">in</span> intersecting_shapes]:</span>
<span id="cb37-484"><a href="#cb37-484" aria-hidden="true" tabindex="-1"></a>                    local_shape_tl <span class="op">=</span> (shape_tl[<span class="dv">0</span>] <span class="op">-</span> crop_x1, shape_tl[<span class="dv">1</span>] <span class="op">-</span> crop_y1)</span>
<span id="cb37-485"><a href="#cb37-485" aria-hidden="true" tabindex="-1"></a>                    local_shape_br <span class="op">=</span> (shape_br[<span class="dv">0</span>] <span class="op">-</span> crop_x1, shape_br[<span class="dv">1</span>] <span class="op">-</span> crop_y1)</span>
<span id="cb37-486"><a href="#cb37-486" aria-hidden="true" tabindex="-1"></a>                    points_on_bbox <span class="op">=</span> find_skeleton_points_on_bbox(</span>
<span id="cb37-487"><a href="#cb37-487" aria-hidden="true" tabindex="-1"></a>                        skeleton, local_shape_tl, local_shape_br, margin<span class="op">=</span><span class="dv">2</span></span>
<span id="cb37-488"><a href="#cb37-488" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb37-489"><a href="#cb37-489" aria-hidden="true" tabindex="-1"></a>                    all_intersection_points.extend(points_on_bbox)</span>
<span id="cb37-490"><a href="#cb37-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-491"><a href="#cb37-491" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(all_intersection_points) <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb37-492"><a href="#cb37-492" aria-hidden="true" tabindex="-1"></a>                    max_dist <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb37-493"><a href="#cb37-493" aria-hidden="true" tabindex="-1"></a>                    endpoints <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-494"><a href="#cb37-494" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> p1, p2 <span class="kw">in</span> itertools.combinations(all_intersection_points, <span class="dv">2</span>):</span>
<span id="cb37-495"><a href="#cb37-495" aria-hidden="true" tabindex="-1"></a>                        dist <span class="op">=</span> math.dist(p1, p2)</span>
<span id="cb37-496"><a href="#cb37-496" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> dist <span class="op">&gt;</span> max_dist:</span>
<span id="cb37-497"><a href="#cb37-497" aria-hidden="true" tabindex="-1"></a>                            max_dist <span class="op">=</span> dist</span>
<span id="cb37-498"><a href="#cb37-498" aria-hidden="true" tabindex="-1"></a>                            endpoints <span class="op">=</span> [p1, p2]</span>
<span id="cb37-499"><a href="#cb37-499" aria-hidden="true" tabindex="-1"></a>                    endpoints <span class="op">=</span> [(x <span class="op">+</span> crop_x1, y <span class="op">+</span> crop_y1) <span class="cf">for</span> x, y <span class="kw">in</span> endpoints]</span>
<span id="cb37-500"><a href="#cb37-500" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb37-501"><a href="#cb37-501" aria-hidden="true" tabindex="-1"></a>                    endpoints <span class="op">=</span> find_best_arrow_by_straightness(processed_mask)</span>
<span id="cb37-502"><a href="#cb37-502" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> endpoints <span class="kw">and</span> <span class="bu">len</span>(endpoints) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb37-503"><a href="#cb37-503" aria-hidden="true" tabindex="-1"></a>                        endpoints <span class="op">=</span> [(x <span class="op">+</span> crop_x1, y <span class="op">+</span> crop_y1) <span class="cf">for</span> x, y <span class="kw">in</span> endpoints]</span>
<span id="cb37-504"><a href="#cb37-504" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb37-505"><a href="#cb37-505" aria-hidden="true" tabindex="-1"></a>                endpoints <span class="op">=</span> find_best_arrow_by_straightness(processed_mask)</span>
<span id="cb37-506"><a href="#cb37-506" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> endpoints <span class="kw">or</span> <span class="bu">len</span>(endpoints) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb37-507"><a href="#cb37-507" aria-hidden="true" tabindex="-1"></a>                    endpoints <span class="op">=</span> find_farthest_points_euclidean(processed_mask)</span>
<span id="cb37-508"><a href="#cb37-508" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> endpoints:</span>
<span id="cb37-509"><a href="#cb37-509" aria-hidden="true" tabindex="-1"></a>                    endpoints <span class="op">=</span> [(x <span class="op">+</span> crop_x1, y <span class="op">+</span> crop_y1) <span class="cf">for</span> x, y <span class="kw">in</span> endpoints]</span>
<span id="cb37-510"><a href="#cb37-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-511"><a href="#cb37-511" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> is_arrow_arrow_overlap:</span>
<span id="cb37-512"><a href="#cb37-512" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"--&gt; Strategy: Overlap detected. Using straightness scoring."</span>)</span>
<span id="cb37-513"><a href="#cb37-513" aria-hidden="true" tabindex="-1"></a>            endpoints <span class="op">=</span> find_best_arrow_by_straightness(processed_mask)</span>
<span id="cb37-514"><a href="#cb37-514" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> endpoints:</span>
<span id="cb37-515"><a href="#cb37-515" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">"--&gt; Scoring failed. Falling back to farthest points."</span>)</span>
<span id="cb37-516"><a href="#cb37-516" aria-hidden="true" tabindex="-1"></a>                endpoints <span class="op">=</span> find_farthest_points_euclidean(processed_mask)</span>
<span id="cb37-517"><a href="#cb37-517" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> endpoints:</span>
<span id="cb37-518"><a href="#cb37-518" aria-hidden="true" tabindex="-1"></a>                endpoints <span class="op">=</span> [(x <span class="op">+</span> crop_x1, y <span class="op">+</span> crop_y1) <span class="cf">for</span> x, y <span class="kw">in</span> endpoints]</span>
<span id="cb37-519"><a href="#cb37-519" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb37-520"><a href="#cb37-520" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"--&gt; Strategy: General arrow analysis with straightness scoring."</span>)</span>
<span id="cb37-521"><a href="#cb37-521" aria-hidden="true" tabindex="-1"></a>            endpoints <span class="op">=</span> find_best_arrow_by_straightness(processed_mask)</span>
<span id="cb37-522"><a href="#cb37-522" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> endpoints:</span>
<span id="cb37-523"><a href="#cb37-523" aria-hidden="true" tabindex="-1"></a>                endpoints <span class="op">=</span> [(x <span class="op">+</span> crop_x1, y <span class="op">+</span> crop_y1) <span class="cf">for</span> x, y <span class="kw">in</span> endpoints]</span>
<span id="cb37-524"><a href="#cb37-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-525"><a href="#cb37-525" aria-hidden="true" tabindex="-1"></a>        show_image(<span class="ss">f"Final Processed Mask </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span>, processed_mask, cmap<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb37-526"><a href="#cb37-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-527"><a href="#cb37-527" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> endpoints <span class="kw">or</span> <span class="bu">len</span>(endpoints) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb37-528"><a href="#cb37-528" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"-&gt; Arrow </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">: FAILED to find 2 endpoints."</span>)</span>
<span id="cb37-529"><a href="#cb37-529" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb37-530"><a href="#cb37-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-531"><a href="#cb37-531" aria-hidden="true" tabindex="-1"></a>        arrowhead_detections <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> detections <span class="cf">if</span> d[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"arrow_head"</span> <span class="kw">and</span> check_bbox_intersection(top_left, bottom_right, d[<span class="dv">1</span>], d[<span class="dv">2</span>])]</span>
<span id="cb37-532"><a href="#cb37-532" aria-hidden="true" tabindex="-1"></a>        arrowhead_bboxes <span class="op">=</span> [(d[<span class="dv">1</span>], d[<span class="dv">2</span>]) <span class="cf">for</span> d <span class="kw">in</span> arrowhead_detections]</span>
<span id="cb37-533"><a href="#cb37-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-534"><a href="#cb37-534" aria-hidden="true" tabindex="-1"></a>        matched_tail <span class="op">=</span> match_arrowhead_to_endpoint(arrowhead_bboxes, endpoints, (crop_x1, crop_y1))</span>
<span id="cb37-535"><a href="#cb37-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-536"><a href="#cb37-536" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> matched_tail <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb37-537"><a href="#cb37-537" aria-hidden="true" tabindex="-1"></a>            tail_global <span class="op">=</span> matched_tail</span>
<span id="cb37-538"><a href="#cb37-538" aria-hidden="true" tabindex="-1"></a>            head_global <span class="op">=</span> endpoints[<span class="dv">1</span>] <span class="cf">if</span> endpoints[<span class="dv">0</span>] <span class="op">==</span> tail_global <span class="cf">else</span> endpoints[<span class="dv">0</span>]</span>
<span id="cb37-539"><a href="#cb37-539" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb37-540"><a href="#cb37-540" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span> bottom_right[<span class="dv">0</span>] <span class="op">-</span> top_left[<span class="dv">0</span>]</span>
<span id="cb37-541"><a href="#cb37-541" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> bottom_right[<span class="dv">1</span>] <span class="op">-</span> top_left[<span class="dv">1</span>]</span>
<span id="cb37-542"><a href="#cb37-542" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> width <span class="op">&gt;=</span> height:</span>
<span id="cb37-543"><a href="#cb37-543" aria-hidden="true" tabindex="-1"></a>                tail_global, head_global <span class="op">=</span> <span class="bu">sorted</span>(endpoints, key<span class="op">=</span><span class="kw">lambda</span> e: e[<span class="dv">0</span>])</span>
<span id="cb37-544"><a href="#cb37-544" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb37-545"><a href="#cb37-545" aria-hidden="true" tabindex="-1"></a>                tail_global, head_global <span class="op">=</span> <span class="bu">sorted</span>(endpoints, key<span class="op">=</span><span class="kw">lambda</span> e: e[<span class="dv">1</span>])</span>
<span id="cb37-546"><a href="#cb37-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-547"><a href="#cb37-547" aria-hidden="true" tabindex="-1"></a>        tail_local <span class="op">=</span> (tail_global[<span class="dv">0</span>] <span class="op">-</span> crop_x1, tail_global[<span class="dv">1</span>] <span class="op">-</span> crop_y1)</span>
<span id="cb37-548"><a href="#cb37-548" aria-hidden="true" tabindex="-1"></a>        head_local <span class="op">=</span> (head_global[<span class="dv">0</span>] <span class="op">-</span> crop_x1, head_global[<span class="dv">1</span>] <span class="op">-</span> crop_y1)</span>
<span id="cb37-549"><a href="#cb37-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-550"><a href="#cb37-550" aria-hidden="true" tabindex="-1"></a>        vis_endpoints <span class="op">=</span> crop.copy()</span>
<span id="cb37-551"><a href="#cb37-551" aria-hidden="true" tabindex="-1"></a>        cv2.circle(vis_endpoints, (<span class="bu">int</span>(head_local[<span class="dv">0</span>]), <span class="bu">int</span>(head_local[<span class="dv">1</span>])), <span class="dv">5</span>, (<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">255</span>), <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb37-552"><a href="#cb37-552" aria-hidden="true" tabindex="-1"></a>        cv2.circle(vis_endpoints, (<span class="bu">int</span>(tail_local[<span class="dv">0</span>]), <span class="bu">int</span>(tail_local[<span class="dv">1</span>])), <span class="dv">5</span>, (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>), <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb37-553"><a href="#cb37-553" aria-hidden="true" tabindex="-1"></a>        show_image(<span class="ss">f"Endpoints </span><span class="sc">{</span>idx<span class="sc">}</span><span class="ss">"</span>, vis_endpoints)</span>
<span id="cb37-554"><a href="#cb37-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-555"><a href="#cb37-555" aria-hidden="true" tabindex="-1"></a>        vectors.append({</span>
<span id="cb37-556"><a href="#cb37-556" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tail"</span>: tail_global, <span class="st">"head"</span>: head_global,</span>
<span id="cb37-557"><a href="#cb37-557" aria-hidden="true" tabindex="-1"></a>            <span class="st">"bbox"</span>: (top_left, bottom_right), <span class="st">"label"</span>: label</span>
<span id="cb37-558"><a href="#cb37-558" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb37-559"><a href="#cb37-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-560"><a href="#cb37-560" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vectors</span>
<span id="cb37-561"><a href="#cb37-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-562"><a href="#cb37-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-563"><a href="#cb37-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-564"><a href="#cb37-564" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> cv2.imread(file_path)</span>
<span id="cb37-565"><a href="#cb37-565" aria-hidden="true" tabindex="-1"></a>detections <span class="op">=</span> detections_list</span>
<span id="cb37-566"><a href="#cb37-566" aria-hidden="true" tabindex="-1"></a>vectors <span class="op">=</span> debug_stage(image, detections,final_processed_data)</span>
<span id="cb37-567"><a href="#cb37-567" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Results from Full Pipeline ==="</span>)</span>
<span id="cb37-568"><a href="#cb37-568" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> v <span class="kw">in</span> vectors:</span>
<span id="cb37-569"><a href="#cb37-569" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"Arrow: Tail=</span><span class="sc">{</span>v[<span class="st">'tail'</span>]<span class="sc">}</span><span class="ss"> → Head=</span><span class="sc">{</span>v[<span class="st">'head'</span>]<span class="sc">}</span><span class="ss"> -&gt; Label=</span><span class="sc">{</span>v[<span class="st">'label'</span>]<span class="sc">}</span><span class="ss"> "</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Results from Full Pipeline ===</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}}" data-outputid="a7aee19d-2bb5-46cf-b52c-1e03d8818e25" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> splprep, splev</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> show_image(title, img, cmap<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(img.shape) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        plt.imshow(img, cmap<span class="op">=</span>cmap <span class="kw">or</span> <span class="st">"gray"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    plt.title(title, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">"off"</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> point_to_bbox_distance(point, top_left, bottom_right):</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    px, py <span class="op">=</span> point</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    x1, y1 <span class="op">=</span> top_left</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    x2, y2 <span class="op">=</span> bottom_right</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x1 <span class="op">&lt;=</span> px <span class="op">&lt;=</span> x2 <span class="kw">and</span> y1 <span class="op">&lt;=</span> py <span class="op">&lt;=</span> y2:</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> <span class="bu">max</span>(x1 <span class="op">-</span> px, <span class="dv">0</span>, px <span class="op">-</span> x2)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    dy <span class="op">=</span> <span class="bu">max</span>(y1 <span class="op">-</span> py, <span class="dv">0</span>, py <span class="op">-</span> y2)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> math.sqrt(dx<span class="op">*</span>dx <span class="op">+</span> dy<span class="op">*</span>dy)</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> nearest_point_on_bbox(point, top_left, bottom_right):</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    px, py <span class="op">=</span> point</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    x1, y1 <span class="op">=</span> top_left</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    x2, y2 <span class="op">=</span> bottom_right</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    cx <span class="op">=</span> <span class="bu">min</span>(<span class="bu">max</span>(px, x1), x2)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    cy <span class="op">=</span> <span class="bu">min</span>(<span class="bu">max</span>(py, y1), y2)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="bu">int</span>(<span class="bu">round</span>(cx)), <span class="bu">int</span>(<span class="bu">round</span>(cy)))</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_nearest_shape_bbox(point, shapes, max_distance<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> shapes:</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    min_dist <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    nearest_shape <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    nearest_pt <span class="op">=</span> <span class="va">None</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> shape <span class="kw">in</span> shapes:</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>        label, top_left, bottom_right <span class="op">=</span> shape</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>        pt_on_bbox <span class="op">=</span> nearest_point_on_bbox(point, top_left, bottom_right)</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>        dist <span class="op">=</span> math.hypot(pt_on_bbox[<span class="dv">0</span>] <span class="op">-</span> point[<span class="dv">0</span>], pt_on_bbox[<span class="dv">1</span>] <span class="op">-</span> point[<span class="dv">1</span>])</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dist <span class="op">&lt;</span> min_dist:</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>            min_dist <span class="op">=</span> dist</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>            nearest_shape <span class="op">=</span> shape</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>            nearest_pt <span class="op">=</span> pt_on_bbox</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_distance <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> min_dist <span class="op">&gt;</span> max_distance:</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nearest_shape, nearest_pt, min_dist</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> draw_connections_on_image(image, connections):</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>    vis_image <span class="op">=</span> image.copy()</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>    ARROW_COLOR <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">0</span>)       <span class="co"># green</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>    HEAD_COLOR <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">0</span>)        <span class="co"># red</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    TAIL_COLOR <span class="op">=</span> (<span class="dv">0</span>, <span class="dv">255</span>, <span class="dv">255</span>)      <span class="co"># cyan</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    CONNECTION_COLOR <span class="op">=</span> (<span class="dv">255</span>, <span class="dv">0</span>, <span class="dv">255</span>) <span class="co"># magenta</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> conn <span class="kw">in</span> connections:</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>        head <span class="op">=</span> conn[<span class="st">"head"</span>]</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>        tail <span class="op">=</span> conn[<span class="st">"tail"</span>]</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>        cv2.arrowedLine(vis_image, tail, head, ARROW_COLOR, <span class="dv">2</span>, tipLength<span class="op">=</span><span class="fl">0.04</span>)</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>        cv2.circle(vis_image, head, <span class="dv">8</span>, HEAD_COLOR, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>        cv2.circle(vis_image, tail, <span class="dv">8</span>, TAIL_COLOR, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conn.get(<span class="st">"head_connected_to"</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>            head_pt <span class="op">=</span> conn.get(<span class="st">"head_connection_point"</span>)</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> head_pt <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>                _, tl, br <span class="op">=</span> conn[<span class="st">"head_connected_to"</span>]</span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>                head_pt <span class="op">=</span> (<span class="bu">int</span>((tl[<span class="dv">0</span>] <span class="op">+</span> br[<span class="dv">0</span>]) <span class="op">/</span> <span class="dv">2</span>), <span class="bu">int</span>((tl[<span class="dv">1</span>] <span class="op">+</span> br[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>            cv2.line(vis_image, head, head_pt, CONNECTION_COLOR, <span class="dv">2</span>, cv2.LINE_AA)</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>            cv2.circle(vis_image, head_pt, <span class="dv">5</span>, CONNECTION_COLOR, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> conn.get(<span class="st">"tail_connected_to"</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>            tail_pt <span class="op">=</span> conn.get(<span class="st">"tail_connection_point"</span>)</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> tail_pt <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>                _, tl, br <span class="op">=</span> conn[<span class="st">"tail_connected_to"</span>]</span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a>                tail_pt <span class="op">=</span> (<span class="bu">int</span>((tl[<span class="dv">0</span>] <span class="op">+</span> br[<span class="dv">0</span>]) <span class="op">/</span> <span class="dv">2</span>), <span class="bu">int</span>((tl[<span class="dv">1</span>] <span class="op">+</span> br[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>            cv2.line(vis_image, tail, tail_pt, CONNECTION_COLOR, <span class="dv">2</span>, cv2.LINE_AA)</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>            cv2.circle(vis_image, tail_pt, <span class="dv">5</span>, CONNECTION_COLOR, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vis_image</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> establish_connections(vectors, all_detections):</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a>    labels_to_exclude <span class="op">=</span> [<span class="st">"dashed-arrow"</span>, <span class="st">"dotted-arrow"</span>, <span class="st">"solid-arrow"</span>, <span class="st">"arrow_head"</span>]</span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>    shape_detections <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> all_detections <span class="cf">if</span> d[<span class="dv">0</span>] <span class="kw">not</span> <span class="kw">in</span> labels_to_exclude]</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>    connections <span class="op">=</span> []</span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> vector <span class="kw">in</span> vectors:</span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a>        head_point <span class="op">=</span> vector[<span class="st">"head"</span>]</span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a>        tail_point <span class="op">=</span> vector[<span class="st">"tail"</span>]</span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a>        MAX_CONNECTION_DISTANCE <span class="op">=</span> <span class="dv">44</span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a>        head_shape, head_pt_on_bbox, head_dist <span class="op">=</span> find_nearest_shape_bbox(</span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a>            head_point, shape_detections, max_distance<span class="op">=</span>MAX_CONNECTION_DISTANCE</span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>        tail_shape, tail_pt_on_bbox, tail_dist <span class="op">=</span> find_nearest_shape_bbox(</span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a>            tail_point, shape_detections, max_distance<span class="op">=</span>MAX_CONNECTION_DISTANCE</span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a>        connections.append({</span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a>            <span class="st">"head"</span>: head_point,</span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tail"</span>: tail_point,</span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">"head_connected_to"</span>: head_shape,</span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a>            <span class="st">"head_connection_point"</span>: head_pt_on_bbox,</span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a>            <span class="st">"head_connection_dist"</span>: head_dist,</span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tail_connected_to"</span>: tail_shape,</span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tail_connection_point"</span>: tail_pt_on_bbox,</span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tail_connection_dist"</span>: tail_dist,</span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>            <span class="st">"original_label"</span>: vector.get(<span class="st">"label"</span>, <span class="st">""</span>)</span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> connections</span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a>arrow_connections <span class="op">=</span> establish_connections(vectors, detections)</span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- ARROW CONNECTION RESULTS ---"</span>)</span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, conn <span class="kw">in</span> <span class="bu">enumerate</span>(arrow_connections):</span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a>    head_label <span class="op">=</span> conn[<span class="st">'head_connected_to'</span>][<span class="dv">0</span>] <span class="cf">if</span> conn[<span class="st">'head_connected_to'</span>] <span class="cf">else</span> <span class="st">'None'</span></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a>    tail_label <span class="op">=</span> conn[<span class="st">'tail_connected_to'</span>][<span class="dv">0</span>] <span class="cf">if</span> conn[<span class="st">'tail_connected_to'</span>] <span class="cf">else</span> <span class="st">'None'</span></span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Arrow </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>conn[<span class="st">'original_label'</span>]<span class="sc">}</span><span class="ss">):</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"  - TAIL at </span><span class="sc">{</span>conn[<span class="st">'tail'</span>]<span class="sc">}</span><span class="ss"> connects to -&gt; </span><span class="sc">{</span>tail_label<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"  - HEAD at </span><span class="sc">{</span>conn[<span class="st">'head'</span>]<span class="sc">}</span><span class="ss"> connects to -&gt; </span><span class="sc">{</span>head_label<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a>visualization_image <span class="op">=</span> draw_connections_on_image(image, arrow_connections)</span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a>show_image(<span class="st">"Final Arrow Connections"</span>, visualization_image)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- ARROW CONNECTION RESULTS ---</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-22-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="angle-prediction-of-shapes" class="level1">
<h1><strong>Angle Prediction of shapes</strong></h1>
<p><strong>Run once when the notebook is run from start</strong></p>
<div id="cell-40" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="48f87561-829b-48ee-9efc-87c3b418e30b" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>/content/sam2</code></pre>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_text_rotation_for_shape(shape_bbox, ocr_data, threshold<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    sx1, sy1, sx2, sy2 <span class="op">=</span> shape_bbox</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    shape_area <span class="op">=</span> (sx2 <span class="op">-</span> sx1) <span class="op">*</span> (sy2 <span class="op">-</span> sy1)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    best_overlap <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    best_rotation <span class="op">=</span> <span class="va">None</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ocr_item <span class="kw">in</span> ocr_data:</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        tx1, ty1, tx2, ty2 <span class="op">=</span> ocr_item[<span class="st">'bbox'</span>]</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        ix1 <span class="op">=</span> <span class="bu">max</span>(sx1, tx1)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>        iy1 <span class="op">=</span> <span class="bu">max</span>(sy1, ty1)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>        ix2 <span class="op">=</span> <span class="bu">min</span>(sx2, tx2)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>        iy2 <span class="op">=</span> <span class="bu">min</span>(sy2, ty2)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ix1 <span class="op">&lt;</span> ix2 <span class="kw">and</span> iy1 <span class="op">&lt;</span> iy2:</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>            intersection <span class="op">=</span> (ix2 <span class="op">-</span> ix1) <span class="op">*</span> (iy2 <span class="op">-</span> iy1)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>            text_area <span class="op">=</span> (tx2 <span class="op">-</span> tx1) <span class="op">*</span> (ty2 <span class="op">-</span> ty1)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>            overlap_ratio <span class="op">=</span> intersection <span class="op">/</span> text_area <span class="cf">if</span> text_area <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> overlap_ratio <span class="op">&gt;</span> threshold <span class="kw">and</span> overlap_ratio <span class="op">&gt;</span> best_overlap:</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>                best_overlap <span class="op">=</span> overlap_ratio</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>                best_rotation <span class="op">=</span> ocr_item.get(<span class="st">'polygon_rotation'</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>                                            ocr_item.get(<span class="st">'paddleocr_orientation'</span>, <span class="dv">0</span>))</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_rotation</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-42" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="c28c7b1b-322b-4074-9b50-5e36f8d0879f" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torchvision <span class="im">import</span> models, transforms</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sam2.build_sam <span class="im">import</span> build_sam2</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sam2.sam2_image_predictor <span class="im">import</span> SAM2ImagePredictor</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_overlap(box1, box2):</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    x1_a, y1_a, x2_a, y2_a <span class="op">=</span> box1</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    x1_b, y1_b, x2_b, y2_b <span class="op">=</span> box2</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x2_a <span class="op">&lt;</span> x1_b <span class="kw">or</span> x2_b <span class="op">&lt;</span> x1_a:</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y2_a <span class="op">&lt;</span> y1_b <span class="kw">or</span> y2_b <span class="op">&lt;</span> y1_a:</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>detections <span class="op">=</span> detections_list</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>include_labels <span class="op">=</span> <span class="bu">set</span>([</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pentagon"</span>, <span class="st">"Racetrack"</span>,</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Triangle"</span>, <span class="st">"arrow"</span>, <span class="st">"rectangle"</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>filtered_detections <span class="op">=</span> [det <span class="cf">for</span> det <span class="kw">in</span> detections <span class="cf">if</span> det[<span class="dv">0</span>] <span class="kw">in</span> include_labels]</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>boxes <span class="op">=</span> [[<span class="bu">float</span>(x1), <span class="bu">float</span>(y1), <span class="bu">float</span>(x2), <span class="bu">float</span>(y2)] <span class="cf">for</span> _, (x1, y1), (x2, y2) <span class="kw">in</span> filtered_detections]</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">"/content/sam2/sam2/configs/sam2"</span>)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>model_cfg <span class="op">=</span> <span class="st">"sam2_hiera_b+.yaml"</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>sam2_checkpoint <span class="op">=</span> <span class="st">"/content/sam2/checkpoints/sam2_hiera_base_plus.pt"</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>sam2_model <span class="op">=</span> build_sam2(model_cfg, sam2_checkpoint, device<span class="op">=</span><span class="st">"cpu"</span>)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>predictor <span class="op">=</span> SAM2ImagePredictor(sam2_model)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>image <span class="op">=</span> Image.<span class="bu">open</span>(file_path).convert(<span class="st">"RGB"</span>)</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>completable_shapes <span class="op">=</span> {<span class="st">'circle'</span>, <span class="st">'rounded rectangle'</span>, <span class="st">'rectangle'</span>, <span class="st">'Racetrack'</span>}</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>occlusion_flags <span class="op">=</span> []</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(filtered_detections)):</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    is_occluded <span class="op">=</span> <span class="va">False</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>    label_i <span class="op">=</span> filtered_detections[i][<span class="dv">0</span>]</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    box_i <span class="op">=</span> boxes[i]</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label_i <span class="kw">in</span> completable_shapes:</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(filtered_detections)):</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">==</span> j: <span class="cf">continue</span></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>            box_j <span class="op">=</span> boxes[j]</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> check_overlap(box_i, box_j):</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>                is_occluded <span class="op">=</span> <span class="va">True</span></span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>    occlusion_flags.append(is_occluded)</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(<span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span>)</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>angle_transform <span class="op">=</span> transforms.Compose([</span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>    transforms.Resize((<span class="dv">224</span>, <span class="dv">224</span>)),</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>    transforms.ToTensor(),</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a>    transforms.Normalize([<span class="fl">0.485</span>, <span class="fl">0.456</span>, <span class="fl">0.406</span>],[<span class="fl">0.229</span>, <span class="fl">0.224</span>, <span class="fl">0.225</span>])</span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>model_configs <span class="op">=</span> {</span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rectangle'</span>: {<span class="st">"path"</span>: <span class="st">"/content/angle-models-weights/final_rectangle.pth"</span>, <span class="st">"num_classes"</span>: <span class="dv">4</span>},</span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Triangle'</span>: {<span class="st">"path"</span>: <span class="st">"/content/angle-models-weights/Triangle.pth"</span>, <span class="st">"num_classes"</span>: <span class="dv">4</span>},</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Racetrack'</span>: {<span class="st">"path"</span>: <span class="st">"/content/angle-models-weights/final_racetrack.pth"</span>, <span class="st">"num_classes"</span>: <span class="dv">4</span>},</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pentagon'</span>: {<span class="st">"path"</span>: <span class="st">"/content/angle-models-weights/best_resnet18_pentagon.pth"</span>, <span class="st">"num_classes"</span>: <span class="dv">2</span>},</span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">'arrow'</span>: {<span class="st">"path"</span>: <span class="st">"/content/angle-models-weights/best_resnet18_arrow.pth"</span>, <span class="st">"num_classes"</span>: <span class="dv">4</span>},</span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>angle_models <span class="op">=</span> {}</span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> shape_name, config <span class="kw">in</span> model_configs.items():</span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.exists(config[<span class="st">"path"</span>]):</span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> models.resnet18(pretrained<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>        model.fc <span class="op">=</span> nn.Linear(model.fc.in_features, config[<span class="st">"num_classes"</span>])</span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>        model.load_state_dict(torch.load(config[<span class="st">"path"</span>], map_location<span class="op">=</span>device))</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> model.to(device)</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>        model.<span class="bu">eval</span>()</span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>        angle_models[shape_name] <span class="op">=</span> model</span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Loaded angle model for </span><span class="sc">{</span>shape_name<span class="sc">}</span><span class="ss"> from </span><span class="sc">{</span>config[<span class="st">'path'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Warning: Angle model for </span><span class="sc">{</span>shape_name<span class="sc">}</span><span class="ss"> not found at </span><span class="sc">{</span>config[<span class="st">'path'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-71"><a href="#cb44-71" aria-hidden="true" tabindex="-1"></a>triangle_aux_model_path <span class="op">=</span> <span class="st">"/content/angle-models-weights/Triangle_Angle_90_270.pth"</span></span>
<span id="cb44-72"><a href="#cb44-72" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(triangle_aux_model_path):</span>
<span id="cb44-73"><a href="#cb44-73" aria-hidden="true" tabindex="-1"></a>    triangle_aux_model <span class="op">=</span> models.resnet18(pretrained<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb44-74"><a href="#cb44-74" aria-hidden="true" tabindex="-1"></a>    triangle_aux_model.fc <span class="op">=</span> nn.Linear(triangle_aux_model.fc.in_features, <span class="dv">2</span>)</span>
<span id="cb44-75"><a href="#cb44-75" aria-hidden="true" tabindex="-1"></a>    triangle_aux_model.load_state_dict(torch.load(triangle_aux_model_path, map_location<span class="op">=</span>device))</span>
<span id="cb44-76"><a href="#cb44-76" aria-hidden="true" tabindex="-1"></a>    triangle_aux_model <span class="op">=</span> triangle_aux_model.to(device)</span>
<span id="cb44-77"><a href="#cb44-77" aria-hidden="true" tabindex="-1"></a>    triangle_aux_model.<span class="bu">eval</span>()</span>
<span id="cb44-78"><a href="#cb44-78" aria-hidden="true" tabindex="-1"></a>    angle_models[<span class="st">"triangle_aux"</span>] <span class="op">=</span> triangle_aux_model</span>
<span id="cb44-79"><a href="#cb44-79" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_angle(pil_image, model):</span>
<span id="cb44-80"><a href="#cb44-80" aria-hidden="true" tabindex="-1"></a>    img_tensor <span class="op">=</span> angle_transform(pil_image).unsqueeze(<span class="dv">0</span>).to(device)</span>
<span id="cb44-81"><a href="#cb44-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb44-82"><a href="#cb44-82" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model(img_tensor)</span>
<span id="cb44-83"><a href="#cb44-83" aria-hidden="true" tabindex="-1"></a>        _, pred <span class="op">=</span> torch.<span class="bu">max</span>(outputs, <span class="dv">1</span>)</span>
<span id="cb44-84"><a href="#cb44-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pred.item()</span>
<span id="cb44-85"><a href="#cb44-85" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.inference_mode(), torch.autocast(<span class="st">"cuda"</span>, dtype<span class="op">=</span>torch.bfloat16):</span>
<span id="cb44-86"><a href="#cb44-86" aria-hidden="true" tabindex="-1"></a>    predictor.set_image(image)</span>
<span id="cb44-87"><a href="#cb44-87" aria-hidden="true" tabindex="-1"></a>    masks, iou_predictions, _ <span class="op">=</span> predictor.predict(box<span class="op">=</span>boxes)</span>
<span id="cb44-88"><a href="#cb44-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Processed </span><span class="sc">{</span><span class="bu">len</span>(boxes)<span class="sc">}</span><span class="ss"> bounding boxes."</span>)</span>
<span id="cb44-89"><a href="#cb44-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Received </span><span class="sc">{</span><span class="bu">len</span>(masks)<span class="sc">}</span><span class="ss"> sets of mask candidates."</span>)</span>
<span id="cb44-90"><a href="#cb44-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-91"><a href="#cb44-91" aria-hidden="true" tabindex="-1"></a>predicted_angles <span class="op">=</span> []</span>
<span id="cb44-92"><a href="#cb44-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(boxes)):</span>
<span id="cb44-93"><a href="#cb44-93" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> filtered_detections[i][<span class="dv">0</span>]</span>
<span id="cb44-94"><a href="#cb44-94" aria-hidden="true" tabindex="-1"></a>    is_occluded <span class="op">=</span> occlusion_flags[i]</span>
<span id="cb44-95"><a href="#cb44-95" aria-hidden="true" tabindex="-1"></a>    original_bbox <span class="op">=</span> boxes[i]</span>
<span id="cb44-96"><a href="#cb44-96" aria-hidden="true" tabindex="-1"></a>    box_masks <span class="op">=</span> masks[i]</span>
<span id="cb44-97"><a href="#cb44-97" aria-hidden="true" tabindex="-1"></a>    box_scores <span class="op">=</span> iou_predictions[i]</span>
<span id="cb44-98"><a href="#cb44-98" aria-hidden="true" tabindex="-1"></a>    best_mask_index <span class="op">=</span> torch.argmax(torch.from_numpy(box_scores))</span>
<span id="cb44-99"><a href="#cb44-99" aria-hidden="true" tabindex="-1"></a>    best_mask <span class="op">=</span> box_masks[best_mask_index]</span>
<span id="cb44-100"><a href="#cb44-100" aria-hidden="true" tabindex="-1"></a>    mask_binary <span class="op">=</span> (best_mask <span class="op">&gt;</span> <span class="dv">0</span>).astype(np.uint8)</span>
<span id="cb44-101"><a href="#cb44-101" aria-hidden="true" tabindex="-1"></a>    contours, _ <span class="op">=</span> cv2.findContours(mask_binary, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)</span>
<span id="cb44-102"><a href="#cb44-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-103"><a href="#cb44-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> contours:</span>
<span id="cb44-104"><a href="#cb44-104" aria-hidden="true" tabindex="-1"></a>        largest_contour <span class="op">=</span> <span class="bu">max</span>(contours, key<span class="op">=</span>cv2.contourArea)</span>
<span id="cb44-105"><a href="#cb44-105" aria-hidden="true" tabindex="-1"></a>        processed_mask <span class="op">=</span> np.zeros_like(mask_binary)</span>
<span id="cb44-106"><a href="#cb44-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">in</span> completable_shapes <span class="kw">and</span> is_occluded:</span>
<span id="cb44-107"><a href="#cb44-107" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Applying occlusion correction to '</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">' (Box </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">)."</span>)</span>
<span id="cb44-108"><a href="#cb44-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> label <span class="op">==</span> <span class="st">'circle'</span>:</span>
<span id="cb44-109"><a href="#cb44-109" aria-hidden="true" tabindex="-1"></a>                (x, y), radius <span class="op">=</span> cv2.minEnclosingCircle(largest_contour)</span>
<span id="cb44-110"><a href="#cb44-110" aria-hidden="true" tabindex="-1"></a>                cv2.circle(processed_mask, (<span class="bu">int</span>(x), <span class="bu">int</span>(y)), <span class="bu">int</span>(radius), (<span class="dv">1</span>), thickness<span class="op">=</span>cv2.FILLED)</span>
<span id="cb44-111"><a href="#cb44-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> label <span class="op">==</span> <span class="st">'Racetrack'</span>:</span>
<span id="cb44-112"><a href="#cb44-112" aria-hidden="true" tabindex="-1"></a>                rect <span class="op">=</span> cv2.minAreaRect(largest_contour)</span>
<span id="cb44-113"><a href="#cb44-113" aria-hidden="true" tabindex="-1"></a>                center, (width, height), angle <span class="op">=</span> rect</span>
<span id="cb44-114"><a href="#cb44-114" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> width <span class="op">&lt;</span> height:</span>
<span id="cb44-115"><a href="#cb44-115" aria-hidden="true" tabindex="-1"></a>                    width, height <span class="op">=</span> height, width</span>
<span id="cb44-116"><a href="#cb44-116" aria-hidden="true" tabindex="-1"></a>                    angle <span class="op">+=</span> <span class="dv">90</span></span>
<span id="cb44-117"><a href="#cb44-117" aria-hidden="true" tabindex="-1"></a>                radius <span class="op">=</span> height <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb44-118"><a href="#cb44-118" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> width <span class="op">&lt;=</span> height:</span>
<span id="cb44-119"><a href="#cb44-119" aria-hidden="true" tabindex="-1"></a>                    cv2.circle(processed_mask, (<span class="bu">int</span>(center[<span class="dv">0</span>]), <span class="bu">int</span>(center[<span class="dv">1</span>])), <span class="bu">int</span>(radius), (<span class="dv">1</span>), thickness<span class="op">=</span>cv2.FILLED)</span>
<span id="cb44-120"><a href="#cb44-120" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb44-121"><a href="#cb44-121" aria-hidden="true" tabindex="-1"></a>                    rect_center <span class="op">=</span> np.array(center)</span>
<span id="cb44-122"><a href="#cb44-122" aria-hidden="true" tabindex="-1"></a>                    angle_rad <span class="op">=</span> np.deg2rad(angle)</span>
<span id="cb44-123"><a href="#cb44-123" aria-hidden="true" tabindex="-1"></a>                    half_rect_len <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> radius</span>
<span id="cb44-124"><a href="#cb44-124" aria-hidden="true" tabindex="-1"></a>                    dx <span class="op">=</span> np.cos(angle_rad) <span class="op">*</span> half_rect_len</span>
<span id="cb44-125"><a href="#cb44-125" aria-hidden="true" tabindex="-1"></a>                    dy <span class="op">=</span> np.sin(angle_rad) <span class="op">*</span> half_rect_len</span>
<span id="cb44-126"><a href="#cb44-126" aria-hidden="true" tabindex="-1"></a>                    p1 <span class="op">=</span> rect_center <span class="op">+</span> np.array([dx, dy])</span>
<span id="cb44-127"><a href="#cb44-127" aria-hidden="true" tabindex="-1"></a>                    p2 <span class="op">=</span> rect_center <span class="op">-</span> np.array([dx, dy])</span>
<span id="cb44-128"><a href="#cb44-128" aria-hidden="true" tabindex="-1"></a>                    cv2.circle(processed_mask, (<span class="bu">int</span>(p1[<span class="dv">0</span>]), <span class="bu">int</span>(p1[<span class="dv">1</span>])), <span class="bu">int</span>(radius), (<span class="dv">1</span>), thickness<span class="op">=</span>cv2.FILLED)</span>
<span id="cb44-129"><a href="#cb44-129" aria-hidden="true" tabindex="-1"></a>                    cv2.circle(processed_mask, (<span class="bu">int</span>(p2[<span class="dv">0</span>]), <span class="bu">int</span>(p2[<span class="dv">1</span>])), <span class="bu">int</span>(radius), (<span class="dv">1</span>), thickness<span class="op">=</span>cv2.FILLED)</span>
<span id="cb44-130"><a href="#cb44-130" aria-hidden="true" tabindex="-1"></a>                    perp_dx <span class="op">=</span> <span class="op">-</span>np.sin(angle_rad) <span class="op">*</span> radius</span>
<span id="cb44-131"><a href="#cb44-131" aria-hidden="true" tabindex="-1"></a>                    perp_dy <span class="op">=</span> np.cos(angle_rad) <span class="op">*</span> radius</span>
<span id="cb44-132"><a href="#cb44-132" aria-hidden="true" tabindex="-1"></a>                    corner1 <span class="op">=</span> p1 <span class="op">+</span> np.array([perp_dx, perp_dy])</span>
<span id="cb44-133"><a href="#cb44-133" aria-hidden="true" tabindex="-1"></a>                    corner2 <span class="op">=</span> p1 <span class="op">-</span> np.array([perp_dx, perp_dy])</span>
<span id="cb44-134"><a href="#cb44-134" aria-hidden="true" tabindex="-1"></a>                    corner3 <span class="op">=</span> p2 <span class="op">-</span> np.array([perp_dx, perp_dy])</span>
<span id="cb44-135"><a href="#cb44-135" aria-hidden="true" tabindex="-1"></a>                    corner4 <span class="op">=</span> p2 <span class="op">+</span> np.array([perp_dx, perp_dy])</span>
<span id="cb44-136"><a href="#cb44-136" aria-hidden="true" tabindex="-1"></a>                    rect_contour <span class="op">=</span> np.array([corner1, corner2, corner3, corner4], dtype<span class="op">=</span>np.intp)</span>
<span id="cb44-137"><a href="#cb44-137" aria-hidden="true" tabindex="-1"></a>                    cv2.drawContours(processed_mask, [rect_contour], <span class="dv">0</span>, (<span class="dv">1</span>), thickness<span class="op">=</span>cv2.FILLED)</span>
<span id="cb44-138"><a href="#cb44-138" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb44-139"><a href="#cb44-139" aria-hidden="true" tabindex="-1"></a>                hull <span class="op">=</span> cv2.convexHull(largest_contour)</span>
<span id="cb44-140"><a href="#cb44-140" aria-hidden="true" tabindex="-1"></a>                cv2.drawContours(processed_mask, [hull], <span class="op">-</span><span class="dv">1</span>, (<span class="dv">1</span>), thickness<span class="op">=</span>cv2.FILLED)</span>
<span id="cb44-141"><a href="#cb44-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb44-142"><a href="#cb44-142" aria-hidden="true" tabindex="-1"></a>            cv2.drawContours(processed_mask, [largest_contour], <span class="op">-</span><span class="dv">1</span>, (<span class="dv">1</span>), thickness<span class="op">=</span>cv2.FILLED)</span>
<span id="cb44-143"><a href="#cb44-143" aria-hidden="true" tabindex="-1"></a>        mask_binary <span class="op">=</span> processed_mask</span>
<span id="cb44-144"><a href="#cb44-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-145"><a href="#cb44-145" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> np.<span class="bu">any</span>(mask_binary, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb44-146"><a href="#cb44-146" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> np.<span class="bu">any</span>(mask_binary, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb44-147"><a href="#cb44-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> rows.<span class="bu">any</span>() <span class="kw">or</span> <span class="kw">not</span> cols.<span class="bu">any</span>():</span>
<span id="cb44-148"><a href="#cb44-148" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Mask for box </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> is empty after processing, skipping."</span>)</span>
<span id="cb44-149"><a href="#cb44-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb44-150"><a href="#cb44-150" aria-hidden="true" tabindex="-1"></a>    rmin, rmax <span class="op">=</span> np.where(rows)[<span class="dv">0</span>][[<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb44-151"><a href="#cb44-151" aria-hidden="true" tabindex="-1"></a>    cmin, cmax <span class="op">=</span> np.where(cols)[<span class="dv">0</span>][[<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb44-152"><a href="#cb44-152" aria-hidden="true" tabindex="-1"></a>    padding_percentage <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb44-153"><a href="#cb44-153" aria-hidden="true" tabindex="-1"></a>    height_pad <span class="op">=</span> rmax <span class="op">-</span> rmin</span>
<span id="cb44-154"><a href="#cb44-154" aria-hidden="true" tabindex="-1"></a>    width_pad <span class="op">=</span> cmax <span class="op">-</span> cmin</span>
<span id="cb44-155"><a href="#cb44-155" aria-hidden="true" tabindex="-1"></a>    padding_y <span class="op">=</span> <span class="bu">int</span>(height_pad <span class="op">*</span> padding_percentage)</span>
<span id="cb44-156"><a href="#cb44-156" aria-hidden="true" tabindex="-1"></a>    padding_x <span class="op">=</span> <span class="bu">int</span>(width_pad <span class="op">*</span> padding_percentage)</span>
<span id="cb44-157"><a href="#cb44-157" aria-hidden="true" tabindex="-1"></a>    padded_rmin <span class="op">=</span> rmin <span class="op">-</span> padding_y</span>
<span id="cb44-158"><a href="#cb44-158" aria-hidden="true" tabindex="-1"></a>    padded_rmax <span class="op">=</span> rmax <span class="op">+</span> padding_y</span>
<span id="cb44-159"><a href="#cb44-159" aria-hidden="true" tabindex="-1"></a>    padded_cmin <span class="op">=</span> cmin <span class="op">-</span> padding_x</span>
<span id="cb44-160"><a href="#cb44-160" aria-hidden="true" tabindex="-1"></a>    padded_cmax <span class="op">=</span> cmax <span class="op">+</span> padding_x</span>
<span id="cb44-161"><a href="#cb44-161" aria-hidden="true" tabindex="-1"></a>    full_mask_height, full_mask_width <span class="op">=</span> mask_binary.shape</span>
<span id="cb44-162"><a href="#cb44-162" aria-hidden="true" tabindex="-1"></a>    padded_rmin <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, padded_rmin)</span>
<span id="cb44-163"><a href="#cb44-163" aria-hidden="true" tabindex="-1"></a>    padded_rmax <span class="op">=</span> <span class="bu">min</span>(full_mask_height <span class="op">-</span> <span class="dv">1</span>, padded_rmax)</span>
<span id="cb44-164"><a href="#cb44-164" aria-hidden="true" tabindex="-1"></a>    padded_cmin <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, padded_cmin)</span>
<span id="cb44-165"><a href="#cb44-165" aria-hidden="true" tabindex="-1"></a>    padded_cmax <span class="op">=</span> <span class="bu">min</span>(full_mask_width <span class="op">-</span> <span class="dv">1</span>, padded_cmax)</span>
<span id="cb44-166"><a href="#cb44-166" aria-hidden="true" tabindex="-1"></a>    padded_crop <span class="op">=</span> mask_binary[padded_rmin:padded_rmax<span class="op">+</span><span class="dv">1</span>, padded_cmin:padded_cmax<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb44-167"><a href="#cb44-167" aria-hidden="true" tabindex="-1"></a>    final_image_rgb <span class="op">=</span> np.zeros((padded_crop.shape[<span class="dv">0</span>], padded_crop.shape[<span class="dv">1</span>], <span class="dv">3</span>), dtype<span class="op">=</span>np.uint8)</span>
<span id="cb44-168"><a href="#cb44-168" aria-hidden="true" tabindex="-1"></a>    random_color <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">256</span>, size<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb44-169"><a href="#cb44-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb44-170"><a href="#cb44-170" aria-hidden="true" tabindex="-1"></a>        final_image_rgb[:, :, c][padded_crop <span class="op">==</span> <span class="dv">1</span>] <span class="op">=</span> random_color[c]</span>
<span id="cb44-171"><a href="#cb44-171" aria-hidden="true" tabindex="-1"></a>    cropped_pil_image <span class="op">=</span> Image.fromarray(final_image_rgb)</span>
<span id="cb44-172"><a href="#cb44-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-173"><a href="#cb44-173" aria-hidden="true" tabindex="-1"></a>    predicted_angle_info <span class="op">=</span> <span class="st">"N/A"</span></span>
<span id="cb44-174"><a href="#cb44-174" aria-hidden="true" tabindex="-1"></a>    angle_source <span class="op">=</span> <span class="st">"none"</span></span>
<span id="cb44-175"><a href="#cb44-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-176"><a href="#cb44-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-177"><a href="#cb44-177" aria-hidden="true" tabindex="-1"></a>    x1, y1, x2, y2 <span class="op">=</span> original_bbox</span>
<span id="cb44-178"><a href="#cb44-178" aria-hidden="true" tabindex="-1"></a>    shape_bbox <span class="op">=</span> (<span class="bu">int</span>(x1), <span class="bu">int</span>(y1), <span class="bu">int</span>(x2), <span class="bu">int</span>(y2))</span>
<span id="cb44-179"><a href="#cb44-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-180"><a href="#cb44-180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'final_processed_data'</span> <span class="kw">in</span> <span class="bu">dir</span>() <span class="kw">and</span> final_processed_data:</span>
<span id="cb44-181"><a href="#cb44-181" aria-hidden="true" tabindex="-1"></a>        text_rotation <span class="op">=</span> get_text_rotation_for_shape(shape_bbox, final_processed_data)</span>
<span id="cb44-182"><a href="#cb44-182" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> text_rotation <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb44-183"><a href="#cb44-183" aria-hidden="true" tabindex="-1"></a>            normalized_rotation <span class="op">=</span> text_rotation <span class="op">%</span> <span class="dv">360</span></span>
<span id="cb44-184"><a href="#cb44-184" aria-hidden="true" tabindex="-1"></a>            predicted_angle_info <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>normalized_rotation<span class="sc">:.1f}</span><span class="ss"> "</span></span>
<span id="cb44-185"><a href="#cb44-185" aria-hidden="true" tabindex="-1"></a>            angle_source <span class="op">=</span> <span class="st">"ocr_text"</span></span>
<span id="cb44-186"><a href="#cb44-186" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Using OCR text rotation for '</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">' (Box </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>predicted_angle_info<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-187"><a href="#cb44-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-188"><a href="#cb44-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-189"><a href="#cb44-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> angle_source <span class="op">==</span> <span class="st">"none"</span> <span class="kw">and</span> label <span class="kw">in</span> angle_models:</span>
<span id="cb44-190"><a href="#cb44-190" aria-hidden="true" tabindex="-1"></a>        angle_model <span class="op">=</span> angle_models[label]</span>
<span id="cb44-191"><a href="#cb44-191" aria-hidden="true" tabindex="-1"></a>        num_classes <span class="op">=</span> model_configs[label][<span class="st">"num_classes"</span>]</span>
<span id="cb44-192"><a href="#cb44-192" aria-hidden="true" tabindex="-1"></a>        angle_class <span class="op">=</span> predict_angle(cropped_pil_image, angle_model)</span>
<span id="cb44-193"><a href="#cb44-193" aria-hidden="true" tabindex="-1"></a>        angle_source <span class="op">=</span> <span class="st">"resnet_model"</span></span>
<span id="cb44-194"><a href="#cb44-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-195"><a href="#cb44-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="op">==</span> <span class="st">'Pentagon'</span>:</span>
<span id="cb44-196"><a href="#cb44-196" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> angle_class <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb44-197"><a href="#cb44-197" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="st">"0 "</span></span>
<span id="cb44-198"><a href="#cb44-198" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> angle_class <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb44-199"><a href="#cb44-199" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="st">"180 "</span></span>
<span id="cb44-200"><a href="#cb44-200" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb44-201"><a href="#cb44-201" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="ss">f"Pentagon Class </span><span class="sc">{</span>angle_class<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb44-202"><a href="#cb44-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> label <span class="op">==</span> <span class="st">'rectangle'</span>:</span>
<span id="cb44-203"><a href="#cb44-203" aria-hidden="true" tabindex="-1"></a>            x1, y1, x2, y2 <span class="op">=</span> original_bbox</span>
<span id="cb44-204"><a href="#cb44-204" aria-hidden="true" tabindex="-1"></a>            width <span class="op">=</span> x2 <span class="op">-</span> x1</span>
<span id="cb44-205"><a href="#cb44-205" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> y2 <span class="op">-</span> y1</span>
<span id="cb44-206"><a href="#cb44-206" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">abs</span>(width <span class="op">-</span> height) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb44-207"><a href="#cb44-207" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="st">"0 "</span></span>
<span id="cb44-208"><a href="#cb44-208" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> height <span class="op">&gt;=</span> <span class="dv">2</span> <span class="op">*</span> width:</span>
<span id="cb44-209"><a href="#cb44-209" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="st">"90 "</span></span>
<span id="cb44-210"><a href="#cb44-210" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb44-211"><a href="#cb44-211" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="st">"0 "</span></span>
<span id="cb44-212"><a href="#cb44-212" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> label <span class="op">==</span> <span class="st">'Racetrack'</span>:</span>
<span id="cb44-213"><a href="#cb44-213" aria-hidden="true" tabindex="-1"></a>            racetrack_angles <span class="op">=</span> {<span class="dv">0</span>: <span class="st">"45 "</span>, <span class="dv">1</span>: <span class="st">"90 "</span>, <span class="dv">2</span>: <span class="st">"135 "</span>, <span class="dv">3</span>: <span class="st">"0 "</span>}</span>
<span id="cb44-214"><a href="#cb44-214" aria-hidden="true" tabindex="-1"></a>            predicted_angle_info <span class="op">=</span> racetrack_angles.get(angle_class, <span class="ss">f"Racetrack Class </span><span class="sc">{</span>angle_class<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-215"><a href="#cb44-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> label <span class="op">==</span> <span class="st">'Triangle'</span>:</span>
<span id="cb44-216"><a href="#cb44-216" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> angle_class <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb44-217"><a href="#cb44-217" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="st">"0 "</span></span>
<span id="cb44-218"><a href="#cb44-218" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> angle_class <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb44-219"><a href="#cb44-219" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="st">"180 "</span></span>
<span id="cb44-220"><a href="#cb44-220" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb44-221"><a href="#cb44-221" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">"triangle_aux"</span> <span class="kw">in</span> angle_models:</span>
<span id="cb44-222"><a href="#cb44-222" aria-hidden="true" tabindex="-1"></a>                    aux_class <span class="op">=</span> predict_angle(cropped_pil_image, angle_models[<span class="st">"triangle_aux"</span>])</span>
<span id="cb44-223"><a href="#cb44-223" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> aux_class <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb44-224"><a href="#cb44-224" aria-hidden="true" tabindex="-1"></a>                        predicted_angle_info <span class="op">=</span> <span class="st">"90  (rightward tip)"</span></span>
<span id="cb44-225"><a href="#cb44-225" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> aux_class <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb44-226"><a href="#cb44-226" aria-hidden="true" tabindex="-1"></a>                        predicted_angle_info <span class="op">=</span> <span class="st">"270  (leftward tip)"</span></span>
<span id="cb44-227"><a href="#cb44-227" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb44-228"><a href="#cb44-228" aria-hidden="true" tabindex="-1"></a>                        predicted_angle_info <span class="op">=</span> <span class="ss">f"Triangle Auxiliary Class </span><span class="sc">{</span>aux_class<span class="sc">}</span><span class="ss"> (unknown direction)"</span></span>
<span id="cb44-229"><a href="#cb44-229" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb44-230"><a href="#cb44-230" aria-hidden="true" tabindex="-1"></a>                    predicted_angle_info <span class="op">=</span> <span class="st">"Triangle auxiliary weights not found."</span></span>
<span id="cb44-231"><a href="#cb44-231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> label <span class="kw">in</span> [<span class="st">'arrow'</span>]:</span>
<span id="cb44-232"><a href="#cb44-232" aria-hidden="true" tabindex="-1"></a>            arrow_angles <span class="op">=</span> {<span class="dv">0</span>: <span class="st">"0 "</span>, <span class="dv">1</span>: <span class="st">"90 "</span>, <span class="dv">2</span>: <span class="st">"180 "</span>, <span class="dv">3</span>: <span class="st">"270 "</span>}</span>
<span id="cb44-233"><a href="#cb44-233" aria-hidden="true" tabindex="-1"></a>            predicted_angle_info <span class="op">=</span> arrow_angles.get(angle_class, <span class="ss">f"</span><span class="sc">{</span>label<span class="sc">.</span>capitalize()<span class="sc">}</span><span class="ss"> Class </span><span class="sc">{</span>angle_class<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-234"><a href="#cb44-234" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb44-235"><a href="#cb44-235" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> num_classes <span class="op">==</span> <span class="dv">8</span>:</span>
<span id="cb44-236"><a href="#cb44-236" aria-hidden="true" tabindex="-1"></a>                angle_class_to_degrees_8_classes <span class="op">=</span> {</span>
<span id="cb44-237"><a href="#cb44-237" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">0</span>: <span class="st">"0 "</span>, <span class="dv">1</span>: <span class="st">"45 "</span>, <span class="dv">2</span>: <span class="st">"90 "</span>, <span class="dv">3</span>: <span class="st">"135 "</span>,</span>
<span id="cb44-238"><a href="#cb44-238" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">4</span>: <span class="st">"180 "</span>, <span class="dv">5</span>: <span class="st">"225 "</span>, <span class="dv">6</span>: <span class="st">"270 "</span>, <span class="dv">7</span>: <span class="st">"315 "</span></span>
<span id="cb44-239"><a href="#cb44-239" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb44-240"><a href="#cb44-240" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> angle_class_to_degrees_8_classes.get(angle_class, <span class="ss">f"Class </span><span class="sc">{</span>angle_class<span class="sc">}</span><span class="ss"> (Unknown Degree)"</span>)</span>
<span id="cb44-241"><a href="#cb44-241" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> num_classes <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb44-242"><a href="#cb44-242" aria-hidden="true" tabindex="-1"></a>                generic_4_class_angles <span class="op">=</span> {</span>
<span id="cb44-243"><a href="#cb44-243" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">0</span>: <span class="st">"0 "</span>, <span class="dv">1</span>: <span class="st">"90 "</span>, <span class="dv">2</span>: <span class="st">"180 "</span>, <span class="dv">3</span>: <span class="st">"270 "</span></span>
<span id="cb44-244"><a href="#cb44-244" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb44-245"><a href="#cb44-245" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> generic_4_class_angles.get(angle_class, <span class="ss">f"Class </span><span class="sc">{</span>angle_class<span class="sc">}</span><span class="ss"> (Unknown Degree)"</span>)</span>
<span id="cb44-246"><a href="#cb44-246" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> num_classes <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb44-247"><a href="#cb44-247" aria-hidden="true" tabindex="-1"></a>                generic_2_class_angles <span class="op">=</span> {</span>
<span id="cb44-248"><a href="#cb44-248" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">0</span>: <span class="st">"0 "</span>, <span class="dv">1</span>: <span class="st">"180 "</span></span>
<span id="cb44-249"><a href="#cb44-249" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb44-250"><a href="#cb44-250" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> generic_2_class_angles.get(angle_class, <span class="ss">f"Class </span><span class="sc">{</span>angle_class<span class="sc">}</span><span class="ss"> (Unknown Degree)"</span>)</span>
<span id="cb44-251"><a href="#cb44-251" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb44-252"><a href="#cb44-252" aria-hidden="true" tabindex="-1"></a>                predicted_angle_info <span class="op">=</span> <span class="ss">f"Class </span><span class="sc">{</span>angle_class<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb44-253"><a href="#cb44-253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> angle_source <span class="op">==</span> <span class="st">"none"</span>:</span>
<span id="cb44-254"><a href="#cb44-254" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"No angle model available for '</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">' (Box </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">). Skipping angle prediction."</span>)</span>
<span id="cb44-255"><a href="#cb44-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-256"><a href="#cb44-256" aria-hidden="true" tabindex="-1"></a>    predicted_angles.append({</span>
<span id="cb44-257"><a href="#cb44-257" aria-hidden="true" tabindex="-1"></a>        <span class="st">"angle"</span>: predicted_angle_info,</span>
<span id="cb44-258"><a href="#cb44-258" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: angle_source</span>
<span id="cb44-259"><a href="#cb44-259" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb44-260"><a href="#cb44-260" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Predicted Angle for '</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">' (Box </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>predicted_angle_info<span class="sc">}</span><span class="ss"> (source: </span><span class="sc">{</span>angle_source<span class="sc">}</span><span class="ss">)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=None`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loaded angle model for rectangle from /content/angle-models-weights/final_rectangle.pth
Loaded angle model for Triangle from /content/angle-models-weights/Triangle.pth
Loaded angle model for Racetrack from /content/angle-models-weights/final_racetrack.pth
Loaded angle model for Pentagon from /content/angle-models-weights/best_resnet18_pentagon.pth
Loaded angle model for arrow from /content/angle-models-weights/best_resnet18_arrow.pth
Processed 6 bounding boxes.
Received 6 sets of mask candidates.
Applying occlusion correction to 'Racetrack' (Box 0).
Using OCR text rotation for 'Racetrack' (Box 0): 249.2 
Predicted Angle for 'Racetrack' (Box 0): 249.2  (source: ocr_text)
Using OCR text rotation for 'Pentagon' (Box 1): 0.0 
Predicted Angle for 'Pentagon' (Box 1): 0.0  (source: ocr_text)
Applying occlusion correction to 'Racetrack' (Box 2).
Using OCR text rotation for 'Racetrack' (Box 2): 319.0 
Predicted Angle for 'Racetrack' (Box 2): 319.0  (source: ocr_text)
Applying occlusion correction to 'Racetrack' (Box 3).
Using OCR text rotation for 'Racetrack' (Box 3): 0.0 
Predicted Angle for 'Racetrack' (Box 3): 0.0  (source: ocr_text)
Applying occlusion correction to 'Racetrack' (Box 4).
Using OCR text rotation for 'Racetrack' (Box 4): 357.4 
Predicted Angle for 'Racetrack' (Box 4): 357.4  (source: ocr_text)
Applying occlusion correction to 'Racetrack' (Box 5).
Using OCR text rotation for 'Racetrack' (Box 5): 1.9 
Predicted Angle for 'Racetrack' (Box 5): 1.9  (source: ocr_text)</code></pre>
</div>
</div>
</section>
<section id="dominant-color-prediction" class="level1">
<h1><strong>Dominant Color Prediction</strong></h1>
<div id="cell-44" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="4a8216a5-0227-4ff2-bd50-515cf81e8124" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_corner_background_color(image):</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    h, w <span class="op">=</span> image.shape[:<span class="dv">2</span>]</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, w <span class="op">//</span> <span class="dv">2</span>, h <span class="op">//</span> <span class="dv">2</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    tl <span class="op">=</span> image[<span class="dv">0</span>:s, <span class="dv">0</span>:s].reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    tr <span class="op">=</span> image[<span class="dv">0</span>:s, w<span class="op">-</span>s:w].reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    bl <span class="op">=</span> image[h<span class="op">-</span>s:h, <span class="dv">0</span>:s].reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    br <span class="op">=</span> image[h<span class="op">-</span>s:h, w<span class="op">-</span>s:w].reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    corners <span class="op">=</span> np.vstack([tl, tr, bl, br])</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    mean_bgr <span class="op">=</span> np.mean(corners, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean_bgr</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_smart_dominant_color(image, bg_color_bgr, k<span class="op">=</span><span class="dv">4</span>):</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        lab_image <span class="op">=</span> cv2.cvtColor(image, cv2.COLOR_BGR2LAB)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        pixels <span class="op">=</span> lab_image.reshape((<span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>)).astype(np.float32)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pixels.shape[<span class="dv">0</span>] <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        K <span class="op">=</span> <span class="bu">min</span>(k, <span class="bu">max</span>(<span class="dv">1</span>, pixels.shape[<span class="dv">0</span>] <span class="op">//</span> <span class="dv">200</span>))</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        criteria <span class="op">=</span> (cv2.TERM_CRITERIA_EPS <span class="op">+</span> cv2.TERM_CRITERIA_MAX_ITER, <span class="dv">100</span>, <span class="fl">0.2</span>)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        _, labels, centers <span class="op">=</span> cv2.kmeans(</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>            pixels, K, <span class="va">None</span>, criteria, <span class="dv">10</span>, cv2.KMEANS_PP_CENTERS</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>        counts <span class="op">=</span> np.bincount(labels.flatten())</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>        bg_color_uint8 <span class="op">=</span> np.array([[bg_color_bgr]], dtype<span class="op">=</span>np.uint8)</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>        bg_lab <span class="op">=</span> cv2.cvtColor(bg_color_uint8, cv2.COLOR_BGR2LAB)[<span class="dv">0</span>][<span class="dv">0</span>].astype(np.float32)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>        sorted_indices <span class="op">=</span> np.argsort(counts)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>        final_color_bgr <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> sorted_indices:</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>            center_lab <span class="op">=</span> centers[idx]</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>            dist <span class="op">=</span> np.linalg.norm(center_lab <span class="op">-</span> bg_lab)</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dist <span class="op">&gt;</span> <span class="dv">15</span>:</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>                color_lab <span class="op">=</span> center_lab.astype(<span class="st">"uint8"</span>).reshape(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>                final_color_bgr <span class="op">=</span> cv2.cvtColor(color_lab, cv2.COLOR_LAB2BGR).reshape(<span class="dv">3</span>)</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> final_color_bgr <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>            color_lab <span class="op">=</span> centers[sorted_indices[<span class="dv">0</span>]].astype(<span class="st">"uint8"</span>).reshape(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>            final_color_bgr <span class="op">=</span> cv2.cvtColor(color_lab, cv2.COLOR_LAB2BGR).reshape(<span class="dv">3</span>)</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">tuple</span>(<span class="bu">int</span>(c) <span class="cf">for</span> c <span class="kw">in</span> final_color_bgr[::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rgb_to_hex(rgb_tuple):</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rgb_tuple <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>    r, g, b <span class="op">=</span> rgb_tuple</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"#</span><span class="sc">{:02x}{:02x}{:02x}</span><span class="st">"</span>.<span class="bu">format</span>(</span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">min</span>(<span class="dv">255</span>, <span class="bu">int</span>(r))),</span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">min</span>(<span class="dv">255</span>, <span class="bu">int</span>(g))),</span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">min</span>(<span class="dv">255</span>, <span class="bu">int</span>(b)))</span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> iou(boxA, boxB):</span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>    ax1,ay1,ax2,ay2 <span class="op">=</span> boxA</span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>    bx1,by1,bx2,by2 <span class="op">=</span> boxB</span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>    inter_x1 <span class="op">=</span> <span class="bu">max</span>(ax1,bx1)<span class="op">;</span> inter_y1 <span class="op">=</span> <span class="bu">max</span>(ay1,by1)</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>    inter_x2 <span class="op">=</span> <span class="bu">min</span>(ax2,bx2)<span class="op">;</span> inter_y2 <span class="op">=</span> <span class="bu">min</span>(ay2,by2)</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a>    inter_w <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, inter_x2 <span class="op">-</span> inter_x1)<span class="op">;</span> inter_h <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, inter_y2 <span class="op">-</span> inter_y1)</span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a>    inter_area <span class="op">=</span> inter_w <span class="op">*</span> inter_h</span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>    areaA <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, ax2<span class="op">-</span>ax1) <span class="op">*</span> <span class="bu">max</span>(<span class="dv">0</span>, ay2<span class="op">-</span>ay1)</span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>    areaB <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, bx2<span class="op">-</span>bx1) <span class="op">*</span> <span class="bu">max</span>(<span class="dv">0</span>, by2<span class="op">-</span>by1)</span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>    denom <span class="op">=</span> areaA <span class="op">+</span> areaB <span class="op">-</span> inter_area</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inter_area<span class="op">/</span>denom <span class="cf">if</span> denom <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> greedy_iou_match(detections, angle_source, predicted_angles, iou_threshold<span class="op">=</span><span class="fl">0.4</span>):</span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> angle_source <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> predicted_angles <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(angle_source), <span class="bu">len</span>(predicted_angles))</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> S <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>    D <span class="op">=</span> <span class="bu">len</span>(detections)</span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>    det_labels, det_boxes <span class="op">=</span> [], []</span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> detections:</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a>        det_labels.append(d[<span class="dv">0</span>])</span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>        p1,p2 <span class="op">=</span> d[<span class="dv">1</span>], d[<span class="dv">2</span>]</span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>        det_boxes.append((<span class="bu">int</span>(<span class="bu">round</span>(p1[<span class="dv">0</span>])), <span class="bu">int</span>(<span class="bu">round</span>(p1[<span class="dv">1</span>])), <span class="bu">int</span>(<span class="bu">round</span>(p2[<span class="dv">0</span>])), <span class="bu">int</span>(<span class="bu">round</span>(p2[<span class="dv">1</span>]))))</span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>    src_labels, src_boxes <span class="op">=</span> [], []</span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(S):</span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> angle_source[j]</span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>        src_labels.append(s[<span class="dv">0</span>])</span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>        sp1, sp2 <span class="op">=</span> s[<span class="dv">1</span>], s[<span class="dv">2</span>]</span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>        src_boxes.append((<span class="bu">int</span>(<span class="bu">round</span>(sp1[<span class="dv">0</span>])), <span class="bu">int</span>(<span class="bu">round</span>(sp1[<span class="dv">1</span>])), <span class="bu">int</span>(<span class="bu">round</span>(sp2[<span class="dv">0</span>])), <span class="bu">int</span>(<span class="bu">round</span>(sp2[<span class="dv">1</span>]))))</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a>    iou_mat <span class="op">=</span> np.zeros((D, S), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(D):</span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(S):</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> det_labels[i] <span class="op">!=</span> src_labels[j]:</span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a>            iou_mat[i, j] <span class="op">=</span> iou(det_boxes[i], src_boxes[j])</span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> {}</span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>    used_det <span class="op">=</span> <span class="bu">set</span>()<span class="op">;</span> used_src <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> iou_mat.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> np.unravel_index(np.argmax(iou_mat), iou_mat.shape)</span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>        max_iou <span class="op">=</span> iou_mat[idx]</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> max_iou <span class="op">&lt;</span> iou_threshold:</span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a>        di, sj <span class="op">=</span> <span class="bu">int</span>(idx[<span class="dv">0</span>]), <span class="bu">int</span>(idx[<span class="dv">1</span>])</span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> di <span class="kw">in</span> used_det <span class="kw">or</span> sj <span class="kw">in</span> used_src:</span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a>            iou_mat[di, sj] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a>        matches[di] <span class="op">=</span> predicted_angles[sj]</span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>        used_det.add(di)<span class="op">;</span> used_src.add(sj)</span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>        iou_mat[di, :] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a>        iou_mat[:, sj] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-129"><a href="#cb47-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matches</span>
<span id="cb47-130"><a href="#cb47-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-131"><a href="#cb47-131" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_image_and_detections_simple(image_path, detections, predicted_angles<span class="op">=</span><span class="va">None</span>, angle_source<span class="op">=</span><span class="va">None</span>, iou_threshold<span class="op">=</span><span class="fl">0.4</span>):</span>
<span id="cb47-132"><a href="#cb47-132" aria-hidden="true" tabindex="-1"></a>    img <span class="op">=</span> cv2.imread(image_path)</span>
<span id="cb47-133"><a href="#cb47-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> img <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb47-134"><a href="#cb47-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">FileNotFoundError</span>(<span class="ss">f"Image not found at path: </span><span class="sc">{</span>image_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb47-135"><a href="#cb47-135" aria-hidden="true" tabindex="-1"></a>    H, W <span class="op">=</span> img.shape[:<span class="dv">2</span>]</span>
<span id="cb47-136"><a href="#cb47-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-137"><a href="#cb47-137" aria-hidden="true" tabindex="-1"></a>    thin_line_labels <span class="op">=</span> {<span class="st">"dashed-arrow"</span>, <span class="st">"doted-arrow"</span>, <span class="st">"connector"</span>}</span>
<span id="cb47-138"><a href="#cb47-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-139"><a href="#cb47-139" aria-hidden="true" tabindex="-1"></a>    allowed_angle_labels <span class="op">=</span> {<span class="st">"arrow"</span>, <span class="st">"rectangle"</span>, <span class="st">"Racetrack"</span>, <span class="st">"Pentagon"</span>, <span class="st">"Triangle"</span>}</span>
<span id="cb47-140"><a href="#cb47-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-141"><a href="#cb47-141" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> greedy_iou_match(detections, angle_source, predicted_angles, iou_threshold<span class="op">=</span>iou_threshold)</span>
<span id="cb47-142"><a href="#cb47-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-143"><a href="#cb47-143" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> []</span>
<span id="cb47-144"><a href="#cb47-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, det <span class="kw">in</span> <span class="bu">enumerate</span>(detections):</span>
<span id="cb47-145"><a href="#cb47-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;=</span> <span class="dv">4</span>:</span>
<span id="cb47-146"><a href="#cb47-146" aria-hidden="true" tabindex="-1"></a>            label, p1, p2, existing_color <span class="op">=</span> det[<span class="dv">0</span>], det[<span class="dv">1</span>], det[<span class="dv">2</span>], det[<span class="dv">3</span>]</span>
<span id="cb47-147"><a href="#cb47-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb47-148"><a href="#cb47-148" aria-hidden="true" tabindex="-1"></a>            label, p1, p2 <span class="op">=</span> det[<span class="dv">0</span>], det[<span class="dv">1</span>], det[<span class="dv">2</span>]</span>
<span id="cb47-149"><a href="#cb47-149" aria-hidden="true" tabindex="-1"></a>            existing_color <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-150"><a href="#cb47-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-151"><a href="#cb47-151" aria-hidden="true" tabindex="-1"></a>        x1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(<span class="bu">round</span>(<span class="bu">float</span>(p1[<span class="dv">0</span>]))))<span class="op">;</span> y1 <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="bu">int</span>(<span class="bu">round</span>(<span class="bu">float</span>(p1[<span class="dv">1</span>]))))</span>
<span id="cb47-152"><a href="#cb47-152" aria-hidden="true" tabindex="-1"></a>        x2 <span class="op">=</span> <span class="bu">min</span>(W, <span class="bu">int</span>(<span class="bu">round</span>(<span class="bu">float</span>(p2[<span class="dv">0</span>]))))<span class="op">;</span> y2 <span class="op">=</span> <span class="bu">min</span>(H, <span class="bu">int</span>(<span class="bu">round</span>(<span class="bu">float</span>(p2[<span class="dv">1</span>]))))</span>
<span id="cb47-153"><a href="#cb47-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-154"><a href="#cb47-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x2 <span class="op">&lt;=</span> x1 <span class="kw">or</span> y2 <span class="op">&lt;=</span> y1:</span>
<span id="cb47-155"><a href="#cb47-155" aria-hidden="true" tabindex="-1"></a>            dom_hex <span class="op">=</span> existing_color</span>
<span id="cb47-156"><a href="#cb47-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb47-157"><a href="#cb47-157" aria-hidden="true" tabindex="-1"></a>            full_crop <span class="op">=</span> img[y1:y2, x1:x2]</span>
<span id="cb47-158"><a href="#cb47-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-159"><a href="#cb47-159" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> full_crop <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> full_crop.size <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb47-160"><a href="#cb47-160" aria-hidden="true" tabindex="-1"></a>                dom_hex <span class="op">=</span> existing_color</span>
<span id="cb47-161"><a href="#cb47-161" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb47-162"><a href="#cb47-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-163"><a href="#cb47-163" aria-hidden="true" tabindex="-1"></a>                bg_color_bgr <span class="op">=</span> get_corner_background_color(full_crop)</span>
<span id="cb47-164"><a href="#cb47-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-165"><a href="#cb47-165" aria-hidden="true" tabindex="-1"></a>                h_c, w_c <span class="op">=</span> full_crop.shape[:<span class="dv">2</span>]</span>
<span id="cb47-166"><a href="#cb47-166" aria-hidden="true" tabindex="-1"></a>                margin_h <span class="op">=</span> <span class="bu">int</span>(h_c <span class="op">*</span> <span class="fl">0.20</span>)</span>
<span id="cb47-167"><a href="#cb47-167" aria-hidden="true" tabindex="-1"></a>                margin_w <span class="op">=</span> <span class="bu">int</span>(w_c <span class="op">*</span> <span class="fl">0.20</span>)</span>
<span id="cb47-168"><a href="#cb47-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-169"><a href="#cb47-169" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> margin_h <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> margin_w <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb47-170"><a href="#cb47-170" aria-hidden="true" tabindex="-1"></a>                    center_crop <span class="op">=</span> full_crop[margin_h:h_c<span class="op">-</span>margin_h, margin_w:w_c<span class="op">-</span>margin_w]</span>
<span id="cb47-171"><a href="#cb47-171" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb47-172"><a href="#cb47-172" aria-hidden="true" tabindex="-1"></a>                    center_crop <span class="op">=</span> full_crop</span>
<span id="cb47-173"><a href="#cb47-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-174"><a href="#cb47-174" aria-hidden="true" tabindex="-1"></a>                dom_rgb <span class="op">=</span> find_smart_dominant_color(center_crop, bg_color_bgr)</span>
<span id="cb47-175"><a href="#cb47-175" aria-hidden="true" tabindex="-1"></a>                dom_hex <span class="op">=</span> existing_color <span class="cf">if</span> existing_color <span class="cf">else</span> rgb_to_hex(dom_rgb)</span>
<span id="cb47-176"><a href="#cb47-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-177"><a href="#cb47-177" aria-hidden="true" tabindex="-1"></a>        angle_val <span class="op">=</span> <span class="va">None</span></span>
<span id="cb47-178"><a href="#cb47-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">in</span> allowed_angle_labels:</span>
<span id="cb47-179"><a href="#cb47-179" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="kw">in</span> matches:</span>
<span id="cb47-180"><a href="#cb47-180" aria-hidden="true" tabindex="-1"></a>                angle_val <span class="op">=</span> matches[i]</span>
<span id="cb47-181"><a href="#cb47-181" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> predicted_angles <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> i <span class="op">&lt;</span> <span class="bu">len</span>(predicted_angles):</span>
<span id="cb47-182"><a href="#cb47-182" aria-hidden="true" tabindex="-1"></a>                angle_val <span class="op">=</span> predicted_angles[i]</span>
<span id="cb47-183"><a href="#cb47-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-184"><a href="#cb47-184" aria-hidden="true" tabindex="-1"></a>        out.append((label, (x1, y1), (x2, y2), dom_hex, angle_val))</span>
<span id="cb47-185"><a href="#cb47-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-186"><a href="#cb47-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span>
<span id="cb47-187"><a href="#cb47-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-188"><a href="#cb47-188" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb47-189"><a href="#cb47-189" aria-hidden="true" tabindex="-1"></a>    detections_input <span class="op">=</span> detections</span>
<span id="cb47-190"><a href="#cb47-190" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span>:</span>
<span id="cb47-191"><a href="#cb47-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb47-192"><a href="#cb47-192" aria-hidden="true" tabindex="-1"></a>        detections_input <span class="op">=</span> detections_list</span>
<span id="cb47-193"><a href="#cb47-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">NameError</span>:</span>
<span id="cb47-194"><a href="#cb47-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"Set 'detections' or 'detections_list' before running this cell."</span>)</span>
<span id="cb47-195"><a href="#cb47-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-196"><a href="#cb47-196" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> <span class="bu">globals</span>().get(<span class="st">'predicted_angles'</span>, <span class="va">None</span>)</span>
<span id="cb47-197"><a href="#cb47-197" aria-hidden="true" tabindex="-1"></a>src <span class="op">=</span> <span class="bu">globals</span>().get(<span class="st">'filtered_detections'</span>, <span class="va">None</span>)</span>
<span id="cb47-198"><a href="#cb47-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-199"><a href="#cb47-199" aria-hidden="true" tabindex="-1"></a>final_detections <span class="op">=</span> process_image_and_detections_simple(file_path, detections_input, predicted_angles<span class="op">=</span>preds, angle_source<span class="op">=</span>src, iou_threshold<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb47-200"><a href="#cb47-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-201"><a href="#cb47-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-202"><a href="#cb47-202" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"detections = ["</span>)</span>
<span id="cb47-203"><a href="#cb47-203" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> det <span class="kw">in</span> final_detections:</span>
<span id="cb47-204"><a href="#cb47-204" aria-hidden="true" tabindex="-1"></a>    label, (x1, y1), (x2, y2), color_hex, angle_info <span class="op">=</span> det</span>
<span id="cb47-205"><a href="#cb47-205" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    ('</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">', (</span><span class="sc">{</span>x1<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>y1<span class="sc">}</span><span class="ss">), (</span><span class="sc">{</span>x2<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>y2<span class="sc">}</span><span class="ss">), </span><span class="sc">{</span><span class="bu">repr</span>(color_hex)<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">repr</span>(angle_info)<span class="sc">}</span><span class="ss">),"</span>)</span>
<span id="cb47-206"><a href="#cb47-206" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"]"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>detections = [
    ('Racetrack', (525, 337), (773, 732), '#5f803e', {'angle': '249.2 ', 'source': 'ocr_text'}),
    ('circle', (75, 354), (211, 486), '#ba6c26', None),
    ('Pentagon', (198, 193), (629, 608), '#263619', {'angle': '0.0 ', 'source': 'ocr_text'}),
    ('Racetrack', (399, 37), (734, 357), '#faf9e7', {'angle': '319.0 ', 'source': 'ocr_text'}),
    ('circle', (191, 625), (328, 758), '#ba6c26', None),
    ('circle', (540, 567), (676, 700), '#ba6c26', None),
    ('Racetrack', (91, 35), (442, 352), '#6d7a4b', {'angle': '0.0 ', 'source': 'ocr_text'}),
    ('circle', (580, 198), (715, 331), '#ba6c26', None),
    ('circle', (290, 64), (423, 196), '#ba6c26', None),
    ('Racetrack', (182, 610), (573, 773), '#dcaa73', {'angle': '357.4 ', 'source': 'ocr_text'}),
    ('Racetrack', (58, 338), (307, 737), '#c8945a', {'angle': '1.9 ', 'source': 'ocr_text'}),
]</code></pre>
</div>
</div>
</section>
<section id="final-json-output" class="level1">
<h1><strong>Final JSON Output</strong></h1>
<div id="cell-46" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="1a91e4aa-f44b-48dd-b614-4ba929be8d9c" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_nodes_json(shape_detections):</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    diagram_nodes <span class="op">=</span> []</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, det <span class="kw">in</span> <span class="bu">enumerate</span>(shape_detections):</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> det[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        top_left <span class="op">=</span> det[<span class="dv">1</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> (<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        bottom_right <span class="op">=</span> det[<span class="dv">2</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">2</span> <span class="cf">else</span> (<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> det[<span class="dv">3</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">3</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        angle <span class="op">=</span> det[<span class="dv">4</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">4</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> angle <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>            angle_val <span class="op">=</span> <span class="st">""</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">isinstance</span>(angle, <span class="bu">dict</span>):</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>            raw <span class="op">=</span> angle.get(<span class="st">"angle"</span>, <span class="st">""</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(raw, <span class="bu">str</span>):</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>                angle_val <span class="op">=</span> raw.strip()</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>                angle_val <span class="op">=</span> <span class="bu">str</span>(raw) <span class="cf">if</span> raw <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">isinstance</span>(angle, <span class="bu">str</span>):</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>            angle_val <span class="op">=</span> angle.strip()</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> angle_val.lower() <span class="op">==</span> <span class="st">"none"</span>:</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>                angle_val <span class="op">=</span> <span class="st">""</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># It's a number</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>            angle_val <span class="op">=</span> <span class="bu">str</span>(angle)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>        x1, y1 <span class="op">=</span> top_left</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>        x2, y2 <span class="op">=</span> bottom_right</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>        center_x <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((x1 <span class="op">+</span> x2) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>        center_y <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((y1 <span class="op">+</span> y2) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>(x2 <span class="op">-</span> x1))</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>(y2 <span class="op">-</span> y1))</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>        node <span class="op">=</span> {</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">"id"</span>: <span class="ss">f"node</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">"x"</span>: center_x,</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">"y"</span>: center_y,</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">"text"</span>: <span class="st">""</span>,</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">"shape"</span>: label,</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">"color"</span>: color,</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">"width"</span>: width,</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">"height"</span>: height,</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">"angle"</span>: angle_val</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>        diagram_nodes.append(node)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> diagram_nodes</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _det_to_center(det):</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> det <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> det[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>    tl <span class="op">=</span> det[<span class="dv">1</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> (<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>    br <span class="op">=</span> det[<span class="dv">2</span>] <span class="cf">if</span> <span class="bu">len</span>(det) <span class="op">&gt;</span> <span class="dv">2</span> <span class="cf">else</span> (<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>    cx <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((tl[<span class="dv">0</span>] <span class="op">+</span> br[<span class="dv">0</span>]) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>    cy <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>((tl[<span class="dv">1</span>] <span class="op">+</span> br[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">2</span>))</span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (label, cx, cy)</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _find_node_by_det(diagram_nodes, det, tol<span class="op">=</span><span class="dv">8</span>):</span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> det <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a>    label, cx, cy <span class="op">=</span> _det_to_center(det)</span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> diagram_nodes:</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node[<span class="st">'shape'</span>] <span class="op">==</span> label:</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">abs</span>(node[<span class="st">'x'</span>] <span class="op">-</span> cx) <span class="op">&lt;=</span> tol <span class="kw">and</span> <span class="bu">abs</span>(node[<span class="st">'y'</span>] <span class="op">-</span> cy) <span class="op">&lt;=</span> tol:</span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> node[<span class="st">'id'</span>]</span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a>    best <span class="op">=</span> (<span class="va">None</span>, <span class="fl">1e9</span>)</span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> diagram_nodes:</span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node[<span class="st">'shape'</span>] <span class="op">==</span> label:</span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a>            dist <span class="op">=</span> (node[<span class="st">'x'</span>]<span class="op">-</span>cx)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> (node[<span class="st">'y'</span>]<span class="op">-</span>cy)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> dist <span class="op">&lt;</span> best[<span class="dv">1</span>]:</span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a>                best <span class="op">=</span> (node[<span class="st">'id'</span>], dist)</span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best[<span class="dv">0</span>]</span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_edges_json(arrow_connections, diagram_nodes, all_detections, arrowhead_radius<span class="op">=</span><span class="dv">50</span>):</span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a>    diagram_edges <span class="op">=</span> []</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a>    arrow_head_centers <span class="op">=</span> []</span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> [dd <span class="cf">for</span> dd <span class="kw">in</span> all_detections <span class="cf">if</span> dd[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"arrow_head"</span>]:</span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a>        tl <span class="op">=</span> d[<span class="dv">1</span>] <span class="cf">if</span> <span class="bu">len</span>(d) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> (<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a>        br <span class="op">=</span> d[<span class="dv">2</span>] <span class="cf">if</span> <span class="bu">len</span>(d) <span class="op">&gt;</span> <span class="dv">2</span> <span class="cf">else</span> (<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a>        arrow_head_centers.append(((tl[<span class="dv">0</span>]<span class="op">+</span>br[<span class="dv">0</span>])<span class="op">/</span><span class="fl">2.0</span>, (tl[<span class="dv">1</span>]<span class="op">+</span>br[<span class="dv">1</span>])<span class="op">/</span><span class="fl">2.0</span>))</span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, conn <span class="kw">in</span> <span class="bu">enumerate</span>(arrow_connections):</span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a>        tail_det <span class="op">=</span> conn.get(<span class="st">"tail_connected_to"</span>)</span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a>        head_det <span class="op">=</span> conn.get(<span class="st">"head_connected_to"</span>)</span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a>        src_id <span class="op">=</span> _find_node_by_det(diagram_nodes, tail_det)</span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a>        tgt_id <span class="op">=</span> _find_node_by_det(diagram_nodes, head_det)</span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> src_id <span class="kw">or</span> <span class="kw">not</span> tgt_id:</span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a>        head_pt <span class="op">=</span> <span class="bu">tuple</span>(conn.get(<span class="st">'head'</span>)) <span class="cf">if</span> conn.get(<span class="st">'head'</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a>        tail_pt <span class="op">=</span> <span class="bu">tuple</span>(conn.get(<span class="st">'tail'</span>)) <span class="cf">if</span> conn.get(<span class="st">'tail'</span>) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> _has_arrow_at(pt):</span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pt <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> ah <span class="kw">in</span> arrow_head_centers:</span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> np.linalg.norm(np.array(pt) <span class="op">-</span> np.array(ah)) <span class="op">&lt;</span> arrowhead_radius:</span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a>        has_at_tail <span class="op">=</span> _has_arrow_at(tail_pt)</span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a>        has_at_head <span class="op">=</span> _has_arrow_at(head_pt)</span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a>        startArrow <span class="op">=</span> <span class="va">False</span></span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true" tabindex="-1"></a>        endArrow <span class="op">=</span> <span class="va">False</span></span>
<span id="cb49-110"><a href="#cb49-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-111"><a href="#cb49-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> has_at_tail <span class="kw">and</span> has_at_head:</span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true" tabindex="-1"></a>            startArrow <span class="op">=</span> <span class="va">True</span><span class="op">;</span> endArrow <span class="op">=</span> <span class="va">True</span></span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> has_at_tail <span class="kw">and</span> <span class="kw">not</span> has_at_head:</span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true" tabindex="-1"></a>            src_id, tgt_id <span class="op">=</span> tgt_id, src_id<span class="op">;</span> startArrow <span class="op">=</span> <span class="va">False</span><span class="op">;</span> endArrow <span class="op">=</span> <span class="va">True</span></span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> has_at_head <span class="kw">and</span> <span class="kw">not</span> has_at_tail:</span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true" tabindex="-1"></a>            startArrow <span class="op">=</span> <span class="va">False</span><span class="op">;</span> endArrow <span class="op">=</span> <span class="va">True</span></span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> head_pt <span class="kw">and</span> tail_pt:</span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true" tabindex="-1"></a>                x_diff <span class="op">=</span> head_pt[<span class="dv">0</span>] <span class="op">-</span> tail_pt[<span class="dv">0</span>]</span>
<span id="cb49-120"><a href="#cb49-120" aria-hidden="true" tabindex="-1"></a>                y_diff <span class="op">=</span> head_pt[<span class="dv">1</span>] <span class="op">-</span> tail_pt[<span class="dv">1</span>]</span>
<span id="cb49-121"><a href="#cb49-121" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">abs</span>(x_diff) <span class="op">&gt;</span> <span class="bu">abs</span>(y_diff):</span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> x_diff <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true" tabindex="-1"></a>                        src_id, tgt_id <span class="op">=</span> tgt_id, src_id</span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> y_diff <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true" tabindex="-1"></a>                        src_id, tgt_id <span class="op">=</span> tgt_id, src_id</span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true" tabindex="-1"></a>        raw_label <span class="op">=</span> conn.get(<span class="st">"original_label"</span>) <span class="kw">or</span> conn.get(<span class="st">"label"</span>) <span class="kw">or</span> <span class="st">""</span></span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true" tabindex="-1"></a>        line_style <span class="op">=</span> raw_label.split(<span class="st">'-'</span>)[<span class="dv">0</span>] <span class="cf">if</span> raw_label <span class="cf">else</span> <span class="st">"solid"</span></span>
<span id="cb49-130"><a href="#cb49-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-131"><a href="#cb49-131" aria-hidden="true" tabindex="-1"></a>        edge <span class="op">=</span> {</span>
<span id="cb49-132"><a href="#cb49-132" aria-hidden="true" tabindex="-1"></a>            <span class="st">"id"</span>: <span class="ss">f"edge</span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb49-133"><a href="#cb49-133" aria-hidden="true" tabindex="-1"></a>            <span class="st">"source"</span>: src_id,</span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true" tabindex="-1"></a>            <span class="st">"target"</span>: tgt_id,</span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true" tabindex="-1"></a>            <span class="st">"lineStyle"</span>: line_style,</span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true" tabindex="-1"></a>            <span class="st">"startArrow"</span>: <span class="bu">bool</span>(startArrow),</span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true" tabindex="-1"></a>            <span class="st">"endArrow"</span>: <span class="bu">bool</span>(endArrow),</span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true" tabindex="-1"></a>            <span class="st">"color"</span>: <span class="st">"#333333"</span></span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true" tabindex="-1"></a>        diagram_edges.append(edge)</span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> diagram_edges</span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_ocr_to_nodes(diagram_nodes, processed_ocr_data, relaxation_pixels<span class="op">=</span><span class="dv">15</span>, max_area_ratio<span class="op">=</span><span class="dv">80</span>):</span>
<span id="cb49-145"><a href="#cb49-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-146"><a href="#cb49-146" aria-hidden="true" tabindex="-1"></a>    nodes <span class="op">=</span> [n.copy() <span class="cf">for</span> n <span class="kw">in</span> diagram_nodes]</span>
<span id="cb49-147"><a href="#cb49-147" aria-hidden="true" tabindex="-1"></a>    ocr_boxes <span class="op">=</span> []</span>
<span id="cb49-148"><a href="#cb49-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> processed_ocr_data:</span>
<span id="cb49-149"><a href="#cb49-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> nodes, []</span>
<span id="cb49-150"><a href="#cb49-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-151"><a href="#cb49-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ocr <span class="kw">in</span> processed_ocr_data:</span>
<span id="cb49-152"><a href="#cb49-152" aria-hidden="true" tabindex="-1"></a>        bbox <span class="op">=</span> ocr.get(<span class="st">'bbox'</span>)</span>
<span id="cb49-153"><a href="#cb49-153" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> ocr.get(<span class="st">'text'</span>, <span class="st">""</span>)</span>
<span id="cb49-154"><a href="#cb49-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> bbox <span class="kw">or</span> <span class="kw">not</span> text.strip():</span>
<span id="cb49-155"><a href="#cb49-155" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb49-156"><a href="#cb49-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-157"><a href="#cb49-157" aria-hidden="true" tabindex="-1"></a>        ocr_x1, ocr_y1, ocr_x2, ocr_y2 <span class="op">=</span> bbox</span>
<span id="cb49-158"><a href="#cb49-158" aria-hidden="true" tabindex="-1"></a>        ocr_w <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, ocr_x2 <span class="op">-</span> ocr_x1)</span>
<span id="cb49-159"><a href="#cb49-159" aria-hidden="true" tabindex="-1"></a>        ocr_h <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, ocr_y2 <span class="op">-</span> ocr_y1)</span>
<span id="cb49-160"><a href="#cb49-160" aria-hidden="true" tabindex="-1"></a>        ocr_area <span class="op">=</span> ocr_w <span class="op">*</span> ocr_h</span>
<span id="cb49-161"><a href="#cb49-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-162"><a href="#cb49-162" aria-hidden="true" tabindex="-1"></a>        candidates <span class="op">=</span> []</span>
<span id="cb49-163"><a href="#cb49-163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, node <span class="kw">in</span> <span class="bu">enumerate</span>(nodes):</span>
<span id="cb49-164"><a href="#cb49-164" aria-hidden="true" tabindex="-1"></a>            cx, cy, w, h <span class="op">=</span> node[<span class="st">'x'</span>], node[<span class="st">'y'</span>], node[<span class="st">'width'</span>], node[<span class="st">'height'</span>]</span>
<span id="cb49-165"><a href="#cb49-165" aria-hidden="true" tabindex="-1"></a>            node_x1 <span class="op">=</span> cx <span class="op">-</span> (w <span class="op">//</span> <span class="dv">2</span>) <span class="op">-</span> relaxation_pixels</span>
<span id="cb49-166"><a href="#cb49-166" aria-hidden="true" tabindex="-1"></a>            node_y1 <span class="op">=</span> cy <span class="op">-</span> (h <span class="op">//</span> <span class="dv">2</span>) <span class="op">-</span> relaxation_pixels</span>
<span id="cb49-167"><a href="#cb49-167" aria-hidden="true" tabindex="-1"></a>            node_x2 <span class="op">=</span> cx <span class="op">+</span> (w <span class="op">//</span> <span class="dv">2</span>) <span class="op">+</span> relaxation_pixels</span>
<span id="cb49-168"><a href="#cb49-168" aria-hidden="true" tabindex="-1"></a>            node_y2 <span class="op">=</span> cy <span class="op">+</span> (h <span class="op">//</span> <span class="dv">2</span>) <span class="op">+</span> relaxation_pixels</span>
<span id="cb49-169"><a href="#cb49-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-170"><a href="#cb49-170" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (ocr_x1 <span class="op">&gt;=</span> node_x1 <span class="kw">and</span> ocr_y1 <span class="op">&gt;=</span> node_y1 <span class="kw">and</span> ocr_x2 <span class="op">&lt;=</span> node_x2 <span class="kw">and</span> ocr_y2 <span class="op">&lt;=</span> node_y2):</span>
<span id="cb49-171"><a href="#cb49-171" aria-hidden="true" tabindex="-1"></a>                node_area <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, w <span class="op">*</span> h)</span>
<span id="cb49-172"><a href="#cb49-172" aria-hidden="true" tabindex="-1"></a>                area_ratio <span class="op">=</span> node_area <span class="op">/</span> <span class="bu">float</span>(ocr_area)</span>
<span id="cb49-173"><a href="#cb49-173" aria-hidden="true" tabindex="-1"></a>                dx <span class="op">=</span> cx <span class="op">-</span> (ocr_x1 <span class="op">+</span> ocr_x2) <span class="op">/</span> <span class="fl">2.0</span></span>
<span id="cb49-174"><a href="#cb49-174" aria-hidden="true" tabindex="-1"></a>                dy <span class="op">=</span> cy <span class="op">-</span> (ocr_y1 <span class="op">+</span> ocr_y2) <span class="op">/</span> <span class="fl">2.0</span></span>
<span id="cb49-175"><a href="#cb49-175" aria-hidden="true" tabindex="-1"></a>                center_dist2 <span class="op">=</span> dx <span class="op">*</span> dx <span class="op">+</span> dy <span class="op">*</span> dy</span>
<span id="cb49-176"><a href="#cb49-176" aria-hidden="true" tabindex="-1"></a>                candidates.append((idx, node_area, area_ratio, center_dist2))</span>
<span id="cb49-177"><a href="#cb49-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-178"><a href="#cb49-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> candidates:</span>
<span id="cb49-179"><a href="#cb49-179" aria-hidden="true" tabindex="-1"></a>            filtered <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> candidates <span class="cf">if</span> c[<span class="dv">2</span>] <span class="op">&lt;=</span> max_area_ratio]</span>
<span id="cb49-180"><a href="#cb49-180" aria-hidden="true" tabindex="-1"></a>            chosen <span class="op">=</span> <span class="bu">min</span>(filtered <span class="cf">if</span> filtered <span class="cf">else</span> candidates, key<span class="op">=</span><span class="kw">lambda</span> t: (t[<span class="dv">1</span>], t[<span class="dv">3</span>]))</span>
<span id="cb49-181"><a href="#cb49-181" aria-hidden="true" tabindex="-1"></a>            best_idx <span class="op">=</span> chosen[<span class="dv">0</span>]</span>
<span id="cb49-182"><a href="#cb49-182" aria-hidden="true" tabindex="-1"></a>            node <span class="op">=</span> nodes[best_idx]</span>
<span id="cb49-183"><a href="#cb49-183" aria-hidden="true" tabindex="-1"></a>            node[<span class="st">'text'</span>] <span class="op">=</span> (node.get(<span class="st">'text'</span>, <span class="st">""</span>) <span class="op">+</span> (<span class="st">" "</span> <span class="cf">if</span> node.get(<span class="st">'text'</span>) <span class="cf">else</span> <span class="st">""</span>) <span class="op">+</span> text).strip()</span>
<span id="cb49-184"><a href="#cb49-184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb49-185"><a href="#cb49-185" aria-hidden="true" tabindex="-1"></a>            ocr_boxes.append({</span>
<span id="cb49-186"><a href="#cb49-186" aria-hidden="true" tabindex="-1"></a>                <span class="st">"text"</span>: text,</span>
<span id="cb49-187"><a href="#cb49-187" aria-hidden="true" tabindex="-1"></a>                <span class="st">"x1"</span>: <span class="bu">int</span>(ocr_x1), <span class="st">"y1"</span>: <span class="bu">int</span>(ocr_y1),</span>
<span id="cb49-188"><a href="#cb49-188" aria-hidden="true" tabindex="-1"></a>                <span class="st">"x2"</span>: <span class="bu">int</span>(ocr_x2), <span class="st">"y2"</span>: <span class="bu">int</span>(ocr_y2)</span>
<span id="cb49-189"><a href="#cb49-189" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb49-190"><a href="#cb49-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-191"><a href="#cb49-191" aria-hidden="true" tabindex="-1"></a>    standalone_text_labels <span class="op">=</span> []</span>
<span id="cb49-192"><a href="#cb49-192" aria-hidden="true" tabindex="-1"></a>    merge_y_thresh <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb49-193"><a href="#cb49-193" aria-hidden="true" tabindex="-1"></a>    merge_x_thresh <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb49-194"><a href="#cb49-194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ocr_boxes:</span>
<span id="cb49-195"><a href="#cb49-195" aria-hidden="true" tabindex="-1"></a>        ocr_boxes <span class="op">=</span> <span class="bu">sorted</span>(ocr_boxes, key<span class="op">=</span><span class="kw">lambda</span> b: (b[<span class="st">'y1'</span>], b[<span class="st">'x1'</span>]))</span>
<span id="cb49-196"><a href="#cb49-196" aria-hidden="true" tabindex="-1"></a>        used <span class="op">=</span> [<span class="va">False</span>] <span class="op">*</span> <span class="bu">len</span>(ocr_boxes)</span>
<span id="cb49-197"><a href="#cb49-197" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, box <span class="kw">in</span> <span class="bu">enumerate</span>(ocr_boxes):</span>
<span id="cb49-198"><a href="#cb49-198" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> used[i]:</span>
<span id="cb49-199"><a href="#cb49-199" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb49-200"><a href="#cb49-200" aria-hidden="true" tabindex="-1"></a>            texts <span class="op">=</span> [box[<span class="st">'text'</span>].strip()]</span>
<span id="cb49-201"><a href="#cb49-201" aria-hidden="true" tabindex="-1"></a>            x1, y1, x2, y2 <span class="op">=</span> box[<span class="st">'x1'</span>], box[<span class="st">'y1'</span>], box[<span class="st">'x2'</span>], box[<span class="st">'y2'</span>]</span>
<span id="cb49-202"><a href="#cb49-202" aria-hidden="true" tabindex="-1"></a>            used[i] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb49-203"><a href="#cb49-203" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(ocr_boxes)):</span>
<span id="cb49-204"><a href="#cb49-204" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> used[j]:</span>
<span id="cb49-205"><a href="#cb49-205" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb49-206"><a href="#cb49-206" aria-hidden="true" tabindex="-1"></a>                ob <span class="op">=</span> ocr_boxes[j]</span>
<span id="cb49-207"><a href="#cb49-207" aria-hidden="true" tabindex="-1"></a>                ob_x1, ob_y1, ob_x2, ob_y2 <span class="op">=</span> ob[<span class="st">'x1'</span>], ob[<span class="st">'y1'</span>], ob[<span class="st">'x2'</span>], ob[<span class="st">'y2'</span>]</span>
<span id="cb49-208"><a href="#cb49-208" aria-hidden="true" tabindex="-1"></a>                vertical_close <span class="op">=</span> <span class="bu">abs</span>(ob_y1 <span class="op">-</span> y2) <span class="op">&lt;=</span> merge_y_thresh <span class="kw">or</span> <span class="bu">abs</span>(ob_y2 <span class="op">-</span> y1) <span class="op">&lt;=</span> merge_y_thresh</span>
<span id="cb49-209"><a href="#cb49-209" aria-hidden="true" tabindex="-1"></a>                horizontal_overlap <span class="op">=</span> (ob_x1 <span class="op">&lt;=</span> x2 <span class="op">+</span> merge_x_thresh <span class="kw">and</span> ob_x2 <span class="op">&gt;=</span> x1 <span class="op">-</span> merge_x_thresh)</span>
<span id="cb49-210"><a href="#cb49-210" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> vertical_close <span class="kw">and</span> horizontal_overlap:</span>
<span id="cb49-211"><a href="#cb49-211" aria-hidden="true" tabindex="-1"></a>                    texts.append(ob[<span class="st">'text'</span>].strip())</span>
<span id="cb49-212"><a href="#cb49-212" aria-hidden="true" tabindex="-1"></a>                    x1 <span class="op">=</span> <span class="bu">min</span>(x1, ob_x1)</span>
<span id="cb49-213"><a href="#cb49-213" aria-hidden="true" tabindex="-1"></a>                    y1 <span class="op">=</span> <span class="bu">min</span>(y1, ob_y1)</span>
<span id="cb49-214"><a href="#cb49-214" aria-hidden="true" tabindex="-1"></a>                    x2 <span class="op">=</span> <span class="bu">max</span>(x2, ob_x2)</span>
<span id="cb49-215"><a href="#cb49-215" aria-hidden="true" tabindex="-1"></a>                    y2 <span class="op">=</span> <span class="bu">max</span>(y2, ob_y2)</span>
<span id="cb49-216"><a href="#cb49-216" aria-hidden="true" tabindex="-1"></a>                    used[j] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb49-217"><a href="#cb49-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-218"><a href="#cb49-218" aria-hidden="true" tabindex="-1"></a>            standalone_text_labels.append({</span>
<span id="cb49-219"><a href="#cb49-219" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id"</span>: <span class="ss">f"text</span><span class="sc">{</span><span class="bu">len</span>(standalone_text_labels) <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb49-220"><a href="#cb49-220" aria-hidden="true" tabindex="-1"></a>                <span class="st">"x"</span>: <span class="bu">int</span>(<span class="bu">round</span>((x1 <span class="op">+</span> x2) <span class="op">/</span> <span class="dv">2</span>)),</span>
<span id="cb49-221"><a href="#cb49-221" aria-hidden="true" tabindex="-1"></a>                <span class="st">"y"</span>: <span class="bu">int</span>(<span class="bu">round</span>((y1 <span class="op">+</span> y2) <span class="op">/</span> <span class="dv">2</span>)),</span>
<span id="cb49-222"><a href="#cb49-222" aria-hidden="true" tabindex="-1"></a>                <span class="st">"text"</span>: <span class="st">" "</span>.join(texts).strip(),</span>
<span id="cb49-223"><a href="#cb49-223" aria-hidden="true" tabindex="-1"></a>                <span class="st">"bbox"</span>: {<span class="st">"x1"</span>: x1, <span class="st">"y1"</span>: y1, <span class="st">"x2"</span>: x2, <span class="st">"y2"</span>: y2},</span>
<span id="cb49-224"><a href="#cb49-224" aria-hidden="true" tabindex="-1"></a>                <span class="st">"width"</span>: x2 <span class="op">-</span> x1,</span>
<span id="cb49-225"><a href="#cb49-225" aria-hidden="true" tabindex="-1"></a>                <span class="st">"height"</span>: y2 <span class="op">-</span> y1</span>
<span id="cb49-226"><a href="#cb49-226" aria-hidden="true" tabindex="-1"></a>            })</span>
<span id="cb49-227"><a href="#cb49-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-228"><a href="#cb49-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nodes, standalone_text_labels</span>
<span id="cb49-229"><a href="#cb49-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-230"><a href="#cb49-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-231"><a href="#cb49-231" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Build final JSON ----</span></span>
<span id="cb49-232"><a href="#cb49-232" aria-hidden="true" tabindex="-1"></a>source_detections <span class="op">=</span> <span class="va">None</span></span>
<span id="cb49-233"><a href="#cb49-233" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'final_detections'</span> <span class="kw">in</span> <span class="bu">globals</span>() <span class="kw">and</span> <span class="bu">isinstance</span>(<span class="bu">globals</span>()[<span class="st">'final_detections'</span>], <span class="bu">list</span>):</span>
<span id="cb49-234"><a href="#cb49-234" aria-hidden="true" tabindex="-1"></a>    source_detections <span class="op">=</span> <span class="bu">globals</span>()[<span class="st">'final_detections'</span>]</span>
<span id="cb49-235"><a href="#cb49-235" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="st">'final_detections'</span> <span class="kw">in</span> <span class="bu">globals</span>() <span class="kw">and</span> <span class="bu">globals</span>()[<span class="st">'final_detections'</span>] <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb49-236"><a href="#cb49-236" aria-hidden="true" tabindex="-1"></a>    source_detections <span class="op">=</span> <span class="va">None</span></span>
<span id="cb49-237"><a href="#cb49-237" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="st">'detections'</span> <span class="kw">in</span> <span class="bu">globals</span>() <span class="kw">and</span> <span class="bu">isinstance</span>(<span class="bu">globals</span>()[<span class="st">'detections'</span>], <span class="bu">list</span>):</span>
<span id="cb49-238"><a href="#cb49-238" aria-hidden="true" tabindex="-1"></a>    source_detections <span class="op">=</span> <span class="bu">globals</span>()[<span class="st">'detections'</span>]</span>
<span id="cb49-239"><a href="#cb49-239" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="st">'detections_list'</span> <span class="kw">in</span> <span class="bu">globals</span>() <span class="kw">and</span> <span class="bu">isinstance</span>(<span class="bu">globals</span>()[<span class="st">'detections_list'</span>], <span class="bu">list</span>):</span>
<span id="cb49-240"><a href="#cb49-240" aria-hidden="true" tabindex="-1"></a>    source_detections <span class="op">=</span> <span class="bu">globals</span>()[<span class="st">'detections_list'</span>]</span>
<span id="cb49-241"><a href="#cb49-241" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb49-242"><a href="#cb49-242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"No detections available. Ensure `final_detections` or `detections` is defined in scope."</span>)</span>
<span id="cb49-243"><a href="#cb49-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-244"><a href="#cb49-244" aria-hidden="true" tabindex="-1"></a>shape_detections <span class="op">=</span> [d <span class="cf">for</span> d <span class="kw">in</span> source_detections <span class="cf">if</span> d[<span class="dv">0</span>] <span class="kw">not</span> <span class="kw">in</span> [<span class="st">"dashed-arrow"</span>, <span class="st">"dotted-arrow"</span>, <span class="st">"solid-arrow"</span>, <span class="st">"arrow_head"</span>]]</span>
<span id="cb49-245"><a href="#cb49-245" aria-hidden="true" tabindex="-1"></a>nodes_json <span class="op">=</span> create_nodes_json(shape_detections)</span>
<span id="cb49-246"><a href="#cb49-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-247"><a href="#cb49-247" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'arrow_connections'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb49-248"><a href="#cb49-248" aria-hidden="true" tabindex="-1"></a>    arrow_connections <span class="op">=</span> []</span>
<span id="cb49-249"><a href="#cb49-249" aria-hidden="true" tabindex="-1"></a>edges_json <span class="op">=</span> create_edges_json(arrow_connections, nodes_json, source_detections)</span>
<span id="cb49-250"><a href="#cb49-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-251"><a href="#cb49-251" aria-hidden="true" tabindex="-1"></a>standalone_text_labels <span class="op">=</span> []</span>
<span id="cb49-252"><a href="#cb49-252" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'final_processed_data'</span> <span class="kw">in</span> <span class="bu">globals</span>() <span class="kw">and</span> final_processed_data:</span>
<span id="cb49-253"><a href="#cb49-253" aria-hidden="true" tabindex="-1"></a>    nodes_json, standalone_text_labels <span class="op">=</span> map_ocr_to_nodes(</span>
<span id="cb49-254"><a href="#cb49-254" aria-hidden="true" tabindex="-1"></a>        nodes_json, final_processed_data, relaxation_pixels<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb49-255"><a href="#cb49-255" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-256"><a href="#cb49-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-257"><a href="#cb49-257" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'image'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">globals</span>():</span>
<span id="cb49-258"><a href="#cb49-258" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"`image` not found in scope. Provide `image` (PIL Image or numpy array)."</span>)</span>
<span id="cb49-259"><a href="#cb49-259" aria-hidden="true" tabindex="-1"></a>img_obj <span class="op">=</span> <span class="bu">globals</span>()[<span class="st">'image'</span>]</span>
<span id="cb49-260"><a href="#cb49-260" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">hasattr</span>(img_obj, <span class="st">"shape"</span>):</span>
<span id="cb49-261"><a href="#cb49-261" aria-hidden="true" tabindex="-1"></a>    canvas_w, canvas_h <span class="op">=</span> <span class="bu">int</span>(img_obj.shape[<span class="dv">1</span>]), <span class="bu">int</span>(img_obj.shape[<span class="dv">0</span>])</span>
<span id="cb49-262"><a href="#cb49-262" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb49-263"><a href="#cb49-263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb49-264"><a href="#cb49-264" aria-hidden="true" tabindex="-1"></a>        canvas_w, canvas_h <span class="op">=</span> <span class="bu">int</span>(img_obj.size[<span class="dv">0</span>]), <span class="bu">int</span>(img_obj.size[<span class="dv">1</span>])</span>
<span id="cb49-265"><a href="#cb49-265" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb49-266"><a href="#cb49-266" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="st">"Cannot determine canvas size from `image`. Provide a numpy array or PIL Image."</span>) <span class="im">from</span> e</span>
<span id="cb49-267"><a href="#cb49-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-268"><a href="#cb49-268" aria-hidden="true" tabindex="-1"></a>final_json_output <span class="op">=</span> {</span>
<span id="cb49-269"><a href="#cb49-269" aria-hidden="true" tabindex="-1"></a>    <span class="st">"canvas"</span>: {<span class="st">"width"</span>: canvas_w, <span class="st">"height"</span>: canvas_h},</span>
<span id="cb49-270"><a href="#cb49-270" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nodes"</span>: nodes_json,</span>
<span id="cb49-271"><a href="#cb49-271" aria-hidden="true" tabindex="-1"></a>    <span class="st">"edges"</span>: edges_json,</span>
<span id="cb49-272"><a href="#cb49-272" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text_labels"</span>: standalone_text_labels</span>
<span id="cb49-273"><a href="#cb49-273" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-274"><a href="#cb49-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-275"><a href="#cb49-275" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Final JSON Output ---"</span>)</span>
<span id="cb49-276"><a href="#cb49-276" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(json.dumps(final_json_output, indent<span class="op">=</span><span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Final JSON Output ---
{
  "canvas": {
    "width": 801,
    "height": 798
  },
  "nodes": [
    {
      "id": "node1",
      "x": 649,
      "y": 534,
      "text": "Hope is a dangerous illusion",
      "shape": "Racetrack",
      "color": "#5f803e",
      "width": 248,
      "height": 395,
      "angle": "249.2"
    },
    {
      "id": "node2",
      "x": 143,
      "y": 420,
      "text": "#5",
      "shape": "circle",
      "color": "#ba6c26",
      "width": 136,
      "height": 132,
      "angle": ""
    },
    {
      "id": "node3",
      "x": 414,
      "y": 400,
      "text": "Fragments of Fire: Short Truths for a Heavy Mind",
      "shape": "Pentagon",
      "color": "#263619",
      "width": 431,
      "height": 415,
      "angle": "0.0"
    },
    {
      "id": "node4",
      "x": 566,
      "y": 197,
      "text": "The void always stares back.",
      "shape": "Racetrack",
      "color": "#faf9e7",
      "width": 335,
      "height": 320,
      "angle": "319.0"
    },
    {
      "id": "node5",
      "x": 260,
      "y": 692,
      "text": "#4",
      "shape": "circle",
      "color": "#ba6c26",
      "width": 137,
      "height": 133,
      "angle": ""
    },
    {
      "id": "node6",
      "x": 608,
      "y": 634,
      "text": "#3",
      "shape": "circle",
      "color": "#ba6c26",
      "width": 136,
      "height": 133,
      "angle": ""
    },
    {
      "id": "node7",
      "x": 266,
      "y": 194,
      "text": "We rot beautifully.",
      "shape": "Racetrack",
      "color": "#6d7a4b",
      "width": 351,
      "height": 317,
      "angle": "0.0"
    },
    {
      "id": "node8",
      "x": 648,
      "y": 264,
      "text": "#2",
      "shape": "circle",
      "color": "#ba6c26",
      "width": 135,
      "height": 133,
      "angle": ""
    },
    {
      "id": "node9",
      "x": 356,
      "y": 130,
      "text": "#1",
      "shape": "circle",
      "color": "#ba6c26",
      "width": 133,
      "height": 132,
      "angle": ""
    },
    {
      "id": "node10",
      "x": 378,
      "y": 692,
      "text": "Light lies; shadows remember.",
      "shape": "Racetrack",
      "color": "#dcaa73",
      "width": 391,
      "height": 163,
      "angle": "357.4"
    },
    {
      "id": "node11",
      "x": 182,
      "y": 538,
      "text": "Especially you. Everything lends.",
      "shape": "Racetrack",
      "color": "#c8945a",
      "width": 249,
      "height": 399,
      "angle": "1.9"
    }
  ],
  "edges": [],
  "text_labels": []
}</code></pre>
</div>
</div>
</section>
<section id="map" class="level1">
<h1><strong>MAP</strong></h1>
<pre><code># This is formatted as code</code></pre>
<p><strong>Mean Average Precision of the RF-DETR model</strong></p>
<div id="cell-49" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="d93c559d-6e67-4f26-b286-d44dfcc14261">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> supervision <span class="im">as</span> sv</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rfdetr <span class="im">import</span> RFDETRMedium</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> supervision.metrics.mean_average_precision <span class="im">import</span> MeanAveragePrecision</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>images_directory_path <span class="op">=</span> <span class="st">"/content/Dataset/valid"</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>annotations_path <span class="op">=</span> <span class="st">"/content/Dataset/valid/_annotations.coco.json"</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>preTrainedWeights <span class="op">=</span> <span class="st">"/content/weights/checkpoint_best_regular.pth"</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> RFDETRMedium(pretrain_weights<span class="op">=</span>preTrainedWeights)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>model.optimize_for_inference()</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>test_dataset <span class="op">=</span> sv.DetectionDataset.from_coco(</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    images_directory_path<span class="op">=</span>images_directory_path,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    annotations_path<span class="op">=</span>annotations_path,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_callback(image: Image.Image) <span class="op">-&gt;</span> sv.Detections:</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model.predict(image)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>sticky_note_class_name <span class="op">=</span> <span class="st">"Sticky Notes"</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>sticky_note_class_idx <span class="op">=</span> <span class="va">None</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, cls_name <span class="kw">in</span> <span class="bu">enumerate</span>(test_dataset.classes):</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cls_name.lower() <span class="op">==</span> sticky_note_class_name.lower():</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        sticky_note_class_idx <span class="op">=</span> idx</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>map_metric <span class="op">=</span> MeanAveragePrecision()</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>all_predictions <span class="op">=</span> []</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>all_ground_truths <span class="op">=</span> []</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path, image, ground_truth <span class="kw">in</span> test_dataset:</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> model_callback(image)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sticky_note_class_idx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>        preds <span class="op">=</span> preds[preds.class_id <span class="op">!=</span> sticky_note_class_idx]</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        ground_truth <span class="op">=</span> ground_truth[ground_truth.class_id <span class="op">!=</span> sticky_note_class_idx]</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    all_predictions.append(preds)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    all_ground_truths.append(ground_truth)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>map_metric.update(all_predictions, all_ground_truths)</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> map_metric.compute()</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Overall mAP@0.5:0.95 = </span><span class="sc">{</span>result<span class="sc">.</span>map50_95<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"mAP@0.5 = </span><span class="sc">{</span>result<span class="sc">.</span>map50<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Number of classes in dataset:"</span>, <span class="bu">len</span>(test_dataset.classes))</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Number of classes with AP computed:"</span>, result.ap_per_class.shape[<span class="dv">0</span>])</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Per-class AP:"</span>)</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, class_idx <span class="kw">in</span> <span class="bu">enumerate</span>(result.matched_classes):</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sticky_note_class_idx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> class_idx <span class="op">==</span> sticky_note_class_idx:</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>    class_name <span class="op">=</span> test_dataset.classes[class_idx]</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>    ap_scores <span class="op">=</span> result.ap_per_class[i]</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    mean_ap <span class="op">=</span> ap_scores.mean()</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>class_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>mean_ap<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using a different number of positional encodings than DINOv2, which means we're not loading DINOv2 backbone weights. This is not a problem if finetuning a pretrained RF-DETR model.
Using patch size 16 instead of 14, which means we're not loading DINOv2 backbone weights. This is not a problem if finetuning a pretrained RF-DETR model.
Loading pretrain weights</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING:rfdetr.main:num_classes mismatch: pretrain weights has 16 classes, but your model has 90 classes
reinitializing detection head with 16 classes
`loss_type=None` was set in the config but it is unrecognized. Using the default loss: `ForCausalLMLoss`.
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: torch.as_tensor results are registered as constants in the trace. You can safely ignore this warning if you use this function to create tensors out of constant variables that would be the same every time you call this function. In any other case, this might cause the trace to be incorrect.
TracerWarning: Iterating over a tensor might cause the trace to be incorrect. Passing a tensor of different shape won't change the number of iterations executed (and might lead to errors or silently give incorrect results).
TracerWarning: torch.tensor results are registered as constants in the trace. You can safely ignore this warning if you use this function to create tensors out of constant variables that would be the same every time you call this function. In any other case, this might cause the trace to be incorrect.
TracerWarning: torch.tensor results are registered as constants in the trace. You can safely ignore this warning if you use this function to create tensors out of constant variables that would be the same every time you call this function. In any other case, this might cause the trace to be incorrect.
UserWarning: torch.meshgrid: in an upcoming release, it will be required to pass the indexing argument. (Triggered internally at /pytorch/aten/src/ATen/native/TensorShape.cpp:4322.)
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
TracerWarning: Iterating over a tensor might cause the trace to be incorrect. Passing a tensor of different shape won't change the number of iterations executed (and might lead to errors or silently give incorrect results).
TracerWarning: Iterating over a tensor might cause the trace to be incorrect. Passing a tensor of different shape won't change the number of iterations executed (and might lead to errors or silently give incorrect results).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Overall mAP@0.5:0.95 = 0.8265
mAP@0.5 = 0.9478
Number of classes in dataset: 17
Number of classes with AP computed: 15
Per-class AP:
Cloud: 0.8402
Diamond: 0.8372
Double Arrow: 0.9713
Pentagon: 0.9066
Racetrack: 0.9020
Star: 0.9215
Triangle: 0.9800
arrow: 0.9016
arrow_head: 0.5326
circle: 0.8608
dashed-arrow: 0.6638
dotted-arrow: 0.6027
rectangle: 0.8934
rounded rectangle: 0.8837
solid-arrow: 0.6995</code></pre>
</div>
</div>
<p><strong>Verifying the Arrow connections for finding the algorithm accuracy</strong></p>
<div id="cell-51" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:805}}" data-outputid="4412f5d0-7c3e-424a-ab89-0b82c0dcf777" data-execution_count="163">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>json_data <span class="op">=</span> final_json_output</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Parse JSON ---</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> json_data</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>nodes <span class="op">=</span> {node[<span class="st">"id"</span>]: node <span class="cf">for</span> node <span class="kw">in</span> data[<span class="st">"nodes"</span>]}</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> data[<span class="st">"edges"</span>]</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Setup Canvas ---</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(data[<span class="st">"canvas"</span>][<span class="st">"width"</span>]<span class="op">/</span><span class="dv">100</span>, data[<span class="st">"canvas"</span>][<span class="st">"height"</span>]<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, data[<span class="st">"canvas"</span>][<span class="st">"width"</span>])</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">0</span>, data[<span class="st">"canvas"</span>][<span class="st">"height"</span>])</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">"off"</span>)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> nodes.values():</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> node[<span class="st">"text"</span>] <span class="cf">if</span> node[<span class="st">"text"</span>] <span class="cf">else</span> node[<span class="st">"shape"</span>]</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    ax.text(node[<span class="st">"x"</span>], node[<span class="st">"y"</span>], label, ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">8</span>, color<span class="op">=</span><span class="st">"black"</span>, wrap<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> edge <span class="kw">in</span> edges:</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> nodes[edge[<span class="st">"source"</span>]]</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    tgt <span class="op">=</span> nodes[edge[<span class="st">"target"</span>]]</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    x1, y1 <span class="op">=</span> src[<span class="st">"x"</span>], src[<span class="st">"y"</span>]</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    x2, y2 <span class="op">=</span> tgt[<span class="st">"x"</span>], tgt[<span class="st">"y"</span>]</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="st">""</span>,</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>                xy<span class="op">=</span>(x2, y2), xytext<span class="op">=</span>(x1, y1),</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>                arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-&gt;"</span>, color<span class="op">=</span><span class="st">"gray"</span>, lw<span class="op">=</span><span class="fl">1.2</span>))</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-52" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}}" data-outputid="4445b308-d511-4674-eed2-b43731a39bcc">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install pandas</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: pandas in /usr/local/lib/python3.12/dist-packages (2.2.2)
Requirement already satisfied: numpy&gt;=1.26.0 in /usr/local/lib/python3.12/dist-packages (from pandas) (2.0.2)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /usr/local/lib/python3.12/dist-packages (from pandas) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /usr/local/lib/python3.12/dist-packages (from pandas) (2025.2)
Requirement already satisfied: tzdata&gt;=2022.7 in /usr/local/lib/python3.12/dist-packages (from pandas) (2025.2)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.12/dist-packages (from python-dateutil&gt;=2.8.2-&gt;pandas) (1.17.0)</code></pre>
</div>
</div>
<p>Confusion metrix on the Output of the algorithm of arrow connections</p>
<div id="cell-54" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:796}}" data-outputid="a9bd2660-1051-4ed4-b89e-4878d13c4ba1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_and_extract_number(value):</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(value):</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    s_value <span class="op">=</span> <span class="bu">str</span>(value).strip()</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    parts <span class="op">=</span> s_value.split(<span class="st">' '</span>, <span class="dv">1</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    numeric_part <span class="op">=</span> parts[<span class="dv">0</span>]</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(<span class="bu">float</span>(numeric_part))</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> (<span class="pp">ValueError</span>, <span class="pp">TypeError</span>):</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_confusion_matrix(file_path):</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_excel(file_path)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>        numeric_columns <span class="op">=</span> [<span class="st">'TOTAL ARROW'</span>, <span class="st">'CORECT ARROW NUMBER'</span>, <span class="st">'WRONG ARROW NUMBER'</span>]</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> numeric_columns:</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>                df[col] <span class="op">=</span> df[col].<span class="bu">apply</span>(clean_and_extract_number)</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Warning: Column '</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">' not found. Please check spelling in your Excel file."</span>)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>        true_positives <span class="op">=</span> df[<span class="st">'CORECT ARROW NUMBER'</span>].<span class="bu">sum</span>()</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>        false_positives <span class="op">=</span> df[<span class="st">'WRONG ARROW NUMBER'</span>].<span class="bu">sum</span>()</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>        false_negatives <span class="op">=</span> (df[<span class="st">'TOTAL ARROW'</span>] <span class="op">-</span> df[<span class="st">'CORECT ARROW NUMBER'</span>]).<span class="bu">sum</span>()</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>        precision <span class="op">=</span> true_positives <span class="op">/</span> (true_positives <span class="op">+</span> false_positives) <span class="cf">if</span> (true_positives <span class="op">+</span> false_positives) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>        recall <span class="op">=</span> true_positives <span class="op">/</span> (true_positives <span class="op">+</span> false_negatives) <span class="cf">if</span> (true_positives <span class="op">+</span> false_negatives) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"----------------------------------------"</span>)</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"   Algorithm Performance Metrics"</span>)</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"----------------------------------------"</span>)</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"True Positives (TP):  </span><span class="sc">{</span>true_positives<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"False Positives (FP): </span><span class="sc">{</span>false_positives<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"False Negatives (FN): </span><span class="sc">{</span>false_negatives<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"True Negatives (TN):  Zero 0."</span>)</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Key Metrics ---"</span>)</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Precision: </span><span class="sc">{</span>precision<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Recall (Sensitivity): </span><span class="sc">{</span>recall<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"----------------------------------------</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>        matrix_data <span class="op">=</span> [[true_positives, false_negatives], [false_positives, <span class="dv">0</span>]]</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>        matrix_labels <span class="op">=</span> [</span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>            [<span class="ss">f"</span><span class="sc">{</span>true_positives<span class="sc">}</span><span class="ch">\n</span><span class="ss">(TP)"</span>, <span class="ss">f"</span><span class="sc">{</span>false_negatives<span class="sc">}</span><span class="ch">\n</span><span class="ss">(FN)"</span>],</span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>            [<span class="ss">f"</span><span class="sc">{</span>false_positives<span class="sc">}</span><span class="ch">\n</span><span class="ss">(FP)"</span>, <span class="st">"Zero (0) </span><span class="ch">\n</span><span class="st">(TN)"</span>]</span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>        sns.heatmap(matrix_data, annot<span class="op">=</span>matrix_labels, fmt<span class="op">=</span><span class="st">""</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>                    xticklabels<span class="op">=</span>[<span class="st">'Predicted: Arrow'</span>, <span class="st">'Predicted: Not Arrow'</span>],</span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>                    yticklabels<span class="op">=</span>[<span class="st">'Actual: Arrow'</span>, <span class="st">'Actual: Not Arrow'</span>],</span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>                    cbar<span class="op">=</span><span class="va">False</span>, annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">14</span>})</span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Predicted Label'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'True Label'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Confusion Matrix for Arrow Detection'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This command displays the plot</span></span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: The file '</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">' was not found."</span>)</span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"An unexpected error occurred: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a>    file_path <span class="op">=</span> <span class="st">'/content/REPORT.xlsx'</span></span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a>    create_confusion_matrix(file_path)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>----------------------------------------
   Algorithm Performance Metrics
----------------------------------------
True Positives (TP):  294
False Positives (FP): 10
False Negatives (FN): 10
True Negatives (TN):  Zero 0.

--- Key Metrics ---
Precision: 96.71%
Recall (Sensitivity): 96.71%
----------------------------------------
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-31-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>correct</p>
<div id="cell-56" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;colab&quot;,&quot;value&quot;:{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:653}}" data-outputid="c2fe45e3-0f5c-4dfe-da54-eb1f19a1bd2c" data-execution_count="190">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> textwrap</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image, ImageDraw, ImageFont</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DiagramGenerator:</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, json_data):</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.data <span class="op">=</span> json_data</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.canvas_w <span class="op">=</span> json_data[<span class="st">'canvas'</span>][<span class="st">'width'</span>]</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.canvas_h <span class="op">=</span> json_data[<span class="st">'canvas'</span>][<span class="st">'height'</span>]</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.image <span class="op">=</span> Image.new(<span class="st">'RGB'</span>, (<span class="va">self</span>.canvas_w, <span class="va">self</span>.canvas_h), color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.draw <span class="op">=</span> ImageDraw.Draw(<span class="va">self</span>.image)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.font <span class="op">=</span> ImageFont.truetype(<span class="st">"arial.ttf"</span>, <span class="dv">14</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.font_bold <span class="op">=</span> ImageFont.truetype(<span class="st">"arialbd.ttf"</span>, <span class="dv">13</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">IOError</span>:</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.font <span class="op">=</span> ImageFont.load_default()</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.font_bold <span class="op">=</span> ImageFont.load_default()</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> generate_image(<span class="va">self</span>):</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>        nodes <span class="op">=</span> <span class="va">self</span>.data.get(<span class="st">'nodes'</span>, [])</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>        sorted_nodes <span class="op">=</span> <span class="bu">sorted</span>(nodes, key<span class="op">=</span><span class="kw">lambda</span> n: n[<span class="st">'width'</span>] <span class="op">*</span> n[<span class="st">'height'</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node <span class="kw">in</span> sorted_nodes:</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.draw_node(node)</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> label <span class="kw">in</span> <span class="va">self</span>.data.get(<span class="st">'text_labels'</span>, []):</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.draw_label(label)</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.image</span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_bbox(<span class="va">self</span>, node):</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>        cx, cy <span class="op">=</span> node[<span class="st">'x'</span>], node[<span class="st">'y'</span>]</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>        w, h <span class="op">=</span> node[<span class="st">'width'</span>], node[<span class="st">'height'</span>]</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (cx <span class="op">-</span> w<span class="op">/</span><span class="dv">2</span>, cy <span class="op">-</span> h<span class="op">/</span><span class="dv">2</span>, cx <span class="op">+</span> w<span class="op">/</span><span class="dv">2</span>, cy <span class="op">+</span> h<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_poly_points(<span class="va">self</span>, cx, cy, w, h, shape_type):</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> shape_type <span class="op">==</span> <span class="st">"diamond"</span>:</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [(<span class="dv">0</span>, <span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>), (<span class="dv">0</span>, h<span class="op">/</span><span class="dv">2</span>), (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>)]</span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> shape_type <span class="op">==</span> <span class="st">"triangle"</span>:</span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [(<span class="dv">0</span>, <span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span>, h<span class="op">/</span><span class="dv">2</span>), (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span>, h<span class="op">/</span><span class="dv">2</span>)]</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> shape_type <span class="op">==</span> <span class="st">"pentagon"</span>:</span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>._calculate_ngon(<span class="dv">5</span>, w<span class="op">/</span><span class="dv">2</span>, h<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"arrow"</span> <span class="kw">in</span> shape_type <span class="kw">and</span> <span class="st">"double"</span> <span class="kw">not</span> <span class="kw">in</span> shape_type:</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>            head_len <span class="op">=</span> w <span class="op">*</span> <span class="fl">0.4</span></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [(<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span>, <span class="op">-</span>h<span class="op">/</span><span class="dv">4</span>), (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_len, <span class="op">-</span>h<span class="op">/</span><span class="dv">4</span>), (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_len, <span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>),</span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>                    (w<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>), (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_len, h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_len, h<span class="op">/</span><span class="dv">4</span>), (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span>, h<span class="op">/</span><span class="dv">4</span>)]</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="st">"double arrow"</span> <span class="kw">in</span> shape_type:</span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a>            head_w <span class="op">=</span> w <span class="op">*</span> <span class="fl">0.2</span></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a>            shaft_h <span class="op">=</span> h <span class="op">*</span> <span class="fl">0.4</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [(<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>), (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> head_w, <span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>), (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> head_w, <span class="op">-</span>shaft_h<span class="op">/</span><span class="dv">2</span>),</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a>                    (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_w, <span class="op">-</span>shaft_h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_w, <span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span>, <span class="dv">0</span>),</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a>                    (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_w, h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span> <span class="op">-</span> head_w, shaft_h<span class="op">/</span><span class="dv">2</span>),</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a>                    (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> head_w, shaft_h<span class="op">/</span><span class="dv">2</span>), (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> head_w, h<span class="op">/</span><span class="dv">2</span>)]</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [(<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span>, <span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span>, <span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>), (w<span class="op">/</span><span class="dv">2</span>, h<span class="op">/</span><span class="dv">2</span>), (<span class="op">-</span>w<span class="op">/</span><span class="dv">2</span>, h<span class="op">/</span><span class="dv">2</span>)]</span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw_node(<span class="va">self</span>, node):</span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a>        raw_shape <span class="op">=</span> node.get(<span class="st">'shape'</span>, <span class="st">'rectangle'</span>)</span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a>        shape_type <span class="op">=</span> raw_shape.lower().replace(<span class="st">"_"</span>, <span class="st">" "</span>).strip()</span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a>        cx, cy <span class="op">=</span> node[<span class="st">'x'</span>], node[<span class="st">'y'</span>]</span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a>        w, h <span class="op">=</span> node[<span class="st">'width'</span>], node[<span class="st">'height'</span>]</span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> node.get(<span class="st">'color'</span>, <span class="st">'#cccccc'</span>)</span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(color) <span class="op">==</span> <span class="dv">9</span> <span class="kw">and</span> color.startswith(<span class="st">'#'</span>): color <span class="op">=</span> color[:<span class="dv">7</span>]</span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>: angle <span class="op">=</span> <span class="bu">float</span>(node.get(<span class="st">'angle'</span>, <span class="dv">0</span>))</span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>: angle <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> node.get(<span class="st">'text'</span>, <span class="st">''</span>)</span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a>        x1, y1, x2, y2 <span class="op">=</span> <span class="va">self</span>.get_bbox(node)</span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> shape_type <span class="kw">in</span> [<span class="st">"circle"</span>, <span class="st">"ellipse"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>]:</span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.draw.ellipse([x1, y1, x2, y2], fill<span class="op">=</span>color)</span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> shape_type <span class="op">==</span> <span class="st">"racetrack"</span> <span class="kw">or</span> shape_type <span class="op">==</span> <span class="st">"terminal"</span>:</span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.draw.rounded_rectangle([x1, y1, x2, y2], radius<span class="op">=</span>h<span class="op">/</span><span class="dv">2</span>, fill<span class="op">=</span>color)</span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> shape_type <span class="kw">in</span> [<span class="st">"rounded rectangle"</span>, <span class="st">"process"</span>]:</span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.draw.rounded_rectangle([x1, y1, x2, y2], radius<span class="op">=</span><span class="dv">15</span>, fill<span class="op">=</span>color)</span>
<span id="cb61-84"><a href="#cb61-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> shape_type <span class="op">==</span> <span class="st">"cloud"</span>:</span>
<span id="cb61-85"><a href="#cb61-85" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.draw.ellipse([x1, y1, x2, y2], fill<span class="op">=</span>color)</span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> shape_type <span class="op">==</span> <span class="st">"star"</span>:</span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a>            points <span class="op">=</span> <span class="va">self</span>._calculate_star_points(<span class="dv">5</span>, w<span class="op">/</span><span class="dv">2</span>, w<span class="op">/</span><span class="dv">4</span>)</span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._draw_rotated_polygon(points, cx, cy, angle, color)</span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a>            points <span class="op">=</span> <span class="va">self</span>.get_poly_points(cx, cy, w, h, shape_type)</span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._draw_rotated_polygon(points, cx, cy, angle, color)</span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> text:</span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._draw_text_centered(text, cx, cy, w, h)</span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> draw_label(<span class="va">self</span>, label):</span>
<span id="cb61-97"><a href="#cb61-97" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.draw.text((label[<span class="st">'x'</span>], label[<span class="st">'y'</span>]), label.get(<span class="st">'text'</span>, <span class="st">''</span>), font<span class="op">=</span><span class="va">self</span>.font, fill<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb61-98"><a href="#cb61-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-99"><a href="#cb61-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _rotate_point(<span class="va">self</span>, point, angle_deg):</span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a>        angle_rad <span class="op">=</span> math.radians(angle_deg)</span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> point</span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (x <span class="op">*</span> math.cos(angle_rad) <span class="op">-</span> y <span class="op">*</span> math.sin(angle_rad),</span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a>                x <span class="op">*</span> math.sin(angle_rad) <span class="op">+</span> y <span class="op">*</span> math.cos(angle_rad))</span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _draw_rotated_polygon(<span class="va">self</span>, points, cx, cy, angle, color):</span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a>        rotated <span class="op">=</span> []</span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> p <span class="kw">in</span> points:</span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a>            rx, ry <span class="op">=</span> <span class="va">self</span>._rotate_point(p, angle)</span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a>            rotated.append((cx <span class="op">+</span> rx, cy <span class="op">+</span> ry))</span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.draw.polygon(rotated, fill<span class="op">=</span>color)</span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-112"><a href="#cb61-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _calculate_ngon(<span class="va">self</span>, sides, radius_x, radius_y):</span>
<span id="cb61-113"><a href="#cb61-113" aria-hidden="true" tabindex="-1"></a>        points <span class="op">=</span> []</span>
<span id="cb61-114"><a href="#cb61-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(sides):</span>
<span id="cb61-115"><a href="#cb61-115" aria-hidden="true" tabindex="-1"></a>            angle <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> math.pi <span class="op">*</span> i) <span class="op">/</span> sides <span class="op">-</span> (math.pi <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a>            points.append((math.cos(angle) <span class="op">*</span> radius_x, math.sin(angle) <span class="op">*</span> radius_y))</span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> points</span>
<span id="cb61-118"><a href="#cb61-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-119"><a href="#cb61-119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _calculate_star_points(<span class="va">self</span>, points_count, outer_radius, inner_radius):</span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a>        points <span class="op">=</span> []</span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a>        angle_step <span class="op">=</span> math.pi <span class="op">/</span> points_count</span>
<span id="cb61-122"><a href="#cb61-122" aria-hidden="true" tabindex="-1"></a>        current_angle <span class="op">=</span> <span class="op">-</span>math.pi <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb61-123"><a href="#cb61-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(points_count <span class="op">*</span> <span class="dv">2</span>):</span>
<span id="cb61-124"><a href="#cb61-124" aria-hidden="true" tabindex="-1"></a>            radius <span class="op">=</span> outer_radius <span class="cf">if</span> i <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> inner_radius</span>
<span id="cb61-125"><a href="#cb61-125" aria-hidden="true" tabindex="-1"></a>            points.append((math.cos(current_angle) <span class="op">*</span> radius, math.sin(current_angle) <span class="op">*</span> radius))</span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a>            current_angle <span class="op">+=</span> angle_step</span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> points</span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _draw_text_centered(<span class="va">self</span>, text, cx, cy, w, h):</span>
<span id="cb61-130"><a href="#cb61-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text: <span class="cf">return</span></span>
<span id="cb61-131"><a href="#cb61-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-132"><a href="#cb61-132" aria-hidden="true" tabindex="-1"></a>        char_w_approx <span class="op">=</span> <span class="fl">6.5</span></span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a>        padding <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a>        max_chars <span class="op">=</span> <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">int</span>((w <span class="op">-</span> padding) <span class="op">/</span> char_w_approx))</span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> textwrap.wrap(text, width<span class="op">=</span>max_chars)</span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a>        line_height <span class="op">=</span> <span class="dv">14</span></span>
<span id="cb61-139"><a href="#cb61-139" aria-hidden="true" tabindex="-1"></a>        total_text_h <span class="op">=</span> <span class="bu">len</span>(lines) <span class="op">*</span> line_height</span>
<span id="cb61-140"><a href="#cb61-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a>        current_y <span class="op">=</span> cy <span class="op">-</span> (total_text_h <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> lines:</span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a>            bbox <span class="op">=</span> <span class="va">self</span>.draw.textbbox((<span class="dv">0</span>, <span class="dv">0</span>), line, font<span class="op">=</span><span class="va">self</span>.font_bold)</span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a>            text_w <span class="op">=</span> bbox[<span class="dv">2</span>] <span class="op">-</span> bbox[<span class="dv">0</span>]</span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a>            text_x <span class="op">=</span> cx <span class="op">-</span> (text_w <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.draw.text((text_x, current_y), line, font<span class="op">=</span><span class="va">self</span>.font_bold, fill<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a>            current_y <span class="op">+=</span> line_height</span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-152"><a href="#cb61-152" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb61-153"><a href="#cb61-153" aria-hidden="true" tabindex="-1"></a>  <span class="st">"canvas"</span>: {</span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a>    <span class="st">"width"</span>: <span class="dv">801</span>,</span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a>    <span class="st">"height"</span>: <span class="dv">798</span></span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nodes"</span>: [</span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node1"</span>,</span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">649</span>,</span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">534</span>,</span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"Hope is a dangerous illusion"</span>,</span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"Racetrack"</span>,</span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#5f803e"</span>,</span>
<span id="cb61-165"><a href="#cb61-165" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">248</span>,</span>
<span id="cb61-166"><a href="#cb61-166" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">395</span>,</span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: {</span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a>        <span class="st">"angle"</span>: <span class="st">"290.7 "</span>,</span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"ocr_text"</span></span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-173"><a href="#cb61-173" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node2"</span>,</span>
<span id="cb61-174"><a href="#cb61-174" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">143</span>,</span>
<span id="cb61-175"><a href="#cb61-175" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">420</span>,</span>
<span id="cb61-176"><a href="#cb61-176" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"#5"</span>,</span>
<span id="cb61-177"><a href="#cb61-177" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"circle"</span>,</span>
<span id="cb61-178"><a href="#cb61-178" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#ba6c26"</span>,</span>
<span id="cb61-179"><a href="#cb61-179" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">136</span>,</span>
<span id="cb61-180"><a href="#cb61-180" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">132</span>,</span>
<span id="cb61-181"><a href="#cb61-181" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: <span class="st">""</span></span>
<span id="cb61-182"><a href="#cb61-182" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-183"><a href="#cb61-183" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-184"><a href="#cb61-184" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node3"</span>,</span>
<span id="cb61-185"><a href="#cb61-185" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">414</span>,</span>
<span id="cb61-186"><a href="#cb61-186" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">400</span>,</span>
<span id="cb61-187"><a href="#cb61-187" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"Fragments of Fire: Short Truths for a Heavy Mind"</span>,</span>
<span id="cb61-188"><a href="#cb61-188" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"Pentagon"</span>,</span>
<span id="cb61-189"><a href="#cb61-189" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#263619"</span>,</span>
<span id="cb61-190"><a href="#cb61-190" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">431</span>,</span>
<span id="cb61-191"><a href="#cb61-191" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">415</span>,</span>
<span id="cb61-192"><a href="#cb61-192" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: {</span>
<span id="cb61-193"><a href="#cb61-193" aria-hidden="true" tabindex="-1"></a>        <span class="st">"angle"</span>: <span class="st">"0.0 "</span>,</span>
<span id="cb61-194"><a href="#cb61-194" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"ocr_text"</span></span>
<span id="cb61-195"><a href="#cb61-195" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-196"><a href="#cb61-196" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-197"><a href="#cb61-197" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-198"><a href="#cb61-198" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node4"</span>,</span>
<span id="cb61-199"><a href="#cb61-199" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">566</span>,</span>
<span id="cb61-200"><a href="#cb61-200" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">197</span>,</span>
<span id="cb61-201"><a href="#cb61-201" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"The void always stares back."</span>,</span>
<span id="cb61-202"><a href="#cb61-202" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"Racetrack"</span>,</span>
<span id="cb61-203"><a href="#cb61-203" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#faf9e7"</span>,</span>
<span id="cb61-204"><a href="#cb61-204" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">335</span>,</span>
<span id="cb61-205"><a href="#cb61-205" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">320</span>,</span>
<span id="cb61-206"><a href="#cb61-206" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: {</span>
<span id="cb61-207"><a href="#cb61-207" aria-hidden="true" tabindex="-1"></a>        <span class="st">"angle"</span>: <span class="st">"41.2 "</span>,</span>
<span id="cb61-208"><a href="#cb61-208" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"ocr_text"</span></span>
<span id="cb61-209"><a href="#cb61-209" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-210"><a href="#cb61-210" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-211"><a href="#cb61-211" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-212"><a href="#cb61-212" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node5"</span>,</span>
<span id="cb61-213"><a href="#cb61-213" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">260</span>,</span>
<span id="cb61-214"><a href="#cb61-214" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">692</span>,</span>
<span id="cb61-215"><a href="#cb61-215" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"#4"</span>,</span>
<span id="cb61-216"><a href="#cb61-216" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"circle"</span>,</span>
<span id="cb61-217"><a href="#cb61-217" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#ba6c26"</span>,</span>
<span id="cb61-218"><a href="#cb61-218" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">137</span>,</span>
<span id="cb61-219"><a href="#cb61-219" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">133</span>,</span>
<span id="cb61-220"><a href="#cb61-220" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: <span class="st">""</span></span>
<span id="cb61-221"><a href="#cb61-221" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-222"><a href="#cb61-222" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-223"><a href="#cb61-223" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node6"</span>,</span>
<span id="cb61-224"><a href="#cb61-224" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">608</span>,</span>
<span id="cb61-225"><a href="#cb61-225" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">634</span>,</span>
<span id="cb61-226"><a href="#cb61-226" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"#3"</span>,</span>
<span id="cb61-227"><a href="#cb61-227" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"circle"</span>,</span>
<span id="cb61-228"><a href="#cb61-228" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#ba6c26"</span>,</span>
<span id="cb61-229"><a href="#cb61-229" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">136</span>,</span>
<span id="cb61-230"><a href="#cb61-230" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">133</span>,</span>
<span id="cb61-231"><a href="#cb61-231" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: <span class="st">""</span></span>
<span id="cb61-232"><a href="#cb61-232" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-233"><a href="#cb61-233" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-234"><a href="#cb61-234" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node7"</span>,</span>
<span id="cb61-235"><a href="#cb61-235" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">266</span>,</span>
<span id="cb61-236"><a href="#cb61-236" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">194</span>,</span>
<span id="cb61-237"><a href="#cb61-237" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"We rot beautifully."</span>,</span>
<span id="cb61-238"><a href="#cb61-238" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"Racetrack"</span>,</span>
<span id="cb61-239"><a href="#cb61-239" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#6d7a4b"</span>,</span>
<span id="cb61-240"><a href="#cb61-240" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">351</span>,</span>
<span id="cb61-241"><a href="#cb61-241" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">317</span>,</span>
<span id="cb61-242"><a href="#cb61-242" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: {</span>
<span id="cb61-243"><a href="#cb61-243" aria-hidden="true" tabindex="-1"></a>        <span class="st">"angle"</span>: <span class="st">"0.0 "</span>,</span>
<span id="cb61-244"><a href="#cb61-244" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"ocr_text"</span></span>
<span id="cb61-245"><a href="#cb61-245" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-246"><a href="#cb61-246" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-247"><a href="#cb61-247" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-248"><a href="#cb61-248" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node8"</span>,</span>
<span id="cb61-249"><a href="#cb61-249" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">648</span>,</span>
<span id="cb61-250"><a href="#cb61-250" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">264</span>,</span>
<span id="cb61-251"><a href="#cb61-251" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"#2"</span>,</span>
<span id="cb61-252"><a href="#cb61-252" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"circle"</span>,</span>
<span id="cb61-253"><a href="#cb61-253" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#ba6c26"</span>,</span>
<span id="cb61-254"><a href="#cb61-254" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">135</span>,</span>
<span id="cb61-255"><a href="#cb61-255" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">133</span>,</span>
<span id="cb61-256"><a href="#cb61-256" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: <span class="st">""</span></span>
<span id="cb61-257"><a href="#cb61-257" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-258"><a href="#cb61-258" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-259"><a href="#cb61-259" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node9"</span>,</span>
<span id="cb61-260"><a href="#cb61-260" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">356</span>,</span>
<span id="cb61-261"><a href="#cb61-261" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">130</span>,</span>
<span id="cb61-262"><a href="#cb61-262" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"#1"</span>,</span>
<span id="cb61-263"><a href="#cb61-263" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"circle"</span>,</span>
<span id="cb61-264"><a href="#cb61-264" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#ba6c26"</span>,</span>
<span id="cb61-265"><a href="#cb61-265" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">133</span>,</span>
<span id="cb61-266"><a href="#cb61-266" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">132</span>,</span>
<span id="cb61-267"><a href="#cb61-267" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: <span class="st">""</span></span>
<span id="cb61-268"><a href="#cb61-268" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-269"><a href="#cb61-269" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-270"><a href="#cb61-270" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node10"</span>,</span>
<span id="cb61-271"><a href="#cb61-271" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">378</span>,</span>
<span id="cb61-272"><a href="#cb61-272" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">692</span>,</span>
<span id="cb61-273"><a href="#cb61-273" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"Light lies; shadows remember."</span>,</span>
<span id="cb61-274"><a href="#cb61-274" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"Racetrack"</span>,</span>
<span id="cb61-275"><a href="#cb61-275" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#dcaa73"</span>,</span>
<span id="cb61-276"><a href="#cb61-276" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">391</span>,</span>
<span id="cb61-277"><a href="#cb61-277" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">163</span>,</span>
<span id="cb61-278"><a href="#cb61-278" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: {</span>
<span id="cb61-279"><a href="#cb61-279" aria-hidden="true" tabindex="-1"></a>        <span class="st">"angle"</span>: <span class="st">"2.5 "</span>,</span>
<span id="cb61-280"><a href="#cb61-280" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"ocr_text"</span></span>
<span id="cb61-281"><a href="#cb61-281" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-282"><a href="#cb61-282" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb61-283"><a href="#cb61-283" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-284"><a href="#cb61-284" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="st">"node11"</span>,</span>
<span id="cb61-285"><a href="#cb61-285" aria-hidden="true" tabindex="-1"></a>      <span class="st">"x"</span>: <span class="dv">182</span>,</span>
<span id="cb61-286"><a href="#cb61-286" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y"</span>: <span class="dv">538</span>,</span>
<span id="cb61-287"><a href="#cb61-287" aria-hidden="true" tabindex="-1"></a>      <span class="st">"text"</span>: <span class="st">"Especially you. Everything lends."</span>,</span>
<span id="cb61-288"><a href="#cb61-288" aria-hidden="true" tabindex="-1"></a>      <span class="st">"shape"</span>: <span class="st">"Racetrack"</span>,</span>
<span id="cb61-289"><a href="#cb61-289" aria-hidden="true" tabindex="-1"></a>      <span class="st">"color"</span>: <span class="st">"#c8945a"</span>,</span>
<span id="cb61-290"><a href="#cb61-290" aria-hidden="true" tabindex="-1"></a>      <span class="st">"width"</span>: <span class="dv">249</span>,</span>
<span id="cb61-291"><a href="#cb61-291" aria-hidden="true" tabindex="-1"></a>      <span class="st">"height"</span>: <span class="dv">399</span>,</span>
<span id="cb61-292"><a href="#cb61-292" aria-hidden="true" tabindex="-1"></a>      <span class="st">"angle"</span>: {</span>
<span id="cb61-293"><a href="#cb61-293" aria-hidden="true" tabindex="-1"></a>        <span class="st">"angle"</span>: <span class="st">"178.0 "</span>,</span>
<span id="cb61-294"><a href="#cb61-294" aria-hidden="true" tabindex="-1"></a>        <span class="st">"source"</span>: <span class="st">"ocr_text"</span></span>
<span id="cb61-295"><a href="#cb61-295" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb61-296"><a href="#cb61-296" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-297"><a href="#cb61-297" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb61-298"><a href="#cb61-298" aria-hidden="true" tabindex="-1"></a>  <span class="st">"edges"</span>: [],</span>
<span id="cb61-299"><a href="#cb61-299" aria-hidden="true" tabindex="-1"></a>  <span class="st">"text_labels"</span>: []</span>
<span id="cb61-300"><a href="#cb61-300" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-301"><a href="#cb61-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-302"><a href="#cb61-302" aria-hidden="true" tabindex="-1"></a>    gen <span class="op">=</span> DiagramGenerator(data)</span>
<span id="cb61-303"><a href="#cb61-303" aria-hidden="true" tabindex="-1"></a>    final_img <span class="op">=</span> gen.generate_image()</span>
<span id="cb61-304"><a href="#cb61-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-305"><a href="#cb61-305" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb61-306"><a href="#cb61-306" aria-hidden="true" tabindex="-1"></a>    plt.imshow(final_img)</span>
<span id="cb61-307"><a href="#cb61-307" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb61-308"><a href="#cb61-308" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"021ec06230a24d24983ea408876b8bff":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"0364ae9c5d254e5bb4f7226b4dfa7fa0":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"0678f1da67704eae93f6efa32f59621c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_021ec06230a24d24983ea408876b8bff","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_9ac8049da6c4460fb2c3819d95c87506","value":1}},"06c479fad5534467a635018f7d083fa4":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_93c773c27f4444c38a222222e3bc4811","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_2b679129101541c1b634a2896bec1bdb","value":1}},"097b03966f014abc9b79a6ca720ea77e":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"09fc5caf1d034507a93d5601c2212b55":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"09fd0324e321466eaa2f2af8c6d29c1b":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_4d7bf71467184032911022e8bf8738db","placeholder":"​","style":"IPY_MODEL_4f90d2d0f4ee48a78f6892a8734ce40d","value":" 3.96k/? [00:00&lt;00:00, 85.4kB/s]"}},"0a9785fda6564ee98b84e15e042b1bc1":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0aa471a391ef4b57ab1f276d79c0b0f6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_6ffbb0e5731d42babad913e256bc5ff4","placeholder":"​","style":"IPY_MODEL_a7ddd47b133f4a68b345b98049249b19","value":"Fetching 6 files: 100%"}},"0aeb8a7e38fe4be4981c3e5fa6a52f69":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"0be25366891f4adeb91c45ba1d813665":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"0cc326e95e79452185f65ee207d4fb75":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0d4a253bf80c484fb09b500decfe9c0b":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_59d8e3ff714f440dbffe97cafce20116","placeholder":"​","style":"IPY_MODEL_4083624b4af749c9aeccd3031299d4bb","value":" 6/6 [00:01&lt;00:00,  5.09it/s]"}},"0d659a8c080e413a9cbebfb203b1c7d6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_e3288590341c4f92a39c88803d6df5ce","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_124c8f730877463d9a677a90a11b3b92","value":1}},"0d74448ee4154a71a90e358122c741b1":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"0e52e7b5691d40169beafd63127bd51d":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0f2105b943174f97ba2df496aadb9933":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"103890aebb644cebb23748f5c068dacb":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"10e072baa06749a4b8db8f670378e0cc":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1117185b10f246faac1db84d45886e16":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"124c8f730877463d9a677a90a11b3b92":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"12842554eb084bd78e2f9df9eb90ba09":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"16f13af8abc243f684446c88f30fa486":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_804d093be895418e971ade79192b4de7","placeholder":"​","style":"IPY_MODEL_4890f6083c77451aa5bbe964f057fe7e","value":"config.json: "}},"1704994ea205409488b956f9eba650f5":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1b6da8fc01a541428c10029f2b2da400":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_7e34a13fd219404382940913bf8de123","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_fb820f73008b4fb29a5ef284b32e6cec","value":1}},"1e0ff1532f214c229a3e016c47d0ad4d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_d8ef7514c1194dadb7612db24c1d1439","IPY_MODEL_62716cdc0b5d4c0e998eb27d2fbab1f8","IPY_MODEL_55b95043aa3b46a8a4fb17544d6a9d52"],"layout":"IPY_MODEL_a9c1f8ce0900469694990770f15d2891"}},"1fc9bc5b6f934113b19e23270cfcde9d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"1fcc09e0f91f4af7ac36bc1202e97ee7":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"21c847635d9f48369ba3a6b0c8681966":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"21cf82ead56d48b2b8cf115d06c32793":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"23d4f1d466974a41add1d176a6a1f3ad":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e6c565595285414988a46db640fe03f0","placeholder":"​","style":"IPY_MODEL_7175c2dfb0b04f70941d133406b15b81","value":" 903/903 [00:00&lt;00:00, 90.0kB/s]"}},"241a8edd15ce4c84bed2c3bf5f9946ed":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_bcc4a1b6f92641809536cf66ab1db46c","IPY_MODEL_52c4b3ce30c64b6595375d9b29720648","IPY_MODEL_70a4d167b3d1469e814bce41d7543ef7"],"layout":"IPY_MODEL_4d5969d8bd46415bbd06ff01f8c4dfee"}},"25f736bb4fb64974af024c1e72c310f3":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"273f824e5bd546e5a65606b554a84f7d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2b679129101541c1b634a2896bec1bdb":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"2c303baea1b54965ba9f3411a1e535ba":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_25f736bb4fb64974af024c1e72c310f3","placeholder":"​","style":"IPY_MODEL_e2133f8dad514169b14ec8c1121a47d6","value":".gitattributes: "}},"2c38fe85ec6f4ab4904602943f54190d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"2c5259b4f30d4f0688acb6de3dd98699":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_5ef171d5545b46f18d678c22dcb662d7","placeholder":"​","style":"IPY_MODEL_e14a5126553d402fa6d7b8f53b403372","value":" 1.57k/? [00:00&lt;00:00, 56.2kB/s]"}},"2c5d9baa090a491fa2bff1ae27e709ac":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_aa84b3e1f83f4a9297fd7fcd380e0496","IPY_MODEL_456d170224824c738857c4f476646ba8","IPY_MODEL_a7bc76bcdde347d4bf1cd3e4c18e54ff"],"layout":"IPY_MODEL_097b03966f014abc9b79a6ca720ea77e"}},"2f316d61a0a342b8b175d79bbf84d09d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_0aa471a391ef4b57ab1f276d79c0b0f6","IPY_MODEL_f19abbed4fad4650b852ec92e7a31240","IPY_MODEL_ee2ab28372074c96ac9bf18656f6db81"],"layout":"IPY_MODEL_0cc326e95e79452185f65ee207d4fb75"}},"32bab47134064975bcd8a50bb8ac1d79":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"348e2a8954134c3a977c0b7b7fc0be21":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"37c1155a03d04cb0a12686ec5182ca4b":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3885fb459cf54028879c94875b5f7ff6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"38a1e5a861b24e058e780951df046749":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"392ccf855f2e40c0a23ad4220e66b271":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"39d9e89a92df46a49821cdd9c9efd4c5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b782599a7f0449eb8c3e67b0fb573c24","placeholder":"​","style":"IPY_MODEL_ba4a8bd54c634f95a277ad7d6ecb03bc","value":"README.md: "}},"3a08b36509f146c49d10fefc911415ac":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_afd466614b6747c9815cd850906fb90c","placeholder":"​","style":"IPY_MODEL_48d6cef2f8334e71afcf71522093e8d1","value":" 7.77M/7.77M [00:00&lt;00:00, 14.8MB/s]"}},"3a1e729c40ca44e8b75ea6132ea8528d":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3a6b4dc8bb9e4dbe8f388f75ce76acf3":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_727e9236ffd84620a060b979fb5284c2","placeholder":"​","style":"IPY_MODEL_d6b4528f93654281a32e94fc4b3a0303","value":"inference.pdiparams: 100%"}},"3c740f098f424d59b1c09db62cba92a9":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_16f13af8abc243f684446c88f30fa486","IPY_MODEL_0d659a8c080e413a9cbebfb203b1c7d6","IPY_MODEL_ad89773ab6384279b39714c39ad492af"],"layout":"IPY_MODEL_76a217b001f24a91b91585933e4a59ea"}},"3e57725d18c4441bbc484b198522304f":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"3f1f8297279041fe8d2b286172b96604":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"3fbec05efa5342928308c0ce7b63626e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_514f4986349f4d14913e43b6528e91aa","IPY_MODEL_0678f1da67704eae93f6efa32f59621c","IPY_MODEL_acf55838d12848838d60dcf2f26fa5cb"],"layout":"IPY_MODEL_e4ffd9bcf6744ccea83a35fe98898a7e"}},"4083624b4af749c9aeccd3031299d4bb":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4100fe51dd0c452eac643b896736d20a":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"4153961d828e451ab99c4f8cf1619573":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"456d170224824c738857c4f476646ba8":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_3f1f8297279041fe8d2b286172b96604","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_e040ab8599274e7aa1d176720d723def","value":1}},"46fa7e47dde6481d91bcfb1322e731f1":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4890f6083c77451aa5bbe964f057fe7e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"48d6cef2f8334e71afcf71522093e8d1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"48ec207503c04d32a385e67af0e0841c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"494019af2a8f41dfa69ed0b0cb148e02":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4beb7e042cc3422da0ec66852db9e72f":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4d5969d8bd46415bbd06ff01f8c4dfee":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4d5a4e387ca245f387c284143e078767":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_dbafe2f4657541868f76202207f746cf","placeholder":"​","style":"IPY_MODEL_348e2a8954134c3a977c0b7b7fc0be21","value":"inference.yml: 100%"}},"4d7bf71467184032911022e8bf8738db":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"4ec7dab16c19425b99d0b84760bf8a67":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"4f90d2d0f4ee48a78f6892a8734ce40d":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"50afe8fac96b428e9e936808148bb578":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_614d054a84a54168938b67b8eac713f7","placeholder":"​","style":"IPY_MODEL_09fc5caf1d034507a93d5601c2212b55","value":" 735/735 [00:00&lt;00:00, 66.9kB/s]"}},"514f4986349f4d14913e43b6528e91aa":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_88bbbdec17304d1d9d2ef3f7958cd9ab","placeholder":"​","style":"IPY_MODEL_a5410c6875044416bafb93048a02fbb8","value":"inference.json: "}},"52c4b3ce30c64b6595375d9b29720648":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_a34d40a985c646c1a4452a3020bb9dd4","max":6743918,"min":0,"orientation":"horizontal","style":"IPY_MODEL_88f29070973744759dc4b8506a0b2c47","value":6743918}},"5509af07920e4e1b9023f1e6ce4130a1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"55b95043aa3b46a8a4fb17544d6a9d52":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_bb8fafc32e194dd78c923e1da1890ea0","placeholder":"​","style":"IPY_MODEL_273f824e5bd546e5a65606b554a84f7d","value":" 2.87k/? [00:00&lt;00:00, 62.3kB/s]"}},"55e9f2465f754486b3e3f49b7f952508":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e9f955c0d2a04e03a1122a8c43fd984f","placeholder":"​","style":"IPY_MODEL_8b3928711818409bab7e06498d51960a","value":".gitattributes: "}},"5639865690854308b54749d32f3c2b47":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_8ece56f7e0e94a95ac3f704a4f76ecf0","placeholder":"​","style":"IPY_MODEL_998203b341dc436fa3f659809eba0278","value":"Fetching 6 files: 100%"}},"567316c72b084df88852419acfc41349":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"56a270acad8d48a1a5638158b7919217":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f51fae570ad54e4ab1c7ee2807d24676","placeholder":"​","style":"IPY_MODEL_bcb83052fec24170b2665c39c59856b7","value":" 15.9k/? [00:00&lt;00:00, 340kB/s]"}},"56d2b8f79a48427f9ff09320d7351f80":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"5758e2dc3af14dd5b74e7cbd3433052f":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"5768bcf3685b4d10a30386ef7cdccf7c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"5839f6209f774460b2369bd9d79499d3":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a325b33752934438938f3c69a0686dc6","IPY_MODEL_d67c4f82eb434f9499e1f36424929c0c","IPY_MODEL_d7b96af22f7b443d994fad301aa1fc04"],"layout":"IPY_MODEL_6f62553c26e646a7a30963515554b1cb"}},"59d8e3ff714f440dbffe97cafce20116":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"5a61b2a3c2ac406a9e0d8fc6ad1eb59c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_10e072baa06749a4b8db8f670378e0cc","max":6,"min":0,"orientation":"horizontal","style":"IPY_MODEL_f934a7b4e49445fbb16e111fb80eaaf1","value":6}},"5b209758a73049f1b88ca5b4b90ebbab":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"5ef171d5545b46f18d678c22dcb662d7":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"614d054a84a54168938b67b8eac713f7":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"61ac88de585e4970a100d741a1eeaafa":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"62716cdc0b5d4c0e998eb27d2fbab1f8":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_0d74448ee4154a71a90e358122c741b1","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_e6de32e34068417e83ac63b17dc1164f","value":1}},"6421e869cbd441f88b5f2cc85ed33215":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_8c95799a9c8242a5bd0be509983dcd49","placeholder":"​","style":"IPY_MODEL_0aeb8a7e38fe4be4981c3e5fa6a52f69","value":"inference.yml: 100%"}},"66bd5cd42c834836becda6d52c02a9de":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a08d222a51a94017b091e8983a9c3a5e","IPY_MODEL_e602cc24b07d4f838bc11eae543af139","IPY_MODEL_bd956736c0bd45a3a3d98d6b134b252e"],"layout":"IPY_MODEL_f680fa51226b4b5986f916a256012aa1"}},"6795e29272344c9daeaf87b79d45e2db":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"69bf9dfed4334b0a96e571d35aca3304":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_4d5a4e387ca245f387c284143e078767","IPY_MODEL_91377af4c2b44152916b308f17bb0217","IPY_MODEL_23d4f1d466974a41add1d176a6a1f3ad"],"layout":"IPY_MODEL_103890aebb644cebb23748f5c068dacb"}},"69f746d4fac54f92b9645f01772d4a78":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"6affb693b5b340329e09f6d5c0afa672":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"6f62553c26e646a7a30963515554b1cb":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"6ffbb0e5731d42babad913e256bc5ff4":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"70a4d167b3d1469e814bce41d7543ef7":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_21c847635d9f48369ba3a6b0c8681966","placeholder":"​","style":"IPY_MODEL_ac82514c28b54fa4ad15140ce9941012","value":" 6.74M/6.74M [00:01&lt;00:00, 5.15MB/s]"}},"7175c2dfb0b04f70941d133406b15b81":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"727e9236ffd84620a060b979fb5284c2":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"73a7c503c5f744ada8ffe95ed44359b5":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"73f308defd124b8bbf0a13da5324caea":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"76a217b001f24a91b91585933e4a59ea":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"772fe20c73764f5795545685b6122533":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7819cb9a78104fb6940bed9271c6b4ad":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"79c3ca75da8d49f2b4f3d5302f36c149":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_5639865690854308b54749d32f3c2b47","IPY_MODEL_5a61b2a3c2ac406a9e0d8fc6ad1eb59c","IPY_MODEL_c09ed3c50fc44b64865a77b3c40b8470"],"layout":"IPY_MODEL_3a1e729c40ca44e8b75ea6132ea8528d"}},"7af5bf3348914a97b75304aeaf47cca9":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_46fa7e47dde6481d91bcfb1322e731f1","placeholder":"​","style":"IPY_MODEL_5768bcf3685b4d10a30386ef7cdccf7c","value":"README.md: "}},"7e34a13fd219404382940913bf8de123":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"804d093be895418e971ade79192b4de7":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"834e9f41f95f48d892ef8e59c03ee459":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8490b020f143451fb112570b2b174ac8":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"84d2bba438874b629876916a4a6947bb":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"850f549684784d0e97f1dc7922af3921":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_1704994ea205409488b956f9eba650f5","max":6,"min":0,"orientation":"horizontal","style":"IPY_MODEL_6affb693b5b340329e09f6d5c0afa672","value":6}},"8540dd05b8c643708bd63c36306ca09b":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_8eb9f1b5d6c44fe1b26f94d7e5c9b635","IPY_MODEL_06c479fad5534467a635018f7d083fa4","IPY_MODEL_09fd0324e321466eaa2f2af8c6d29c1b"],"layout":"IPY_MODEL_9c01eb5394304e5c927662ca8af5d9b6"}},"8586a5761f154bd486cb13c5d6019fe4":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"86001e302b7d4d2ab38c50dc19079100":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"88bbbdec17304d1d9d2ef3f7958cd9ab":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"88f29070973744759dc4b8506a0b2c47":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"8afc0932f3614dfea4734d1401f80000":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_994a70464c2943a1a0d4de156e517779","IPY_MODEL_850f549684784d0e97f1dc7922af3921","IPY_MODEL_0d4a253bf80c484fb09b500decfe9c0b"],"layout":"IPY_MODEL_e94e516d530548c0b3abbc4721c3fdbc"}},"8b3928711818409bab7e06498d51960a":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"8be2be22bfa74267aef139b4e2576409":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_0f2105b943174f97ba2df496aadb9933","max":7772315,"min":0,"orientation":"horizontal","style":"IPY_MODEL_32bab47134064975bcd8a50bb8ac1d79","value":7772315}},"8c95799a9c8242a5bd0be509983dcd49":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"8dd0cb2c96114d03ac1bf9b3a58d3697":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_39d9e89a92df46a49821cdd9c9efd4c5","IPY_MODEL_fae985341fdb4f2fad50db0ada48eee5","IPY_MODEL_de1e0dcd4aa24e2c87782d0b7ca04e9c"],"layout":"IPY_MODEL_d9b9086a79e04d57ba5ac5e366a24272"}},"8eb9f1b5d6c44fe1b26f94d7e5c9b635":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e6af8ec5f8ea4a27b6b83a707ce31f0f","placeholder":"​","style":"IPY_MODEL_b04d6c0b7a104cb2b5df5310ab435c5a","value":"inference.yml: "}},"8ece56f7e0e94a95ac3f704a4f76ecf0":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9005c0a51cf44812899dd6e704612dbe":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"91377af4c2b44152916b308f17bb0217":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_9005c0a51cf44812899dd6e704612dbe","max":903,"min":0,"orientation":"horizontal","style":"IPY_MODEL_86001e302b7d4d2ab38c50dc19079100","value":903}},"918164875d5c44d887090c4255094710":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"92b939c5a9f14185b7658c12ea529899":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b6b776e0e62e4199bb924a406517de17","placeholder":"​","style":"IPY_MODEL_84d2bba438874b629876916a4a6947bb","value":"inference.pdiparams: 100%"}},"93c773c27f4444c38a222222e3bc4811":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"94c15a60b717424aa131a67061882476":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_d5cee5e6bac840ebb65916de70ab413f","max":87932887,"min":0,"orientation":"horizontal","style":"IPY_MODEL_bdaaa81d38fa4da2bd1af2f6ee993141","value":87932887}},"9843715720134b328472b921421cd03a":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_73f308defd124b8bbf0a13da5324caea","placeholder":"​","style":"IPY_MODEL_4153961d828e451ab99c4f8cf1619573","value":" 87.9M/87.9M [00:00&lt;00:00, 160MB/s]"}},"98a998958dd3418bbd38592e513f8129":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"994a70464c2943a1a0d4de156e517779":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e48390e55b6c4e38ba38101bdc75adf0","placeholder":"​","style":"IPY_MODEL_9c381c1a62b2416c95818ec371b031db","value":"Fetching 6 files: 100%"}},"998203b341dc436fa3f659809eba0278":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"9ac8049da6c4460fb2c3819d95c87506":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"9c01eb5394304e5c927662ca8af5d9b6":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9c381c1a62b2416c95818ec371b031db":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"9d56c6165be94ff9b68c4db5052d7f23":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"9f855befda2a407f83f0e4f2ef1f4f58":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_494019af2a8f41dfa69ed0b0cb148e02","placeholder":"​","style":"IPY_MODEL_3885fb459cf54028879c94875b5f7ff6","value":" 1.57k/? [00:00&lt;00:00, 57.3kB/s]"}},"a08d222a51a94017b091e8983a9c3a5e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_1fcc09e0f91f4af7ac36bc1202e97ee7","placeholder":"​","style":"IPY_MODEL_48ec207503c04d32a385e67af0e0841c","value":"inference.json: "}},"a1be7f6e85f54460afdecf7af42eec59":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_12842554eb084bd78e2f9df9eb90ba09","placeholder":"​","style":"IPY_MODEL_a46cfaebcdf84ab1bbea5ed428508f7f","value":"README.md: "}},"a1c170171a1c4d3f98728ffdbe08b23a":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_567316c72b084df88852419acfc41349","placeholder":"​","style":"IPY_MODEL_cce5f0133dcb45bb8600f40db1baa846","value":".gitattributes: "}},"a325b33752934438938f3c69a0686dc6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_bc908202eb934ed886e4e2e8f2786805","placeholder":"​","style":"IPY_MODEL_2c38fe85ec6f4ab4904602943f54190d","value":"config.json: "}},"a34d40a985c646c1a4452a3020bb9dd4":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a46cfaebcdf84ab1bbea5ed428508f7f":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a505916dfad44fac9b87636726c15191":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a5410c6875044416bafb93048a02fbb8":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a7bc76bcdde347d4bf1cd3e4c18e54ff":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e4cff2c412ec492682522e23da8f43d5","placeholder":"​","style":"IPY_MODEL_5509af07920e4e1b9023f1e6ce4130a1","value":" 104k/? [00:00&lt;00:00, 2.01MB/s]"}},"a7ddd47b133f4a68b345b98049249b19":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a8b240a2ae964f04a6ff5ecfc88cba15":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"a8bfddf5aa254214ac9ea6779c4fe481":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_8586a5761f154bd486cb13c5d6019fe4","placeholder":"​","style":"IPY_MODEL_adcc0d8880444c42a8f4776e4cc9b52e","value":" 3.55k/? [00:00&lt;00:00, 90.7kB/s]"}},"a9c1f8ce0900469694990770f15d2891":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"aa84b3e1f83f4a9297fd7fcd380e0496":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_a8b240a2ae964f04a6ff5ecfc88cba15","placeholder":"​","style":"IPY_MODEL_c7a36c03a0f94d0cb9faeada14902c9b","value":"inference.json: "}},"ab023fb9eb4248388367f40085175000":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_5b209758a73049f1b88ca5b4b90ebbab","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_c84cd6f88d0748f3ad07082e2a840296","value":1}},"ac82514c28b54fa4ad15140ce9941012":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"acc5ef49882c4ea3b7ebe29e80bd0fb9":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"acf55838d12848838d60dcf2f26fa5cb":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b3d37ccc6d9d44b781490c4a432f2577","placeholder":"​","style":"IPY_MODEL_b93c84ce4d7e40718a968ad1bcbff5ae","value":" 218k/? [00:00&lt;00:00, 5.10MB/s]"}},"ad89773ab6384279b39714c39ad492af":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_772fe20c73764f5795545685b6122533","placeholder":"​","style":"IPY_MODEL_1fc9bc5b6f934113b19e23270cfcde9d","value":" 2.49k/? [00:00&lt;00:00, 84.0kB/s]"}},"adcc0d8880444c42a8f4776e4cc9b52e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"afd466614b6747c9815cd850906fb90c":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b04d6c0b7a104cb2b5df5310ab435c5a":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"b1d6a47ae71f43c585dbdd30827b6951":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b3d37ccc6d9d44b781490c4a432f2577":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b6b776e0e62e4199bb924a406517de17":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b782599a7f0449eb8c3e67b0fb573c24":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"b93c84ce4d7e40718a968ad1bcbff5ae":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"b9cb52fd50d34394b89ca330cef06830":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a1be7f6e85f54460afdecf7af42eec59","IPY_MODEL_d3c9733316ba4140a8992291fd42b9b7","IPY_MODEL_56a270acad8d48a1a5638158b7919217"],"layout":"IPY_MODEL_f389cdd5854d46c7b15e0b2e87856bad"}},"ba4a8bd54c634f95a277ad7d6ecb03bc":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"bb8fafc32e194dd78c923e1da1890ea0":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"bc908202eb934ed886e4e2e8f2786805":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"bcb83052fec24170b2665c39c59856b7":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"bcc4a1b6f92641809536cf66ab1db46c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_37c1155a03d04cb0a12686ec5182ca4b","placeholder":"​","style":"IPY_MODEL_4beb7e042cc3422da0ec66852db9e72f","value":"inference.pdiparams: 100%"}},"bd956736c0bd45a3a3d98d6b134b252e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_d4541bdfc63b40b1b19462b16c6d508e","placeholder":"​","style":"IPY_MODEL_392ccf855f2e40c0a23ad4220e66b271","value":" 402k/? [00:00&lt;00:00, 7.63MB/s]"}},"bdaaa81d38fa4da2bd1af2f6ee993141":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"c09ed3c50fc44b64865a77b3c40b8470":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_73a7c503c5f744ada8ffe95ed44359b5","placeholder":"​","style":"IPY_MODEL_1117185b10f246faac1db84d45886e16","value":" 6/6 [00:01&lt;00:00,  2.64it/s]"}},"c138f2b6445244e4bc837037afb7d522":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_8490b020f143451fb112570b2b174ac8","placeholder":"​","style":"IPY_MODEL_cd8b2f31a1794002a61c3991be7179b0","value":" 1.57k/? [00:00&lt;00:00, 37.3kB/s]"}},"c159267aaba042cc91e96e57c595f4b9":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a1c170171a1c4d3f98728ffdbe08b23a","IPY_MODEL_d3c3481eb63f4f83abc549dffedce30b","IPY_MODEL_c138f2b6445244e4bc837037afb7d522"],"layout":"IPY_MODEL_ec288b4530d34907ac4e8933bfdd21ad"}},"c35b1f6833c441e19bee625e280c64ea":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"c7a36c03a0f94d0cb9faeada14902c9b":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"c84cd6f88d0748f3ad07082e2a840296":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"c999947ce28e4f2ba42229050b9cdeac":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"cb3ff3ebe1304e4a8e7b0c38ddaa6683":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_6421e869cbd441f88b5f2cc85ed33215","IPY_MODEL_cdf5891ce978439bb687e968107b3573","IPY_MODEL_50afe8fac96b428e9e936808148bb578"],"layout":"IPY_MODEL_98a998958dd3418bbd38592e513f8129"}},"cc3ac06b54ac46ddb6859c9f9d09e03c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_2c303baea1b54965ba9f3411a1e535ba","IPY_MODEL_e83b4ca5664f4c379a325311d6f8c11e","IPY_MODEL_2c5259b4f30d4f0688acb6de3dd98699"],"layout":"IPY_MODEL_834e9f41f95f48d892ef8e59c03ee459"}},"cc553674c23f46dbaad49ba3292ea0e6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_55e9f2465f754486b3e3f49b7f952508","IPY_MODEL_1b6da8fc01a541428c10029f2b2da400","IPY_MODEL_9f855befda2a407f83f0e4f2ef1f4f58"],"layout":"IPY_MODEL_d5ba3c097c144df5a11d1e4e1fae37a9"}},"cce5f0133dcb45bb8600f40db1baa846":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cd8b2f31a1794002a61c3991be7179b0":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cdf5891ce978439bb687e968107b3573":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_61ac88de585e4970a100d741a1eeaafa","max":735,"min":0,"orientation":"horizontal","style":"IPY_MODEL_4ec7dab16c19425b99d0b84760bf8a67","value":735}},"d3c3481eb63f4f83abc549dffedce30b":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_4100fe51dd0c452eac643b896736d20a","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_e09e2cc2709a4fbfa2c76f7ffe70c701","value":1}},"d3c9733316ba4140a8992291fd42b9b7":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_d42fcf509b604836ab15f67aed391498","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_38a1e5a861b24e058e780951df046749","value":1}},"d42fcf509b604836ab15f67aed391498":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"d4541bdfc63b40b1b19462b16c6d508e":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d5ba3c097c144df5a11d1e4e1fae37a9":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d5cee5e6bac840ebb65916de70ab413f":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d67c4f82eb434f9499e1f36424929c0c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_69f746d4fac54f92b9645f01772d4a78","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_c999947ce28e4f2ba42229050b9cdeac","value":1}},"d6b4528f93654281a32e94fc4b3a0303":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"d7b96af22f7b443d994fad301aa1fc04":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f3e1122d4f4b48efb057dc37c6cc9d4f","placeholder":"​","style":"IPY_MODEL_918164875d5c44d887090c4255094710","value":" 10.5k/? [00:00&lt;00:00, 200kB/s]"}},"d8ef7514c1194dadb7612db24c1d1439":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_5758e2dc3af14dd5b74e7cbd3433052f","placeholder":"​","style":"IPY_MODEL_a505916dfad44fac9b87636726c15191","value":"config.json: "}},"d9b9086a79e04d57ba5ac5e366a24272":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"dbafe2f4657541868f76202207f746cf":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"dd36edbde0e84773916f0e3b2b2418ee":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"de1e0dcd4aa24e2c87782d0b7ca04e9c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_acc5ef49882c4ea3b7ebe29e80bd0fb9","placeholder":"​","style":"IPY_MODEL_6795e29272344c9daeaf87b79d45e2db","value":" 6.91k/? [00:00&lt;00:00, 269kB/s]"}},"e040ab8599274e7aa1d176720d723def":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e09e2cc2709a4fbfa2c76f7ffe70c701":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e0e6b783817c41c1a19430670ce42791":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_3a6b4dc8bb9e4dbe8f388f75ce76acf3","IPY_MODEL_94c15a60b717424aa131a67061882476","IPY_MODEL_9843715720134b328472b921421cd03a"],"layout":"IPY_MODEL_b1d6a47ae71f43c585dbdd30827b6951"}},"e14a5126553d402fa6d7b8f53b403372":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"e2133f8dad514169b14ec8c1121a47d6":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"e24124668eba4b92ac4abdf8d3737d59":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_92b939c5a9f14185b7658c12ea529899","IPY_MODEL_8be2be22bfa74267aef139b4e2576409","IPY_MODEL_3a08b36509f146c49d10fefc911415ac"],"layout":"IPY_MODEL_c35b1f6833c441e19bee625e280c64ea"}},"e2f427b08bad4c6a84326715ffc2e852":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_7af5bf3348914a97b75304aeaf47cca9","IPY_MODEL_ab023fb9eb4248388367f40085175000","IPY_MODEL_a8bfddf5aa254214ac9ea6779c4fe481"],"layout":"IPY_MODEL_f6f80133ca0a4b43b1d1043b250eb7b8"}},"e3288590341c4f92a39c88803d6df5ce":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"20px"}},"e48390e55b6c4e38ba38101bdc75adf0":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e4cff2c412ec492682522e23da8f43d5":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e4ffd9bcf6744ccea83a35fe98898a7e":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e602cc24b07d4f838bc11eae543af139":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_0be25366891f4adeb91c45ba1d813665","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_7819cb9a78104fb6940bed9271c6b4ad","value":1}},"e6af8ec5f8ea4a27b6b83a707ce31f0f":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e6c565595285414988a46db640fe03f0":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e6de32e34068417e83ac63b17dc1164f":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e83b4ca5664f4c379a325311d6f8c11e":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_9d56c6165be94ff9b68c4db5052d7f23","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_56d2b8f79a48427f9ff09320d7351f80","value":1}},"e94e516d530548c0b3abbc4721c3fdbc":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e9f955c0d2a04e03a1122a8c43fd984f":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ec288b4530d34907ac4e8933bfdd21ad":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ee2ab28372074c96ac9bf18656f6db81":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HTMLModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0e52e7b5691d40169beafd63127bd51d","placeholder":"​","style":"IPY_MODEL_dd36edbde0e84773916f0e3b2b2418ee","value":" 6/6 [00:01&lt;00:00,  4.39it/s]"}},"f19abbed4fad4650b852ec92e7a31240":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_0a9785fda6564ee98b84e15e042b1bc1","max":6,"min":0,"orientation":"horizontal","style":"IPY_MODEL_0364ae9c5d254e5bb4f7226b4dfa7fa0","value":6}},"f389cdd5854d46c7b15e0b2e87856bad":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f3e1122d4f4b48efb057dc37c6cc9d4f":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f51fae570ad54e4ab1c7ee2807d24676":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f680fa51226b4b5986f916a256012aa1":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f6f80133ca0a4b43b1d1043b250eb7b8":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f934a7b4e49445fbb16e111fb80eaaf1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"fae985341fdb4f2fad50db0ada48eee5":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_21cf82ead56d48b2b8cf115d06c32793","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_3e57725d18c4441bbc484b198522304f","value":1}},"fb820f73008b4fb29a5ef284b32e6cec":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"state":{},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/muhammad-asif78\.github\.io\/nbdev_testing_simon2");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/muhammad-asif78/nbdev_testing_simon2/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>